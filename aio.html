<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="es" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Real-time analysis and forecasting for outbreak analytics with R: Todo en una sola página</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XZ471458FQ');
    </script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Ir al contenido principal</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img alt="Epiverse-TRACE" src="assets/images/epiverse-logo.svg"><span class="badge text-bg-danger" style="background-color: #FF4955; border-radius: 5px">
          <abbr title="Esta lección se encuentra en la fase pre-alfa, lo que significa que está en las primeras etapas de desarrollo, pero aún no se ha enseñado.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alfa
            </a>
            <span class="visually-hidden">Esta lección se encuentra en la fase pre-alfa, lo que significa que está en las primeras etapas de desarrollo, pero aún no se ha enseñado.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Vista de estudiante <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Vista de la instructora</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Navegación principal"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Alternar navegación">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menú</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Epiverse-TRACE" src="assets/images/epiverse-logo.svg">
</div>
    <div class="lesson-title-md">
      Real-time analysis and forecasting for outbreak analytics with R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Buscar en la página All In One" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Real-time analysis and forecasting for outbreak analytics with R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Puntos Clave</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glosario</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Perfiles de estudiante</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            Más <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Buscar en la página All In One"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Buscar en la página All In One">Buscar en la página All In One</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Real-time analysis and forecasting for outbreak analytics with R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Progreso de la lección" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="Cerrar menú" alt="Cerrar menú" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Cerrar " data-episodes="Episodios ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Vista de estudiante
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Vista de la instructora</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODIOS
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Resumen y configuración</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="delays-access.html">1. Acceder a las distribuciones de retrasos epidemiológicos</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="quantify-transmissibility.html">2. Cuantificar la transmisión</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="delays-functions.html">3. Use delay distributions in analysis</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="create-forecast.html">4. Crear una previsión a corto plazo</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="severity-static.html">5. Estimación de la severidad del brote</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="superspreading-estimate.html">6. Account for superspreading</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="superspreading-simulate.html">7. Simulate transmission chains</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RECURSOS
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Puntos Clave</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glosario</a>
                      </li>
                      <li>
                        <a href="profiles.html">Perfiles de estudiante</a>
                      </li>
                      <li><a href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">Todo en una sola página</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-delays-access"><p>Content from <a href="delays-access.html">Acceder a las distribuciones de retrasos epidemiológicos</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/delays-access.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>¿Cómo acceder a las distribuciones de retraso de la enfermedad desde
una base de datos preestablecida para su uso en el análisis?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Obtener retrasos de una base de datos de búsqueda bibliográfica con
<code>{epiparameter}</code>.</li>
<li>Obtén parámetros de distribución y estadísticas resumidas de
distribuciones de retrasos.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="requisitos-previos" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="requisitos-previos" class="callout-inner">
<h3 class="callout-title">Requisitos previos</h3>
<div class="callout-content">
<p>Este episodio requiere que estés familiarizado con</p>
<p><strong>Ciencia de datos</strong> Programación básica con R</p>
<p><strong>Teoría epidémica</strong> : Pparámetros epidemiológicos,
periodos de tiempo de la enfermedad, como el periodo de incubación, el
tiempo de generación y el intervalo serial.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducción">Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n"></a>
</h2>
<hr class="half-width">
<p>Las enfermedades infecciosas siguen un ciclo de infección, que
generalmente incluye las siguientes fases: periodo presintomático,
periodo sintomático y periodo de recuperación, tal y como se describe en
su <a href="reference.html#naturalhistory">historia natural</a>. Estos
periodos de tiempo pueden utilizarse para comprender la dinámica de
transmisión e informar sobre las intervenciones de prevención y control
de enfermedades.</p>
<figure><img src="fig/time-periods.jpg" alt="Definición de los periodos de tiempo clave. En Xiang et al, 2021" class="figure mx-auto d-block"><div class="figcaption">Definición de los periodos de tiempo clave. En
<a href="https://www.sciencedirect.com/science/article/pii/S2468042721000038" class="external-link">Xiang
et al, 2021</a>
</div>
</figure><div id="definiciones" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="definiciones" class="callout-inner">
<h3 class="callout-title">Definiciones</h3>
<div class="callout-content">
<p>Mira el <a href="reference.html">glosario</a> ¡para ver las
definiciones de todos los periodos de tiempo de la figura anterior!</p>
</div>
</div>
</div>
<p>Sin embargo, al inicio de una epidemia, los esfuerzos de modelamiento
pueden verse retrasados por la falta de un recurso centralizado que
resuma los parámetros de entrada para la enfermedad de interés (<a href="https://mrc-ide.github.io/epireview/" class="external-link">Nash et al., 2023</a>).
Proyectos como <code>{epiparameter}</code> y <code>{epireview}</code>
están construyendo catálogos en línea siguiendo protocolos de síntesis
de literatura que pueden ayudar a parametrizar modelos accediendo
fácilmente a una extensa biblioteca de parámetros epidemiológicos
previamente estimados de brotes pasados.</p>
<!-- Los primeros modelos para COVID-19 utilizaban parámetros de otros coronavirus. https://www.thelancet.com/article/S1473-3099(20)30144-4/fulltext -->
<p>Para ejemplificar cómo utilizar el <code>{epiparameter}</code> R en
tu canal de análisis, nuestro objetivo en este episodio será acceder a
un conjunto específico de parámetros epidemiológicos de la literatura,
en lugar de copiarlos y pegarlos manualmente, para integrarlos en un
flujo de trabajo de análisis con <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a></p>
<p>&lt;En este episodio, aprenderemos a acceder a un conjunto concreto
de parámetros epidemiológicos de la bibliografía y a obtener sus
<strong>estadísticas resumidas</strong> mediante
<code>{epiparameter}</code>. –&gt;</p>
<p>Empecemos cargando el paquete <code>{epiparameter}</code>.
Utilizaremos la tubería <code>%&gt;%</code> para conectar algunas de sus
funciones, algunas funciones de<a href="https://tibble.tidyverse.org/" class="external-link">tibble</a> y
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, así que llamaremos también al
paquete<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="el-doble-punto" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="el-doble-punto" class="callout-inner">
<h3 class="callout-title">El doble punto</h3>
<div class="callout-content">
<p>El doble punto <code>::</code> en R te permite llamar a una función
específica de un paquete sin cargar todo el paquete en el entorno
actual.</p>
<p>Por ejemplo <code>dplyr::filter(data, condition)</code> utiliza
<code>filter()</code> del paquete<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>.</p>
<p>Esto nos ayuda a recordar las funciones del paquete y a evitar
conflictos de espacio de nombres.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="el-problema">El problema<a class="anchor" aria-label="anchor" href="#el-problema"></a>
</h2>
<hr class="half-width">
<p>Si queremos estimar la transmisibilidad de una infección, es común
utilizar un paquete como <a href="https://github.com/mrc-ide/EpiEstim" class="external-link">EpiEstim</a> o
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>. Sin embargo, ambos requieren cierta información
epidemiológica como entrada. Por ejemplo, en <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>
utilizamos <code>EpiNow2::Gamma()</code> para especificar un <a href="reference.html#generationtime">tiempo de generación</a> como una
distribución de probabilidad añadiendo su media <code>mean</code>
desviación estándar (<code>sd</code>) y el valor máximo
(<code>max</code>).</p>
<p>Para especificar un tiempo de generación <code>generation_time</code>
que sigue a un <em>Gamma</em> con media <span class="math inline">\(\mu
= 4\)</span> y desviación estándar <span class="math inline">\(\sigma =
2\)</span> y un valor máximo de 20, escribimos</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Es una práctica común para analistas, buscar manualmente en la
literatura disponible y copiar y pegar el <strong>resumen
estadístico</strong> o los <strong>parámetros de distribución</strong>
de las publicaciones científicas. Un reto frecuente al que nos
enfrentamos a menudo es que la información sobre las distintas
distribuciones estadísticas no es coherente en toda la literatura. El
objetivo de <code>{epiparameter}</code> es facilitar el acceso a
estimaciones confiables de los parámetros de distribución para una serie
de enfermedades infecciosas, de modo que puedan implementarse fácilmente
en las líneas de análisis de brotes.</p>
<p>En este episodio <em>acceder a</em> a las estadísticas resumidas del
tiempo de generación de COVID-19 desde la biblioteca de parámetros
epidemiológicos proporcionada por <code>{epiparameter}</code>. Estos
parámetros pueden utilizarse para estimar la transmisibilidad de esta
enfermedad utilizando <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> en episodios
posteriores.</p>
<p>Empecemos por ver cuántas entradas hay disponibles en el <strong>base
de datos de distribuciones epidemiológicas</strong> en
<code>{epiparameter}</code> utilizando <code>epidist_db()</code> para la
distribución epidemiológica <code>epi_dist</code> llamada tiempo de
generación con la cadena <code>"generation"</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  epi_dist <span class="op">=</span> <span class="st">"generation"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 1 results that match the criteria (1 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Disease: Influenza
Pathogen: Influenza-A-H1N1
Epi Distribution: generation time
Study: Lessler J, Reich N, Cummings D, New York City Department of Health and
Mental Hygiene Swine Influenza Investigation Team (2009). "Outbreak of
2009 Pandemic Influenza A (H1N1) at a New York City School." _The New
England Journal of Medicine_. doi:10.1056/NEJMoa0906089
&lt;https://doi.org/10.1056/NEJMoa0906089&gt;.
Distribution: weibull
Parameters:
  shape: 2.360
  scale: 3.180</code></pre>
</div>
<p>Actualmente, en la biblioteca de parámetros epidemiológicos, tenemos
una entrada de tiempo generación <code>"generation"</code> para
Influenza. En su lugar, podemos consultar intervalos seriales
<code>"serial"</code> para <code>COVID</code>-19. ¡Veamos qué debemos
tener en cuenta para ello!</p>
</section><section><h2 class="section-heading" id="tiempo-de-generación-vs-intervalo-serial">Tiempo de generación vs intervalo serial<a class="anchor" aria-label="anchor" href="#tiempo-de-generaci%C3%B3n-vs-intervalo-serial"></a>
</h2>
<hr class="half-width">
<p>El tiempo de generación, junto con el número reproductivo (<span class="math inline">\(R\)</span>), proporcionan información valiosa
sobre la fuerza de transmisión e informan la implementación de medidas
de control. Dado un <span class="math inline">\(R&gt;1\)</span>, cuanto
más corto sea el tiempo de generación, más rápidamente aumentará la
incidencia de casos de enfermedad.</p>
<figure><img src="fig/reproduction-generation-time.png" alt="Vídeo del Centro MRC para el Análisis Global de las Enfermedades Infecciosas, Ep 76. Ciencia en Contexto - Grupo de Revisión de Parámetros Epi con la Dra. Anne Cori (27-07-2023) en https://youtu.be/VvpYHhFDIjI?si=XiUyjmSV1gKNdrrL" class="figure mx-auto d-block"><div class="figcaption">Vídeo del Centro MRC para el Análisis Global de
las Enfermedades Infecciosas, Ep 76. Ciencia en Contexto - Grupo de
Revisión de Parámetros Epi con la Dra. Anne Cori (27-07-2023) en <a href="https://youtu.be/VvpYHhFDIjI?si=XiUyjmSV1gKNdrrL" class="external-link uri">https://youtu.be/VvpYHhFDIjI?si=XiUyjmSV1gKNdrrL</a>
</div>
</figure><p>Al calcular el número de reproducción efectivo (<span class="math inline">\(R_{t}\)</span>), el <em>tiempo de generación</em>
suele aproximarse mediante el <a href="reference.html#serialinterval">intervalo serial</a> serial. Esta
aproximación frecuente se debe a que es más fácil observar y medir el
inicio de los síntomas que el inicio de la infección.</p>
<figure><img src="fig/serial-interval-observed.jpeg" alt="Un Esquema de la relación de los distintos periodos de tiempo de transmisión entre un infector y un infectado en un par de transmisión. La ventana de exposición se define como el intervalo de tiempo que tiene la exposición viral, y la ventana de transmisión se define como el intervalo de tiempo para la transmisión posterior con respecto al tiempo de infección (Chung Lau et al., 2021)." class="figure mx-auto d-block"><div class="figcaption">Un Esquema de la relación de los distintos
periodos de tiempo de transmisión entre un infector y un infectado en un
par de transmisión. La ventana de exposición se define como el intervalo
de tiempo que tiene la exposición viral, y la ventana de transmisión se
define como el intervalo de tiempo para la transmisión posterior con
respecto al tiempo de infección (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>).</div>
</figure><p>Sin embargo, usar el<em>intervalo serial</em> como una aproximación
del <em>tiempo de generación</em> es válido principalmente para las
enfermedades en las que la infecciosidad comienza después de la
aparición de los síntomas (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>). En los casos en que la infecciosidad comienza
antes de la aparición de los síntomas, los intervalos seriales pueden
tener valores negativos, como ocurre en las enfermedades con transmisión
presintomática (<a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext#gr2" class="external-link">Nishiura
et al., 2020</a>).</p>
<div id="de-los-periodos-de-tiempo-a-las-distribuciones-de-probabilidad." class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="de-los-periodos-de-tiempo-a-las-distribuciones-de-probabilidad." class="callout-inner">
<h3 class="callout-title">De los periodos de tiempo a las distribuciones de probabilidad.</h3>
<div class="callout-content">
<p>Cuando calculamos el <em>intervalo serial</em> vemos que no todos los
pares de casos tienen la misma duración temporal. Observaremos esta
variabilidad para cualquier par de casos y periodo de tiempo individual,
incluido el <a href="reference.html#incubation">periodo de
incubación</a> y <a href="reference.html#infectiousness">periodo
infeccioso</a>.</p>
<figure><img src="fig/serial-interval-pairs.jpg" alt="Intervalos seriales de posibles parejas de casos en (a) COVID-19 y (b) MERS-CoV. Los pares representan un supuesto infector y su presunto infectado trazados por fecha de inicio de los síntomas (Althobaity et al., 2022)." class="figure mx-auto d-block"><div class="figcaption">Intervalos seriales de posibles parejas de casos
en (a) COVID-19 y (b) MERS-CoV. Los pares representan un supuesto
infector y su presunto infectado trazados por fecha de inicio de los
síntomas (<a href="https://www.sciencedirect.com/science/article/pii/S2468042722000537#fig6" class="external-link">Althobaity
et al., 2022</a>).</div>
</figure><p>Para resumir estos datos de periodos de tiempo individuales y de
pares, podemos encontrar las <strong>distribuciones
estadísticas</strong> que mejor se ajusten a los datos (<a href="https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2023.28.27.2200806" class="external-link">McFarland
et al., 2023</a>).</p>
<!-- añade una referencia sobre buenas prácticas para estimar distribuciones -->
<figure><img src="fig/seria-interval-fitted-distributions.jpg" alt="Distribución ajustada del intervalo serial para (a) COVID-19 y (b) MERS-CoV basada en pares de transmisión notificados en Arabia Saudí. Ajustamos tres distribuciones comunmente usadas, Log normal, Gamma y Weibull, respectivamente (Althobaity et al., 2022)." class="figure mx-auto d-block"><div class="figcaption">Distribución ajustada del intervalo serial para
(a) COVID-19 y (b) MERS-CoV basada en pares de transmisión notificados
en Arabia Saudí. Ajustamos tres distribuciones comunmente usadas, Log
normal, Gamma y Weibull, respectivamente (<a href="https://www.sciencedirect.com/science/article/pii/S2468042722000537#fig5" class="external-link">Althobaity
et al., 2022</a>).</div>
</figure><p>Las distribuciones estadísticas se resumen en función de sus
<strong>estadísticas de resumen</strong> como la <em>ubicación</em>
(media y percentiles) y <em>dispersión</em> (varianza o desviación
estándar) de la distribución, o con su <strong>parámetros de
distribución</strong> que informan sobre la <em>forma</em> (forma y
tasa/escala) de la distribución. Estos valores estimados pueden
reportarse con su <strong>incertidumbre</strong> (intervalos de
confianza del 95%).</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="28%">
<col width="26%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th align="left">Gamma</th>
<th align="left">media</th>
<th align="left">forma</th>
<th align="left">velocidad/escala</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MERS-CoV</td>
<td align="left">14.13(13.9-14.7)</td>
<td align="left">6.31(4.88-8.52)</td>
<td align="left">0.43(0.33-0.60)</td>
</tr>
<tr class="even">
<td align="left">COVID-19</td>
<td align="left">5.1(5.0-5.5)</td>
<td align="left">2.77(2.09-3.88)</td>
<td align="left">0.53(0.38-0.76)</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="17%">
<col width="28%">
<col width="26%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th align="left">Weibull</th>
<th align="left">media</th>
<th align="left">forma</th>
<th align="left">velocidad/escala</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MERS-CoV</td>
<td align="left">14.2(13.3-15.2)</td>
<td align="left">3.07(2.64-3.63)</td>
<td align="left">16.1(15.0-17.1)</td>
</tr>
<tr class="even">
<td align="left">COVID-19</td>
<td align="left">5.2(4.6-5.9)</td>
<td align="left">1.74(1.46-2.11)</td>
<td align="left">5.83(5.08-6.67)</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="17%">
<col width="28%">
<col width="26%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th align="left">Log normal</th>
<th align="left">media</th>
<th align="left">media-log</th>
<th align="left">sd-log</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MERS-CoV</td>
<td align="left">14.08(13.1-15.2)</td>
<td align="left">2.58(2.50-2.68)</td>
<td align="left">0.44(0.39-0.5)</td>
</tr>
<tr class="even">
<td align="left">COVID-19</td>
<td align="left">5.2(4.2-6.5)</td>
<td align="left">1.45(1.31-1.61)</td>
<td align="left">0.63(0.54-0.74)</td>
</tr>
</tbody>
</table>
<p>Tabla: Estimaciones del intervalo serial utilizando las
distribuciones Gamma, Weibull y Log Normal. Los intervalos de confianza
del 95% para los parámetros de forma y escala (logmedia y sd para Log
Normal) se muestran entre paréntesis (<a href="https://www.sciencedirect.com/science/article/pii/S2468042722000537#tbl3" class="external-link">Althobaity
et al., 2022</a>).</p>
</div>
</div>
</div>
<div id="intervalo-serial" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="intervalo-serial" class="callout-inner">
<h3 class="callout-title">Intervalo serial</h3>
<div class="callout-content">
<p>Supongamos que COVID-19 y SARS tienen valores similares de número de
reproducción y que el intervalo serial se aproxima al tiempo de
generación.</p>
<p>Dado el intervalo serial de ambas infecciones en la siguiente
gráfica</p>
<ul>
<li>¿Cuál sería más difícil de controlar?</li>
<li>¿Por qué llegas a esa conclusión?</li>
</ul>
<figure><img src="fig/serial-interval-covid-sars.jpg" alt="El Intervalo serial de nuevas infecciones por coronavirus (COVID-19) superpuesto a una distribución publicada del SRAS. (Nishiura et al., 2020)" class="figure mx-auto d-block"><div class="figcaption">El Intervalo serial de nuevas infecciones por
coronavirus (COVID-19) superpuesto a una distribución publicada del
SRAS. (<a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext" class="external-link">Nishiura
et al., 2020</a>)</div>
</figure>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Dar una pista </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>El pico de cada curva puede informarte sobre la ubicación de la media
de cada distribución. Cuanto mayor sea la media, mayor será el intervalo
serial.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Mostrar la solución </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><strong>¿Cuál sería más difícil de controlar?</strong></p>
<p>COVID-19</p>
<p><strong>¿Por qué concluyes eso?</strong></p>
<p>COVID-19 tiene el intervalo serial promedioo más bajo. El valor
promedio aproximado del intervalo serial de COVID-19 es de unos cuatro
días, mientras que del SARS es de aproximadamentesiete días. Por lo
tanto, es probable que COVID-19 tenga nuevas generaciones en menos
tiempo que el SARS, asumiendo valores de número de reproducción
similares.</p>
</div>
</div>
</div>
</div>

</section><section><h2 class="section-heading" id="elección-de-parámetros-epidemiológicos">Elección de parámetros epidemiológicos<a class="anchor" aria-label="anchor" href="#elecci%C3%B3n-de-par%C3%A1metros-epidemiol%C3%B3gicos"></a>
</h2>
<hr class="half-width">
<p>En esta sección, utilizaremos <code>{epiparameter}</code> para
obtener el intervalo serial de COVID-19, como una alternativa al tiempo
de generación.</p>
<p>Preguntémonos ahora cuántos parámetros tenemos en la base de datos de
distribuciones epidemiológicas (<code>epidist_db()</code>) con la
enfermedad<code>disease</code> denominada <code>covid</code>-19.
¡Ejecútalo localmente!</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Desde el paquete <code>{epiparameter}</code> podemos utilizar la
función <code>epidist_db()</code> para consultar cualquier enfermedad
<code>disease</code> y también para una distribución epidemiológica
concreta (<code>epi_dist</code>). Ejecútalo en tu consola:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"COVID"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Con esta combinación de consultas, obtenemos más de una distribución
de retraso. Esta salida es un <code>&lt;epidist&gt;</code> objeto de
clase.</p>
<div id="insensible-a-mayúsculas-y-minúsculas" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="insensible-a-mayúsculas-y-minúsculas" class="callout-inner">
<h3 class="callout-title">INSENSIBLE A MAYÚSCULAS Y MINÚSCULAS</h3>
<div class="callout-content">
<p><code>epidist_db</code> es <a href="https://dillionmegida.com/p/case-sensitivity-vs-case-insensitivity/#case-insensitivity" class="external-link">insensible
a mayúsculas y minúsculas</a>. Esto significa que puedes utilizar
cadenas con letras en mayúsculas o minúsculas indistintamente. Cadenas
como <code>"serial"</code>, <code>"serial interval"</code> o
<code>"serial_interval"</code> también son válidos.</p>
</div>
</div>
</div>
<p>Como se sugiere en los resultados, para resumir una
<code>&lt;epidist&gt;</code> y obtener los nombres de las columnas de la
base de datos de parámetros subyacente, podemos añadir la función
<code>epiparameter::parameter_tbl()</code> al código anterior utilizando
la tubería <code>%&gt;%</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 4 results that match the criteria (3 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    4 × 7
  disease  pathogen  epi_distribution prob_distribution author  year sample_size
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1 COVID-19 SARS-CoV… serial interval  &lt;NA&gt;              Alene…  2021        3924
2 COVID-19 SARS-CoV… serial interval  lnorm             Nishi…  2020          28
3 COVID-19 SARS-CoV… serial interval  weibull           Nishi…  2020          18
4 COVID-19 SARS-CoV… serial interval  norm              Yang …  2020         131</code></pre>
</div>
<p>En el <code>epiparameter::parameter_tbl()</code> salida, también
podemos encontrar distintos tipos de distribuciones de probabilidad (por
ejemplo, Log-normal, Weibull, Normal).</p>
<p><code>{epiparameter}</code> utiliza la <code>base</code> R para las
distribuciones. Por eso <strong>Normal logarítmica</strong> se llama
<code>lnorm</code>.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> ¿Por qué tenemos una entrada “NA”? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>Las entradas con un valor faltante (<code>&lt;NA&gt;</code>) en la
columna <code>prob_distribution</code> son entradas <em>no
parametrizada</em>. Tienen estadísticas de resumen, pero no una
distribución de probabilidad. Compara estos dos resultados:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get an &lt;epidist&gt; object</span></span>
<span><span class="va">distribution</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"serial"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">distribution</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># pluck the first entry in the object class &lt;list&gt;</span></span>
<span>  <span class="fu">pluck</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># check if &lt;epidist&gt; object have distribution parameters</span></span>
<span>  <span class="fu">is_parameterised</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check if the second &lt;epidist&gt; object</span></span>
<span><span class="co"># have distribution parameters</span></span>
<span><span class="va">distribution</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pluck</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">is_parameterised</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="las-entradas-parametrizadas-tienen-un-método-de-inferencia">Las entradas parametrizadas tienen un método de Inferencia<a class="anchor" aria-label="anchor" href="#las-entradas-parametrizadas-tienen-un-m%C3%A9todo-de-inferencia"></a>
</h3>
<p>Como se detalla en <code>?is_parameterised</code> una distribución
parametrizada es la entrada que tiene una distribución de probabilidad
asociada proporcionada por un método <code>inference_method</code> como
se muestra en los metadatos<code>metadata</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distribution</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">inference_method</span></span>
<span><span class="va">distribution</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">inference_method</span></span>
<span><span class="va">distribution</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">inference_method</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="encuentra-tus-distribuciones-de-retraso" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="encuentra-tus-distribuciones-de-retraso" class="callout-inner">
<h3 class="callout-title">¡Encuentra tus distribuciones de retraso!</h3>
<div class="callout-content">
<p>Tómate 2 minutos para explorar el paquete
<code>{epiparameter}</code>.</p>
<p><strong>Elige</strong> una enfermedad de interés (por ejemplo,
Influenza estacional, sarampión, etc.) y una distribución de retrasos
(por ejemplo, el periodo de incubación, desde el inicio hasta la muerte,
etc.).</p>
<p>Encuéntra:</p>
<ul>
<li><p>¿Cuántas distribuciones de retraso hay para esa
enfermedad?</p></li>
<li><p>¿Cuántos tipos de distribución de probabilidad (por ejemplo,
gamma, log normal) hay para un retraso determinado en esa
enfermedad?</p></li>
</ul>
<p>Pregunta:</p>
<ul>
<li><p>¿Reconoces los artículos?</p></li>
<li><p>¿Debería la revisión de literatura de<code>{epiparameter}</code>
considerar otro artículo?</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Dar una pista </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" data-bs-parent="#accordionHint2" aria-labelledby="headingHint2">
<div class="accordion-body">
<p>La función <code>epidist_db()</code> con <code>disease</code> sólo
con la enfermedad cuenta el número de entradas como</p>
<ul>
<li>estudios, y</li>
<li>distribuciones de retrasos.</li>
</ul>
<p>La función <code>epidist_db()</code> función con la enfermedad
<code>disease</code> y <code>epi_dist</code> obtiene una lista de todas
las entradas con:</p>
<ul>
<li>la cita completa,</li>
<li>en <strong>tipo</strong> de distribución de probabilidad, y</li>
<li>valores de los parámetros de la distribución.</li>
</ul>
<p>La combinación de <code>epidist_db()</code> y
<code>parameter_tbl()</code> obtiene un marco de datos de todas las
entradas con columnas como</p>
<ul>
<li>el <strong>tipo</strong> de la distribución de probabilidad por cada
fila, y</li>
<li>autor y año del estudio.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Mostrar la solución </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Elegimos explorar las distribuciones de retraso del Ébola:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we expect 16 delays distributions for ebola</span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 17 results that match the criteria (17 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># List of 17 &lt;epidist&gt; objects
Number of diseases: 1
❯ Ebola Virus Disease
Number of epi distributions: 9
❯ hospitalisation to death ❯ hospitalisation to discharge ❯ incubation period ❯ notification to death ❯ notification to discharge ❯ offspring distribution ❯ onset to death ❯ onset to discharge ❯ serial interval
[[1]]
Disease: Ebola Virus Disease
Pathogen: Ebola Virus
Epi Distribution: offspring distribution
Study: Lloyd-Smith J, Schreiber S, Kopp P, Getz W (2005). "Superspreading and
the effect of individual variation on disease emergence." _Nature_.
doi:10.1038/nature04153 &lt;https://doi.org/10.1038/nature04153&gt;.
Distribution: nbinom
Parameters:
  mean: 1.500
  dispersion: 5.100

[[2]]
Disease: Ebola Virus Disease
Pathogen: Ebola Virus-Zaire Subtype
Epi Distribution: incubation period
Study: Eichner M, Dowell S, Firese N (2011). "Incubation period of ebola
hemorrhagic virus subtype zaire." _Osong Public Health and Research
Perspectives_. doi:10.1016/j.phrp.2011.04.001
&lt;https://doi.org/10.1016/j.phrp.2011.04.001&gt;.
Distribution: lnorm
Parameters:
  meanlog: 2.487
  sdlog: 0.330

[[3]]
Disease: Ebola Virus Disease
Pathogen: Ebola Virus-Zaire Subtype
Epi Distribution: onset to death
Study: The Ebola Outbreak Epidemiology Team, Barry A, Ahuka-Mundeke S, Ali
Ahmed Y, Allarangar Y, Anoko J, Archer B, Abedi A, Bagaria J, Belizaire
M, Bhatia S, Bokenge T, Bruni E, Cori A, Dabire E, Diallo A, Diallo B,
Donnelly C, Dorigatti I, Dorji T, Waeber A, Fall I, Ferguson N,
FitzJohn R, Tengomo G, Formenty P, Forna A, Fortin A, Garske T,
Gaythorpe K, Gurry C, Hamblion E, Djingarey M, Haskew C, Hugonnet S,
Imai N, Impouma B, Kabongo G, Kalenga O, Kibangou E, Lee T, Lukoya C,
Ly O, Makiala-Mandanda S, Mamba A, Mbala-Kingebeni P, Mboussou F,
Mlanda T, Makuma V, Morgan O, Mulumba A, Kakoni P, Mukadi-Bamuleka D,
Muyembe J, Bathé N, Ndumbi Ngamala P, Ngom R, Ngoy G, Nouvellet P, Nsio
J, Ousman K, Peron E, Polonsky J, Ryan M, Touré A, Towner R, Tshapenda
G, Van De Weerdt R, Van Kerkhove M, Wendland A, Yao N, Yoti Z, Yuma E,
Kalambayi Kabamba G, Mwati J, Mbuy G, Lubula L, Mutombo A, Mavila O,
Lay Y, Kitenge E (2018). "Outbreak of Ebola virus disease in the
Democratic Republic of the Congo, April–May, 2018: an epidemiological
study." _The Lancet_. doi:10.1016/S0140-6736(18)31387-4
&lt;https://doi.org/10.1016/S0140-6736%2818%2931387-4&gt;.
Distribution: gamma
Parameters:
  shape: 2.400
  scale: 3.333

# ℹ 14 more elements
# ℹ Use `print(n = ...)` to see more elements.
# ℹ Use `parameter_tbl()` to see a summary table of the parameters.
# ℹ Explore database online at: https://epiverse-trace.github.io/epiparameter/dev/articles/database.html</code></pre>
</div>
<p>Ahora, a partir de la salida de
<code>epiparameter::epidist_db()</code> ¿Qué es un <a href="reference.html#offspringdist">distribución de la
descendencia</a>?</p>
<p>Elegimos encontrar los periodos de incubación del ébola. Esta salida
lista todos los documentos y parámetros encontrados. Ejecútalo
localmente si es necesario:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"incubation"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Utilizamos <code>parameter_tbl()</code> para obtener una
visualización resumida de todo:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we expect 2 different types of delay distributions</span></span>
<span><span class="co"># for ebola incubation period</span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"incubation"</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 5 results that match the criteria (5 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    5 × 7
  disease   pathogen epi_distribution prob_distribution author  year sample_size
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1 Ebola Vi… Ebola V… incubation peri… lnorm             Eichn…  2011         196
2 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015        1798
3 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015          49
4 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015         957
5 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015         792</code></pre>
</div>
<p>Encontramos dos tipos de distribuciones de probabilidad para esta
consulta: <em>log normal</em> y <em>gamma</em>.</p>
<p>¿Cómo realiza <code>{epiparameter}</code> la recopilación y revisión
de la literatura revisada por pares? ¡Te invitamos a leer la viñeta
sobre <a href="https://epiverse-trace.github.io/epiparameter/articles/data_protocol.html" class="external-link">“Protocolo
de Recopilación y Síntesis de Datos”</a> !</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="selecciona-una-única-distribución">Selecciona una única distribución<a class="anchor" aria-label="anchor" href="#selecciona-una-%C3%BAnica-distribuci%C3%B3n"></a>
</h2>
<hr class="half-width">
<p>En <code>epiparameter::epidist_db()</code> funciona como una función
de filtrado o subconjunto. Utilicemos el argumento <code>author</code>
para filtrar los parámetros <code>Hiroshi Nishiura</code>:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Hiroshi"</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 2 results that match the criteria (2 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    2 × 7
  disease  pathogen  epi_distribution prob_distribution author  year sample_size
  &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1 COVID-19 SARS-CoV… serial interval  lnorm             Nishi…  2020          28
2 COVID-19 SARS-CoV… serial interval  weibull           Nishi…  2020          18</code></pre>
</div>
<p>Seguimos obteniendo más de un parámetro epidemiológico. Podemos
establecer el argumento <code>single_epidist</code> en <code>TRUE</code>
para obtener sólo uno:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Hiroshi"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Using Nishiura H, Linton N, Akhmetzhanov A (2020). "Serial interval of novel
coronavirus (COVID-19) infections." _International Journal of
Infectious Diseases_. doi:10.1016/j.ijid.2020.02.060
&lt;https://doi.org/10.1016/j.ijid.2020.02.060&gt;..
To retrieve the citation use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Disease: COVID-19
Pathogen: SARS-CoV-2
Epi Distribution: serial interval
Study: Nishiura H, Linton N, Akhmetzhanov A (2020). "Serial interval of novel
coronavirus (COVID-19) infections." _International Journal of
Infectious Diseases_. doi:10.1016/j.ijid.2020.02.060
&lt;https://doi.org/10.1016/j.ijid.2020.02.060&gt;.
Distribution: lnorm
Parameters:
  meanlog: 1.386
  sdlog: 0.568</code></pre>
</div>
<div id="cómo-funciona-single_epidist" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cómo-funciona-single_epidist" class="callout-inner">
<h3 class="callout-title">¿Cómo funciona ‘single_epidist’?</h3>
<div class="callout-content">
<p>Consultando la documentación de ayuda de
<code>?epiparameter::epidist_db()</code>:</p>
<ul>
<li>Si varias entradas coinciden con los argumentos suministrados y
<code>single_epidist = TRUE</code> entonces devolverá el
<code>&lt;epidist&gt;</code> parametrizado con el <em>mayor tamaño de
muestra</em>
</li>
<li>Si varias entradas son iguales después de esta clasificación, se
devolverá la <em>primera entrada</em>.</li>
</ul>
<p>¿Qué es un <code>&lt;epidist&gt;</code><em>parametrizado</em> ? Mira
<code>?is_parameterised</code>.</p>
</div>
</div>
</div>
<p>Asignemos este objeto de clase <code>&lt;epidist&gt;</code> al
objeto<code>covid_serialint</code>.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>    author <span class="op">=</span> <span class="st">"Nishiura"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Puedes utilizar <code>plot()</code> para objetos
<code>&lt;epidist&gt;</code> para visualizarlos:</p>
<ul>
<li>la <em>Función de densidad de probabilidad (PDF, por sus siglas en
inglés)</em> y</li>
<li>la <em>Función de distribución acumulativa (CDF, por sus siglas en
inglés)</em>.</li>
</ul>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot &lt;epidist&gt; object</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-access-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Con el argumento <code>day_range</code>, puedes cambiar la duración o
el número de días del <code>x</code> eje. Explora cómo se ve esto:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot &lt;epidist&gt; object</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="extrae-las-estadísticas-de-resumen">Extrae las estadísticas de resumen<a class="anchor" aria-label="anchor" href="#extrae-las-estad%C3%ADsticas-de-resumen"></a>
</h2>
<hr class="half-width">
<p>Podemos obtener la media o primedio<code>mean</code> y la desviación
estándar(<code>sd</code>) a partir de <code>&lt;epidist&gt;</code>
accediendo al objeto<code>summary_stats</code>:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the mean</span></span>
<span><span class="va">covid_serialint</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.7</code></pre>
</div>
<p>¡Ahora tenemos un parámetro epidemiológico que podemos reutilizar!
Dado que el <code>covid_serialint</code> es una distribución log normal
<code>lnorm</code> o, podemos reemplazar las <strong>estadísticas de
resumen</strong> que introducimos en la función
<code>EpiNow2::LogNormal()</code></p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="va">covid_serialint</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span>, <span class="co"># replaced!</span></span>
<span>  sd <span class="op">=</span> <span class="va">covid_serialint</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">sd</span>, <span class="co"># replaced!</span></span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>En el próximo episodio aprenderemos a utilizar <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>
para especificar correctamente las distribuciones y estimar la
transmisibilidad. Después, cómo utilizar <strong>funciones de
distribución</strong> para obtener un valor máximo (<code>max</code>)
para <code>EpiNow2::LogNormal()</code> y utilizar
<code>{epiparameter}</code> en tu análisis.</p>
<div id="distribuciones-logarítmicas-normales" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="distribuciones-logarítmicas-normales" class="callout-inner">
<h3 class="callout-title">Distribuciones logarítmicas normales</h3>
<div class="callout-content">
<p>Si necesitas los parámetros de la distribución log normal <strong>log
normales</strong> en lugar de las estadísticas de resumen, podemos
utilizar <code>epiparameter::get_parameters()</code>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_serialint_parameters</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  meanlog     sdlog
1.3862617 0.5679803 </code></pre>
</div>
<p>Se obtiene un vector de clase <code>&lt;numeric&gt;</code> ¡listo
para usar como entrada para cualquier otro paquete!</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="desafíos">Desafíos<a class="anchor" aria-label="anchor" href="#desaf%C3%ADos"></a>
</h2>
<hr class="half-width">
<div id="intervalo-serial-del-ébola" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="intervalo-serial-del-ébola" class="callout-inner">
<h3 class="callout-title">Intervalo serial del ébola</h3>
<div class="callout-content">
<p>Tómate 1 minuto para</p>
<p>Obtener acceso al intervalo serial de ébola con el mayor tamaño de
muestra.</p>
<p>Responde:</p>
<ul>
<li><p>¿Qué es el <code>sd</code> de la distribución
epidemiológica?</p></li>
<li><p>¿Cuál es el tamaño de muestra <code>sample_size</code> utilizado
en ese estudio?</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Dar una pista </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" data-bs-parent="#accordionHint3" aria-labelledby="headingHint3">
<div class="accordion-body">
<p>Utiliza el <code>$</code> más el operador <kbd>tab</kbd> o
<kbd>↹</kbd> para explorarlos como una lista desplegable:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>covid_serialint<span class="sc">$</span></span></code></pre>
</div>
<p>Utiliza el <code>str()</code> para mostrar la estructura del objeto
de R <code>&lt;epidist&gt;</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Mostrar la solución </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ebola serial interval</span></span>
<span><span class="va">ebola_serial</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Using WHO Ebola Response Team, Agua-Agum J, Ariyarajah A, Aylward B, Blake I,
Brennan R, Cori A, Donnelly C, Dorigatti I, Dye C, Eckmanns T, Ferguson
N, Formenty P, Fraser C, Garcia E, Garske T, Hinsley W, Holmes D,
Hugonnet S, Iyengar S, Jombart T, Krishnan R, Meijers S, Mills H,
Mohamed Y, Nedjati-Gilani G, Newton E, Nouvellet P, Pelletier L,
Perkins D, Riley S, Sagrado M, Schnitzler J, Schumacher D, Shah A, Van
Kerkhove M, Varsaneux O, Kannangarage N (2015). "West African Ebola
Epidemic after One Year — Slowing but Not Yet under Control." _The New
England Journal of Medicine_. doi:10.1056/NEJMc1414992
&lt;https://doi.org/10.1056/NEJMc1414992&gt;..
To retrieve the citation use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_serial</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Disease: Ebola Virus Disease
Pathogen: Ebola Virus
Epi Distribution: serial interval
Study: WHO Ebola Response Team, Agua-Agum J, Ariyarajah A, Aylward B, Blake I,
Brennan R, Cori A, Donnelly C, Dorigatti I, Dye C, Eckmanns T, Ferguson
N, Formenty P, Fraser C, Garcia E, Garske T, Hinsley W, Holmes D,
Hugonnet S, Iyengar S, Jombart T, Krishnan R, Meijers S, Mills H,
Mohamed Y, Nedjati-Gilani G, Newton E, Nouvellet P, Pelletier L,
Perkins D, Riley S, Sagrado M, Schnitzler J, Schumacher D, Shah A, Van
Kerkhove M, Varsaneux O, Kannangarage N (2015). "West African Ebola
Epidemic after One Year — Slowing but Not Yet under Control." _The New
England Journal of Medicine_. doi:10.1056/NEJMc1414992
&lt;https://doi.org/10.1056/NEJMc1414992&gt;.
Distribution: gamma
Parameters:
  shape: 2.188
  scale: 6.490</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the sd</span></span>
<span><span class="va">ebola_serial</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">sd</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 9.6</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the sample_size</span></span>
<span><span class="va">ebola_serial</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">sample_size</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 305</code></pre>
</div>
<p>Intenta visualizar esta distribución utilizando
<code>plot()</code>.</p>
<p>Explora también todos los demás elementos anidados dentro del objecto
<code>&lt;epidist&gt;</code> .</p>
<p>Comparte sobre:</p>
<ul>
<li>¿Qué elementos encuentras útiles para tu análisis?</li>
<li>¿Qué otros elementos te gustaría ver en este objeto? ¿Cómo?</li>
</ul>
</div>
</div>
</div>
</div>

<div id="parámetro-de-severidad-del-ébola" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="parámetro-de-severidad-del-ébola" class="callout-inner">
<h3 class="callout-title">Parámetro de severidad del ébola</h3>
<div class="callout-content">
<p>Un parámetro de severidad como la duración de la hospitalización
podría añadir información necesaria sobre la capacidad de camas en
respuesta a un brote (<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<!-- Además, `{EpiNow2}` también puede incluir la incertidumbre en torno a cada estadística de resumen, como la desviación estándar de la desviación típica. -->
<p>Para el ébola:</p>
<ul>
<li>¿Cuál es la <em>estimación puntual</em> reportada de la duración
media de la asistencia sanitaria y el aislamiento de casos?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Dar una pista </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" data-bs-parent="#accordionHint4" aria-labelledby="headingHint4">
<div class="accordion-body">
<p>Un retraso informativo debe medir el tiempo transcurrido desde el
inicio de los síntomas hasta la recuperación o la muerte.</p>
<p>Encuentra una forma de acceder a toda la base de datos
<code>{epiparameter}</code> y averigua cómo se puede almacenar ese
retraso. La salida de <code>parameter_tbl()</code> es un dataframe o
tabla de datos.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Mostrar la solución </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># one way to get the list of all the available parameters</span></span>
<span><span class="fu">epidist_db</span><span class="op">(</span>disease <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">epi_distribution</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 122 results that match the criteria (99 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 12 × 1
   epi_distribution
   &lt;chr&gt;
 1 incubation period
 2 serial interval
 3 generation time
 4 onset to death
 5 offspring distribution
 6 hospitalisation to death
 7 hospitalisation to discharge
 8 notification to death
 9 notification to discharge
10 onset to discharge
11 onset to hospitalisation
12 onset to ventilation        </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_severity</span> <span class="op">&lt;-</span> <span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"onset to discharge"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Returning 1 results that match the criteria (1 are parameterised).
Use subset to filter by entry variables or single_epidist to return a single entry.
To retrieve the citation for each use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># point estimate</span></span>
<span><span class="va">ebola_severity</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 15.1</code></pre>
</div>
<p>Comprueba que para algunas entradas de <code>{epiparameter}</code>
también tendrás la <em>incertidumbre</em> en torno a las <em>estimación
puntual</em> de cada estadística de síntesis:</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 95% confidence intervals</span></span>
<span><span class="va">ebola_severity</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean_ci</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 95</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># limits of the confidence intervals</span></span>
<span><span class="va">ebola_severity</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean_ci_limits</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 14.6 15.6</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="un-zoológico-de-distribuciones" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="un-zoológico-de-distribuciones" class="callout-inner">
<h3 class="callout-title">Un zoológico de distribuciones</h3>
<div class="callout-content">
<p>¡Explora esta shinyapp llamada <strong>The distribution zoo</strong>
!</p>
<p>Sigue estos pasos para reproducir la forma de la distribución de
intervalo serial COVID desde <code>{epiparameter}</code>
(<code>covid_serialint</code> objeto):</p>
<ol style="list-style-type: decimal">
<li>Accede al sitio web de shiny app <a href="https://ben18785.shinyapps.io/distribution-zoo/" class="external-link uri">https://ben18785.shinyapps.io/distribution-zoo/</a>,</li>
<li>Ve al panel izquierdo,</li>
<li>Mantén pulsado el botón <em>Categoría de distribución</em>:
<code>Continuous Univariate</code>,</li>
<li>Selecciona un nuevo <em>Tipo de distribución</em>:
<code>Log-Normal</code>,</li>
<li>Mueve los controles <strong>deslizantes</strong> es decir, el
elemento de control gráfico que te permite ajustar un valor moviendo una
barra horizontal hacia la posición <code>covid_serialint</code>
parámetros.</li>
</ol>
<p>Reprodúcelos con el botón <code>distribution</code> y todos sus
elementos de lista: <code>[[2]]</code>, <code>[[3]]</code> y
<code>[[4]]</code>. Explora cómo cambia la forma de una distribución
cuando cambian sus parámetros.</p>
<p>Comparte sobre:</p>
<ul>
<li>¿Qué otras funciones del sitio web te parecen útiles?</li>
</ul>
</div>
</div>
</div>

<!--
## Mapa conceptual

actualízalo a partir de la última prueba epiparamétrica
-->
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Utiliza <code>{epiparameter}</code> para acceder al catálogo de
literatura sobre distribuciones epidemiológicas de retraso.</li>
<li>Utiliza <code>epidist_db()</code> para seleccionar distribuciones de
retraso individuales.</li>
<li>Utiliza <code>parameter_tbl()</code> para obtener una visión general
de las distribuciones de retardo múltiples.</li>
<li>Reutiliza las estimaciones conocidas para una enfermedad desconocida
en la fase inicial de un brote cuando no se disponga de datos de rastreo
de contactos.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-quantify-transmissibility"><p>Content from <a href="quantify-transmissibility.html">Cuantificar la transmisión</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/quantify-transmissibility.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>¿Cómo puedo estimar el número de reproducción variable en el tiempo
(<span class="math inline">\(Rt\)</span>) y la tasa de crecimiento a
partir de una serie temporal de datos de casos?</li>
<li>¿Cómo puedo cuantificar la heterogeneidad geográfica a partir de
estas métricas de transmisión?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Aprender a estimar las métricas de transmisión a partir de una serie
temporal de datos de casos utilizando el paquete R
<code>EpiNow2</code>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="requisitos-previos" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="requisitos-previos" class="callout-inner">
<h3 class="callout-title">Requisitos previos</h3>
<div class="callout-content">
<p>Los alumnos deben familiarizarse con los siguientes conceptos antes
de trabajar con este tutorial:</p>
<p><strong>Estadística</strong> Distribuciones de probabilidad y
principio del análisis bayesiano.</p>
<p><strong>Teoría epidémica</strong> Número de reproducción
efectiva.</p>
<p><strong>Ciencia de los datos</strong> Transformación y visualización
de datos. Puedes revisar el episodio en <a href="https://epiverse-trace.github.io/tutorials-early/describe-cases.html" class="external-link">Agregar
y visualizar</a> datos de incidencia.</p>
</div>
</div>
</div>
<div id="recordatorio-el-número-de-reproducción-efectiva-r_t" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="recordatorio-el-número-de-reproducción-efectiva-r_t" class="callout-inner">
<h3 class="callout-title">Recordatorio: el Número de Reproducción
Efectiva, <span class="math inline">\(R_t\)</span>
</h3>
<div class="callout-content">
<p>El <a href="reference.html#basic">número básico de reproducción</a>,
<span class="math inline">\(R_0\)</span> es el número medio de casos
causados por un individuo infeccioso en una población totalmente
susceptible.</p>
<p>Pero en un brote en curso, la población no permanece totalmente
susceptible, ya que los que se recuperan de la infección suelen ser
inmunes. Además, puede haber cambios de comportamiento u otros factores
que afecten la transmisión. Por lo tanto, cuando nos interesa controlar
los cambios en la transmisión, es más importante tener en cuenta el
valor del <strong>número de reproducción efectiva</strong>, <span class="math inline">\(R_t\)</span> y el número medio de casos causados
por un individuo infeccioso en la población en el momento <span class="math inline">\(t\)</span>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducción">Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n"></a>
</h2>
<hr class="half-width">
<p>La intensidad de la transmisión de un brote se cuantifica mediante
dos métricas clave: el número de reproducción, que informa sobre la
fuerza de la transmisión indicando cuántos casos nuevos se esperan de
cada caso existente; y la <a href="reference.html#growth">tasa de
crecimiento</a> que informa sobre la velocidad de la transmisión,
indicando la rapidez con que el brote se propaga o disminuye (tiempo de
duplicación/desaparición) dentro de una población. Para más detalles
sobre la distinción entre velocidad y fuerza de transmisión y las
implicaciones para el control, revisa <a href="https://royalsocietypublishing.org/doi/full/10.1098/rspb.2020.1556" class="external-link">Dushoff
y Park, 2021</a>.</p>
<p>Para estimar estas métricas clave utilizando datos de casos, debemos
tener en cuenta los retrasos entre la fecha de las infecciones y la
fecha de los casos notificados. En una situación de brote, normalmente
sólo se dispone de datos sobre las fechas notificadas, por lo que
debemos utilizar métodos de estimación para tener en cuenta estos
retrasos cuando intentemos comprender los cambios en la transmisión a lo
largo del tiempo.</p>
<p>En los próximos tutoriales nos centraremos en cómo utilizar las
funciones de <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> para estimar las métricas de
transmisión de los datos de casos. No cubriremos el trasfondo teórico de
los modelos ni el marco de inferencia; para más detalles sobre estos
conceptos, consulta la <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_infections.html" class="external-link">viñeta</a>.</p>
<p>En este tutorial vamos a aprender a utilizar el paquete
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> para estimar el número de reproducción variable
en el tiempo. Obtendremos los datos de entrada de
<a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a>. Utilizaremos el paquete <a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a>
y <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> para ordenar algunas de sus salidas,
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> para visualizar la distribución de casos, y el
operador tubería <code>%&gt;%</code> para conectar algunas de sus
funciones, así que también llamaremos al paquete
<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">EpiNow2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">incidence2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="el-doble-punto" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="el-doble-punto" class="callout-inner">
<h3 class="callout-title">El doble punto</h3>
<div class="callout-content">
<p>El doble punto <code>::</code> en R te permite llamar a una función
específica de un paquete sin cargar todo el paquete en el entorno
actual.</p>
<p>Por ejemplo <code>dplyr::filter(data, condition)</code> utiliza la
función <code>filter()</code> del paquete <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>.</p>
<p>Esto nos ayuda a recordar las funciones del paquete y a evitar
conflictos de espacio de nombres.</p>
</div>
</div>
</div>

<div id="inferencia-bayesiana" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="inferencia-bayesiana" class="callout-inner">
<h3 class="callout-title">Inferencia bayesiana</h3>
<div class="callout-content">
<p>El paquete R <code>EpiNow2</code> utiliza <a href="reference.html#bayesian">inferencia bayesiana</a> para estimar las
cifras de reproducción y los tiempos de infección basándose en las
fechas de notificación.</p>
<p>En la inferencia bayesiana, utilizamos el conocimiento previo
(distribuciones previas) con los datos (en una función de verosimilitud)
para hallar la probabilidad posterior.</p>
<p class="text-center" style="background-color: white">
Probabilidad posterior <span class="math inline">\(\propto\)</span>
verosimilitud <span class="math inline">\(\times\)</span> probabilidad
previa
</p>
</div>
</div>
</div>

</section><section><h2 class="section-heading" id="distribuciones-de-retrasos-y-datos-de-casos">Distribuciones de retrasos y datos de casos<a class="anchor" aria-label="anchor" href="#distribuciones-de-retrasos-y-datos-de-casos"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="datos-de-casos">Datos de casos<a class="anchor" aria-label="anchor" href="#datos-de-casos"></a>
</h3>
<p>Para explorar las funciones de <code>EpiNow2</code> utilizaremos los
datos del brote del inicio de la pandemia COVID-19 del Reino Unido. Los
datos están disponibles en el paquete R <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a>.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6,370 × 13
   date       region   region_code cases_new cases_total deaths_new deaths_total
   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
 1 2020-01-30 East Mi… E12000004          NA          NA         NA           NA
 2 2020-01-30 East of… E12000006          NA          NA         NA           NA
 3 2020-01-30 England  E92000001           2           2         NA           NA
 4 2020-01-30 London   E12000007          NA          NA         NA           NA
 5 2020-01-30 North E… E12000001          NA          NA         NA           NA
 6 2020-01-30 North W… E12000002          NA          NA         NA           NA
 7 2020-01-30 Norther… N92000002          NA          NA         NA           NA
 8 2020-01-30 Scotland S92000003          NA          NA         NA           NA
 9 2020-01-30 South E… E12000008          NA          NA         NA           NA
10 2020-01-30 South W… E12000009          NA          NA         NA           NA
# ℹ 6,360 more rows
# ℹ 6 more variables: recovered_new &lt;dbl&gt;, recovered_total &lt;dbl&gt;,
#   hosp_new &lt;dbl&gt;, hosp_total &lt;dbl&gt;, tested_new &lt;dbl&gt;, tested_total &lt;dbl&gt;</code></pre>
</div>
<p>Para utilizar los datos, debemos darles formato para que tengan dos
columnas:</p>
<ul>
<li>
<code>date</code>: la fecha (para validar si un objeto es de tipo
fecha ver <code>?is.Date()</code>),</li>
<li>
<code>confirm</code> número de casos confirmados en esa fecha.</li>
</ul>
<p>Utilicemos <a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> y <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> para
ello:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {tidyr} to preprocess missing values</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>cases_new <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {incidence2} to compute the daily incidence</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span></span>
<span>    date_index <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    counts <span class="op">=</span> <span class="st">"cases_new"</span>,</span>
<span>    count_values_to <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>    date_names_to <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    complete_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">count_variable</span><span class="op">)</span></span></code></pre>
</div>
<p>Con <code>incidence2::incidence()</code> agregamos casos en distintos
tiempos <em>intervalos</em> (es decir, días, semanas o meses) o por
<em>grupo</em> categorías. También podemos tener fechas completas para
todo el rango de fechas por categoría de grupo utilizando
<code>complete_dates = TRUE</code> Explora más adelante la <a href="https://www.reconverse.org/incidence2/reference/incidence.html" class="external-link"><code>incidence2::incidence()</code>
manual de referencia</a></p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> ¿Podemos replicar {incidence2} con {dplyr}? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>Podemos obtener un objeto similar a <code>cases</code> de la tabla de
datos (<code>data.frame</code>)
<code>incidence2::covidregionaldataUK</code> utilizando las siguientes
funciones del paquete <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">cases_new</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">summarise</span><span class="op">(</span>confirm <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">cases_new</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Sin embargo, la función <code>incidence2::incidence()</code> contiene
argumentos prácticos como <code>complete_dates</code> que facilitan la
obtención de un objeto de incidencia con el mismo rango de fechas para
cada agrupación sin necesidad de líneas de código adicionales ni de un
paquete de series temporales.</p>
</div>
</div>
</div>
</div>
<p>Hay datos de casos disponibles para 490 días, pero en una situación
de brote es probable que sólo tuviéramos acceso al principio de este
conjunto de datos. Por lo tanto, suponemos que sólo disponemos de los
primeros 90 días de estos datos.</p>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
<div class="section level3">
<h3 id="distribuciones-de-retraso">Distribuciones de retraso<a class="anchor" aria-label="anchor" href="#distribuciones-de-retraso"></a>
</h3>
<p>Suponemos que hay retrasos desde el momento de la infección hasta el
momento en que se notifica un caso. Especificamos estos retrasos como
distribuciones para tener en cuenta la incertidumbre en las diferencias
a nivel individual. El retraso puede consistir en múltiples tipos de
retrasos/procesos. Un retraso típico desde el momento de la infección
hasta la notificación del caso puede consistir en:</p>
<p><strong>tiempo desde la infección hasta la aparición de los
síntomas</strong> (el <a href="reference.html#incubation">período de
incubación</a>) + <strong>tiempo desde el inicio de los síntomas hasta
la notificación del caso</strong> (el tiempo de notificación).</p>
<p>La distribución del retraso para cada uno de estos procesos puede
estimarse a partir de los datos u obtenerse de la bibliografía. Podemos
expresar la incertidumbre sobre cuáles son los parámetros correctos de
las distribuciones, suponiendo que las distribuciones tienen parámetros
<strong>fijos</strong> (<code>_fixed</code>) o si tienen parámetros
<strong>variables</strong> (<code>_variable</code>). Para entender la
diferencia entre distribuciones <strong>fijas</strong> y
<strong>variables</strong>, consideremos el periodo de incubación.</p>
<div id="retrasos-y-datos" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="retrasos-y-datos" class="callout-inner">
<h3 class="callout-title">Retrasos y datos</h3>
<div class="callout-content">
<p>El número de retrasos y su tipo son una entrada flexible que depende
de los datos. Los siguientes ejemplos muestran cómo se pueden
especificar los retrasos para distintas fuentes de datos:</p>
<center>
<table class="table">
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Fuente de datos</th>
<th>Retraso(s)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Hora de inicio de los síntomas</td>
<td>Periodo de incubación</td>
</tr>
<tr class="even">
<td>Hora del informe del caso</td>
<td>Periodo de incubación + tiempo desde el inicio de los síntomas hasta
la notificación del caso</td>
</tr>
<tr class="odd">
<td>Tiempo de hospitalización</td>
<td>Periodo de incubación + tiempo desde el inicio de los síntomas hasta
la hospitalización</td>
</tr>
</tbody>
</table>
</center>
</div>
</div>
</div>
<div class="section level4">
<h4 id="distribución-del-periodo-de-incubación">Distribución del periodo de incubación<a class="anchor" aria-label="anchor" href="#distribuci%C3%B3n-del-periodo-de-incubaci%C3%B3n"></a>
</h4>
<p>La distribución del periodo de incubación de muchas enfermedades
suele obtenerse de la bibliografía. El paquete
<code>{epiparameter}</code> contiene una biblioteca de parámetros
epidemiológicos de distintas enfermedades obtenidos de la
literatura.</p>
<p>Especificamos una distribución gamma (fija) con media <span class="math inline">\(\mu = 4\)</span> y desviación típica <span class="math inline">\(\sigma= 2\)</span> (forma = <span class="math inline">\(4\)</span>, escala = <span class="math inline">\(1\)</span>) mediante la función
<code>Gamma()</code> de la siguiente manera:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incubation_period_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">incubation_period_fixed</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- gamma distribution (max: 20):
  shape:
    4
  rate:
    1</code></pre>
</div>
<p>El argumento <code>max</code> es el valor máximo que puede tomar la
distribución, en este ejemplo 20 días.</p>
<div id="por-qué-una-distribución-gamma" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="por-qué-una-distribución-gamma" class="callout-inner">
<h3 class="callout-title">¿Por qué una distribución gamma?</h3>
<div class="callout-content">
<p>El periodo de incubación debe tener un valor positivo. Por lo tanto,
tenemos que especificar una distribución en <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> que
sea sólo para valores positivos.</p>
<p><code>Gamma()</code> admite distribuciones Gamma y
<code>LogNormal()</code> Distribuciones logarítmicas normales, que son
distribuciones sólo para valores positivos.</p>
<p>Para todos los tipos de retraso, tendremos que utilizar
distribuciones sólo para valores positivos: ¡no queremos incluir
retrasos de días negativos en nuestro análisis!</p>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="incluyendo-la-incertidumbre-de-distribución">Incluyendo la incertidumbre de distribución<a class="anchor" aria-label="anchor" href="#incluyendo-la-incertidumbre-de-distribuci%C3%B3n"></a>
</h4>
<p>Para especificar una distribución <strong>variable</strong>,
incluimos la incertidumbre en torno a la media <span class="math inline">\(\mu\)</span> y la desviación típica <span class="math inline">\(\sigma\)</span> de nuestra distribución gamma. Si
nuestra distribución del periodo de incubación tiene una media <span class="math inline">\(\mu\)</span> y una desviación típica <span class="math inline">\(\sigma\)</span> entonces suponemos que la media
(<span class="math inline">\(\mu\)</span>) sigue una distribución Normal
con desviación típica <span class="math inline">\(\sigma_{\mu}\)</span>:</p>
<p><span class="math display">\[\mbox{Normal}(\mu,\sigma_{\mu}^2)\]</span></p>
<p>y una desviación típica (<span class="math inline">\(\sigma\)</span>)
sigue una distribución Normal con desviación típica <span class="math inline">\(\sigma_{\sigma}\)</span>:</p>
<p><span class="math display">\[\mbox{Normal}(\sigma,\sigma_{\sigma}^2).\]</span></p>
<p>Lo especificamos utilizando <code>Normal()</code> para cada
argumento: la media (<span class="math inline">\(\mu=4\)</span> con
<span class="math inline">\(\sigma_{\mu}=0.5\)</span>) y la desviación
típica (<span class="math inline">\(\sigma=2\)</span> con <span class="math inline">\(\sigma_{\sigma}=0.5\)</span>).</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incubation_period_variable</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">incubation_period_variable</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- gamma distribution (max: 20):
  shape:
    - normal distribution:
      mean:
        4
      sd:
        0.61
  rate:
    - normal distribution:
      mean:
        1
      sd:
        0.31</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="retrasos-en-los-informes">Retrasos en los informes<a class="anchor" aria-label="anchor" href="#retrasos-en-los-informes"></a>
</h4>
<p>Tras el periodo de incubación, habrá un retraso adicional desde el
inicio de los síntomas hasta la notificación del caso: el retraso de
notificación. Podemos especificarlo como una distribución fija o
variable, o estimar una distribución a partir de los datos.</p>
<p>Al especificar una distribución, es útil visualizar la densidad de
probabilidad para ver el pico y la dispersión de la distribución, en
este caso utilizaremos una <em>log normal</em> logarítmica normal.
Podemos utilizar las funciones <code>convert_to_logmean()</code> y
<code>convert_to_logsd()</code> para convertir la media y la desviación
típica de una distribución normal en las de una distribución logarítmica
normal.</p>
<p>Si queremos suponer que la media del retraso en la notificación es de
2 días (con una desviación típica de 1 día), escribimos:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtener logmean a partir de la media y sd</span></span>
<span><span class="va">log_mean</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logmean</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtener logsd a partir de la media y sd</span></span>
<span><span class="va">log_sd</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logsd</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Visualiza una distribución log Normal utilizando {epiparameter} </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<p>Utilizando <code>epiparameter::epidist()</code> podemos crear una
distribución personalizada. La distribución log normal tendrá el
siguiente aspecto:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"reporting delay"</span>, <span class="co"># retraso del reporte</span></span>
<span>  prob_distribution <span class="op">=</span> <span class="st">"lnorm"</span>,</span>
<span>  prob_distribution_params <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>    meanlog <span class="op">=</span> <span class="va">log_mean</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">log_sd</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>Utilizando la media y la desviación típica de la distribución log
normal, podemos especificar una distribución fija o variable utilizando
<code>LogNormal()</code> como antes:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reporting_delay_variable</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">log_mean</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">log_sd</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Podemos trazar distribuciones simples y combinadas generadas por
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> utilizando <code>plot()</code>. Combinemos en un
gráfico el retraso desde la infección hasta la notificación, que incluye
el periodo de incubación y el retraso en la notificación:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">incubation_period_variable</span> <span class="op">+</span> <span class="va">reporting_delay_variable</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="callout5" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aviso</h3>
<div class="callout-content">
<p>Si disponemos de datos sobre el tiempo transcurrido entre el inicio
de los síntomas y la notificación, podemos utilizar la función
<code>estimate_delay()</code> para estimar una distribución log normal a
partir de un vector de retrasos. El siguiente código muestra cómo
utilizar <code>estimate_delay()</code> con datos sintéticos de
retrasos.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delay_data</span> <span class="op">&lt;-</span> <span class="fu">rlnorm</span><span class="op">(</span><span class="fl">500</span>, <span class="fu">log</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># datos de retraso sintéticos</span></span>
<span></span>
<span><span class="va">reporting_delay</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">estimate_delay</span><span class="op">(</span></span>
<span>  <span class="va">delay_data</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  bootstraps <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="tiempo-de-generación">Tiempo de generación<a class="anchor" aria-label="anchor" href="#tiempo-de-generaci%C3%B3n"></a>
</h4>
<p>También debemos especificar una distribución para el tiempo de
generación. Aquí utilizaremos una distribución log normal con media 3.6
y desviación típica 3.1 (<a href="https://doi.org/10.2807/1560-7917.ES.2020.25.17.2000257" class="external-link">Ganyani
et al. 2020</a>).</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time_variable</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">3.6</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">3.1</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="estimaciones-de-hallazgos">Estimaciones de hallazgos<a class="anchor" aria-label="anchor" href="#estimaciones-de-hallazgos"></a>
</h2>
<hr class="half-width">
<p>La función <code>epinow()</code> es una envoltura de la función
<code>estimate_infections()</code> utilizada para estimar los casos por
fecha de infección. La distribución del tiempo de generación y las
distribuciones del retraso deben pasarse utilizando las funciones
<code>generation_time_opts()</code> y <code>delay_opts()</code>
respectivamente.</p>
<p>Hay muchas otras entradas que se pueden pasar a <code>epinow()</code>
ver <code>?EpiNow2::epinow()</code> para más detalles. Una entrada
opcional es especificar una <em>log normal</em> para el número de
reproducción efectivo <span class="math inline">\(R_t\)</span> al inicio
del brote. Especificamos una media de 2 días y una desviación típica de
2 días como argumentos de <code>prior</code> dentro de
<code>rt_opts()</code>:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define Rt prior distribution</span></span>
<span><span class="va">rt_prior</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">rt_opts</span><span class="op">(</span>prior <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div id="inferencia-bayesiana-con-stan" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="inferencia-bayesiana-con-stan" class="callout-inner">
<h3 class="callout-title">Inferencia bayesiana con Stan</h3>
<div class="callout-content">
<p>La inferencia bayesiana se realiza utilizando métodos MCMC con el
programa <a href="https://mc-stan.org/" class="external-link">Stan</a>. Hay una serie de
entradas por defecto para las funciones Stan, incluido el número de
cadenas y el número de muestras por cadena (ver
<code>?EpiNow2::stan_opts()</code>).</p>
<p>Para reducir el tiempo de cálculo, podemos ejecutar las cadenas en
paralelo. Para ello, debemos establecer el número de núcleos que se van
a utilizar. Por defecto, se ejecutan 4 cadenas MCMC (ver
<code>stan_opts()$chains</code>), por lo que podemos establecer un
número igual de núcleos para que se utilicen en paralelo de la siguiente
manera:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu">local_options</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Para averiguar el número máximo de núcleos disponibles en tu máquina,
utiliza <code>parallel::detectCores()</code>.</p>
</div>
</div>
</div>
<div id="checklist2" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Lista de verificación</h3>
<div class="callout-content">
<p><strong>Nota:</strong> En el siguiente código <code>_fixed</code> se
utilizan distribuciones en lugar de <code>_variable</code>
(distribuciones de retraso con incertidumbre). Esto se hace para
acelerar el tiempo de cálculo. En general, se recomienda utilizar
distribuciones variables que tengan en cuenta la incertidumbre
adicional.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># alternativas: distribuciones con parámetros fijos</span></span>
<span><span class="va">generation_time_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">3.6</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">3.1</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">reporting_delay_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="va">log_mean</span>,</span>
<span>  sd <span class="op">=</span> <span class="va">log_sd</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Ahora estás listo para ejecutar <code>EpiNow2::epinow()</code> para
estimar el número de reproducción variable en el tiempo durante los
primeros 90 días:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># casos</span></span>
<span>  data <span class="op">=</span> <span class="va">reported_cases</span>,</span>
<span>  <span class="co"># retrasos</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  <span class="co"># prior</span></span>
<span>  rt <span class="op">=</span> <span class="va">rt_prior</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 01:26:57] epinow: There were 12 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 01:26:57] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<!-- ```{r, mensaje = FALSE,advertencia=FALSE, eval = TRUE, echo=FALSE} -->
<!-- estimaciones <- EpiNow2::epinow( -->
<!-- # casos -->
<!-- datos = casos_informados, -->
<!-- # retrasos -->
<!-- tiempo_de_generación = EpiNow2::tiempo_de_generación_opts(tiempo_de_generación_fijo), -->
<!-- retrasos = EpiNow2::retraso_opts(periodo_de_incubación_fijo + retraso_de_informe_fijo), -->
<!-- # anterior -->
<!-- rt = rt_previo, -->
<!-- stan = EpiNow2::stan_opts(method = "vb") -->
<!-- ) -->
<!-- ``` -->
<div id="no-esperes-a-que-esto-continúe" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="no-esperes-a-que-esto-continúe" class="callout-inner">
<h3 class="callout-title">No esperes a que esto continúe</h3>
<div class="callout-content">
<p>Para efectos de este tutorial, podemos utilizar opcionalmente
<code>EpiNow2::stan_opts()</code> para reducir el tiempo de cálculo.
Podemos especificar un número fijo de <code>samples = 1000</code> y
<code>chains = 3</code> al argumento <code>stan</code> de la función
<code>EpiNow2::epinow()</code>. Esperamos que esto lleve aproximadamente
3 minutos.</p>
<!-- Podemos establecer opcionalmente `stan = stan_opts(method = "vb")` para utilizar un método de muestreo aproximado. Esperamos que tarde menos de 1 minuto. -->
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># puedes adicionar el argumento `stan`</span></span>
<span><span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">stan_opts</span><span class="op">(</span>samples <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Recuerda:</strong> Utilizar un número adecuado de
<em>muestras</em> y <em>cadenas</em> es crucial para garantizar la
convergencia y obtener estimaciones fiables en los cálculos bayesianos
con Stan. Los resultados más precisos se obtienen a costa de la
velocidad.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="resultados">Resultados<a class="anchor" aria-label="anchor" href="#resultados"></a>
</h3>
<p>Podemos extraer y visualizar estimaciones del número de reproducción
efectivo a lo largo del tiempo:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">R</span></span></code></pre>
</div>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-19-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>La incertidumbre de las estimaciones aumenta con el tiempo. Esto se
debe a que las estimaciones se basan en datos del pasado, dentro de los
periodos de retraso. Esta diferencia de incertidumbre se clasifica en
<strong>Estimación</strong> (verde) utiliza todos los datos y
<strong>Estimación basada en datos parciales</strong> (naranja)
estimaciones que se basan en menos datos (porque es más probable que las
infecciones que se produjeron en su momento no se hayan observado
todavía), por este motivo, tienen intervalos cada vez más amplios hacia
la fecha del último punto de datos. Por último, el
<strong>Pronóstico</strong> (morado) es una proyección a futuro.</p>
<p>También podemos visualizar la estimación de la tasa de crecimiento a
lo largo del tiempo:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">growth_rate</span></span></code></pre>
</div>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-20-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Para extraer un resumen de las métricas clave de transmisión en la
<em>última fecha</em> de los datos:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                            measure                estimate
                             &lt;char&gt;                  &lt;char&gt;
1:           New infections per day    6876 (3541 -- 12091)
2: Expected change in daily reports       Likely decreasing
3:       Effective reproduction no.      0.88 (0.57 -- 1.2)
4:                   Rate of growth -0.041 (-0.19 -- 0.092)
5:     Doubling/halving time (days)       -17 (7.5 -- -3.6)</code></pre>
</div>
<p>Como estas estimaciones se basan en datos parciales, tienen un amplio
intervalo de incertidumbre.</p>
<ul>
<li><p>Del resumen de nuestro análisis se desprende que el cambio
esperado en los casos diarios es de con la estimación de nuevos casos
confirmados .</p></li>
<li><p>El número de reproducción efectivo <span class="math inline">\(R_t\)</span> estimado (en la última fecha de los
datos) es 0.88 (0.57 – 1.2).</p></li>
<li><p>La tasa de crecimiento exponencial del número de casos es -0.041
(-0.19 – 0.092).</p></li>
<li><p>El tiempo de duplicación (el tiempo que tarda en duplicarse el
número de casos) es -17 (7.5 – -3.6).</p></li>
</ul>
<div id="expected-change-in-daily-cases" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="expected-change-in-daily-cases" class="callout-inner">
<h3 class="callout-title"><code>Expected change in daily cases</code></h3>
<div class="callout-content">
<p>Un factor que describe el cambio esperado en los casos diarios,
basado en la probabilidad posterior de que <span class="math inline">\(R_t &lt; 1\)</span>.</p>
<center>
<table class="table">
<thead><tr class="header">
<th>Probabilidad (<span class="math inline">\(p\)</span>)</th>
<th>Cambio esperado</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(p &lt; 0,05\)</span></td>
<td>Aumentando</td>
</tr>
<tr class="even">
<td><span class="math inline">\(0,05 \leq p&lt; 0,4\)</span></td>
<td>Probable aumento</td>
</tr>
<tr class="odd">
<td>0,4 p&lt; 0,6$ Estable</td>
<td></td>
</tr>
<tr class="even">
<td>0,6 p &lt; 0,95$ Probable disminución</td>
<td></td>
</tr>
<tr class="odd">
<td>0,95 p $</td>
<td>En disminución</td>
</tr>
</tbody>
</table>
</center>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="cuantificar-la-heterogeneidad-geográfica">Cuantificar la heterogeneidad geográfica<a class="anchor" aria-label="anchor" href="#cuantificar-la-heterogeneidad-geogr%C3%A1fica"></a>
</h2>
<hr class="half-width">
<p>Los datos del brote del inicio de la pandemia COVID-19 del Reino
Unido del paquete R <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> incluyen la región en la
que se registraron los casos. Para encontrar estimaciones regionales del
número de reproducción efectiva y de casos, debemos dar formato a los
datos para que tengan tres columnas:</p>
<ul>
<li>
<code>date</code>: la fecha.</li>
<li>
<code>region</code>: la región.</li>
<li>
<code>confirm</code>: número de casos confirmados para una región en
una fecha determinada.</li>
</ul>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_cases</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># usar {tidyr} para pre-procesar los valores faltantes</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>cases_new <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># usar {incidence2} para convertir datos agregados en datos de incidencia</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span></span>
<span>    date_index <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    groups <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>    counts <span class="op">=</span> <span class="st">"cases_new"</span>,</span>
<span>    count_values_to <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>    date_names_to <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    complete_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">count_variable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># mantener las primeras 90 fechas para todas las regiones</span></span>
<span></span>
<span><span class="co"># obtener el vector de las primeras 90 fechas</span></span>
<span><span class="va">date_range</span> <span class="op">&lt;-</span> <span class="va">regional_cases</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">distinct</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># desde {incidence2}, las fechas ya están ordenadas en orden ascendente</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">90</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">pull</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filtrar las fechas en la variable date_range</span></span>
<span><span class="va">regional_cases</span> <span class="op">&lt;-</span> <span class="va">regional_cases</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="fu">magrittr</span><span class="fu">::</span><span class="fu">is_in</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, table <span class="op">=</span> <span class="va">date_range</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="va">regional_cases</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,170 × 3
   date       region           confirm
   &lt;date&gt;     &lt;chr&gt;              &lt;dbl&gt;
 1 2020-01-30 East Midlands          0
 2 2020-01-30 East of England        0
 3 2020-01-30 England                2
 4 2020-01-30 London                 0
 5 2020-01-30 North East             0
 6 2020-01-30 North West             0
 7 2020-01-30 Northern Ireland       0
 8 2020-01-30 Scotland               0
 9 2020-01-30 South East             0
10 2020-01-30 South West             0
# ℹ 1,160 more rows</code></pre>
</div>
<p>Para hallar las estimaciones regionales, utilizamos los mismos datos
que <code>epinow()</code> para la función
<code>regional_epinow()</code>:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates_regional</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">regional_epinow</span><span class="op">(</span></span>
<span>  <span class="co"># casos</span></span>
<span>  data <span class="op">=</span> <span class="va">regional_cases</span>,</span>
<span>  <span class="co"># retrasos</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  <span class="co"># prior</span></span>
<span>  rt <span class="op">=</span> <span class="va">rt_prior</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO [2024-09-24 01:27:03] Producing following optional outputs: regions, summary, samples, plots, latest
INFO [2024-09-24 01:27:03] Reporting estimates using data up to: 2020-04-28
INFO [2024-09-24 01:27:03] No target directory specified so returning output
INFO [2024-09-24 01:27:03] Producing estimates for: East Midlands, East of England, England, London, North East, North West, Northern Ireland, Scotland, South East, South West, Wales, West Midlands, Yorkshire and The Humber
INFO [2024-09-24 01:27:03] Regions excluded: none
INFO [2024-09-24 02:21:40] Completed regional estimates
INFO [2024-09-24 02:21:40] Regions with estimates: 13
INFO [2024-09-24 02:21:40] Regions with runtime errors: 0
INFO [2024-09-24 02:21:40] Producing summary
INFO [2024-09-24 02:21:40] No summary directory specified so returning summary output
INFO [2024-09-24 02:21:40] No target directory specified so returning timings</code></pre>
</div>
<!-- ```{r, mensaje = FALSE,aviso=FALSE, eval = TRUE,echo=FALSE} -->
<!-- estima_regional <- EpiNow2::regional_epinow( -->
<!-- # casos -->
<!-- datos = casos_regionales, -->
<!-- # retrasos -->
<!-- tiempo_de_generación = EpiNow2::tiempo_de_generación_opts(tiempo_de_generación_fijo), -->
<!-- retrasos = EpiNow2::retraso_opts(periodo_de_incubación_fijo + retraso_de_informe_fijo), -->
<!-- # anterior -->
<!-- rt = rt_previo, -->
<!-- stan = EpiNow2::stan_opts(method = "vb") -->
<!-- ) -->
<!-- ``` -->
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates_regional</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">summarised_results</span><span class="op">$</span><span class="va">table</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                      Region New infections per day
                      &lt;char&gt;                 &lt;char&gt;
 1:            East Midlands       340 (196 -- 530)
 2:          East of England       497 (310 -- 775)
 3:                  England    3383 (2049 -- 5298)
 4:                   London       303 (196 -- 445)
 5:               North East       248 (139 -- 418)
 6:               North West       541 (317 -- 865)
 7:         Northern Ireland          42 (21 -- 85)
 8:                 Scotland       280 (143 -- 581)
 9:               South East       585 (368 -- 945)
10:               South West       423 (304 -- 600)
11:                    Wales         94 (62 -- 137)
12:            West Midlands       237 (128 -- 440)
13: Yorkshire and The Humber       462 (278 -- 741)
    Expected change in daily reports Effective reproduction no.
                              &lt;fctr&gt;                     &lt;char&gt;
 1:                Likely increasing           1.1 (0.8 -- 1.4)
 2:                           Stable            1 (0.77 -- 1.3)
 3:                Likely decreasing         0.89 (0.65 -- 1.2)
 4:                Likely decreasing         0.89 (0.68 -- 1.1)
 5:                Likely decreasing         0.92 (0.65 -- 1.2)
 6:                Likely decreasing         0.88 (0.63 -- 1.1)
 7:                Likely decreasing         0.76 (0.49 -- 1.2)
 8:                Likely decreasing         0.94 (0.61 -- 1.5)
 9:                           Stable         0.98 (0.73 -- 1.3)
10:                       Increasing             1.3 (1 -- 1.5)
11:                       Decreasing         0.71 (0.55 -- 0.9)
12:                Likely decreasing            0.7 (0.46 -- 1)
13:                Likely decreasing          0.95 (0.7 -- 1.2)
              Rate of growth Doubling/halving time (days)
                      &lt;char&gt;                       &lt;char&gt;
 1:   0.023 (-0.086 -- 0.11)               30 (6.2 -- -8)
 2: 0.00076 (-0.11 -- 0.095)            910 (7.3 -- -6.3)
 3:   -0.04 (-0.15 -- 0.066)             -18 (10 -- -4.6)
 4:   -0.03 (-0.12 -- 0.048)             -23 (14 -- -5.6)
 5:  -0.026 (-0.15 -- 0.088)            -27 (7.8 -- -4.8)
 6:  -0.041 (-0.15 -- 0.049)             -17 (14 -- -4.6)
 7:    -0.07 (-0.2 -- 0.091)           -9.9 (7.6 -- -3.4)
 8:   -0.014 (-0.16 -- 0.17)            -50 (4.2 -- -4.2)
 9:   -0.0077 (-0.12 -- 0.1)            -90 (6.7 -- -5.9)
10:  0.075 (-0.0042 -- 0.16)            9.2 (4.4 -- -170)
11: -0.09 (-0.17 -- -0.0092)             -7.7 (-75 -- -4)
12:   -0.11 (-0.25 -- 0.041)            -6.4 (17 -- -2.7)
13:  -0.023 (-0.14 -- 0.081)            -30 (8.6 -- -5.1)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates_regional</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">R</span></span></code></pre>
</div>
<figure><img src="fig/quantify-transmissibility-rendered-unnamed-chunk-24-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><!-- :::::::::::::::::::::::::: testimonial --><!-- ### el paquete i2extras --><!-- :::::::::::::::::::::::::: --></section><section><h2 class="section-heading" id="resumen">Resumen<a class="anchor" aria-label="anchor" href="#resumen"></a>
</h2>
<hr class="half-width">
<p><code>EpiNow2</code> puede utilizarse para estimar las métricas de
transmisión a partir de los datos de casos en cualquier momento del
curso de un brote. La fiabilidad de estas estimaciones depende de la
calidad de los datos y de la elección adecuada de las distribuciones de
retraso. En el siguiente tutorial aprenderemos a hacer previsiones e
investigaremos algunas de las opciones adicionales de inferencia
disponibles en <code>EpiNow2</code>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Las métricas de transmisión pueden estimarse a partir de los datos
del caso tras tener en cuenta los retrasos</li>
<li>La incertidumbre puede tenerse en cuenta en las distribuciones de
retrasos</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-delays-functions"><p>Content from <a href="delays-functions.html">Use delay distributions in analysis</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/delays-functions.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>How to reuse delays stored in the <code>{epiparameter}</code>
library with my existing analysis pipeline?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Use distribution functions to continuous and discrete distributions
stored as <code>&lt;epidist&gt;</code> objects.</li>
<li>Convert a continuous to a discrete distribution with
<code>{epiparameter}</code>.</li>
<li>Connect <code>{epiparameter}</code> outputs with
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> inputs.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<ul>
<li>Complete tutorial <a href="https://epiverse-trace.github.io/tutorials-middle/quantify-transmissibility.html" class="external-link">Quantifying
transmission</a>
</li>
</ul>
<p>This episode requires you to be familiar with:</p>
<p><strong>Data science</strong> : Basic programming with R.</p>
<p><strong>Statistics</strong> : Probability distributions.</p>
<p><strong>Epidemic theory</strong> : Epidemiological parameters, time
periods, Effective reproductive number.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<!-- to activate for EpiNow2@dist-interfase

:::::::::::::::::: callout

If we write the `[]` next to the last object create like in `covid_serialint_parameters[]`, within `[]` we can use the
Tab key <kbd>↹</kbd>
to use the [code completion feature](https://support.posit.co/hc/en-us/articles/205273297-Code-Completion-in-the-RStudio-IDE) and have a quick access to `covid_serialint_parameters["meanlog"]` and `covid_serialint_parameters["sdlog"]`. We invite you to try this out in code chunks and the R console!

::::::::::::::::::

--><p><code>{epiparameter}</code> help us to <em>choose</em> one specific
set of epidemiological parameters from the literature, instead of
copy/pasting them <em>by hand</em>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>    author <span class="op">=</span> <span class="st">"Nishiura"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Now, we have an epidemiological parameter we can use in our analysis!
In the chunk below we replaced one of the <strong>summary
statistics</strong> inputs into <code>EpiNow2::LogNormal()</code></p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generation_time</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="va">covid_serialint</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span>, <span class="co"># replaced!</span></span>
<span>    sd <span class="op">=</span> <span class="va">covid_serialint</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">sd</span>, <span class="co"># replaced!</span></span>
<span>    max <span class="op">=</span> <span class="fl">20</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>In this episode, we will use the <strong>distribution
functions</strong> that <code>{epiparameter}</code> provides to get a
maximum value (<code>max</code>) for this and any other package
downstream in your analysis pipeline!</p>
<p>Let’s load the <code>{epiparameter}</code> and <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>
package. For <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>, we’ll set 4 cores to be used in
parallel computations. We’ll use the pipe <code>%&gt;%</code>, some
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> verbs and <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>, so let’s also
call to the <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> package:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">EpiNow2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu">local_options</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-double-colon" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="the-double-colon" class="callout-inner">
<h3 class="callout-title">The double-colon</h3>
<div class="callout-content">
<p>The double-colon <code>::</code> in R let you call a specific
function from a package without loading the entire package into the
current environment.</p>
<p>For example, <code>dplyr::filter(data, condition)</code> uses
<code>filter()</code> from the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package.</p>
<p>This help us remember package functions and avoid namespace
conflicts.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="distribution-functions">Distribution functions<a class="anchor" aria-label="anchor" href="#distribution-functions"></a>
</h2>
<hr class="half-width">
<p>In R, all the statistical distributions have functions to access the
following:</p>
<ul>
<li>
<code>density()</code>: Probability <strong>Density</strong>
function (PDF),</li>
<li>
<code>cdf()</code>: Cumulative Distribution function
(<strong>CDF</strong>),</li>
<li>
<code>quantile()</code>: <strong>Quantile</strong> function,
and</li>
<li>
<code>generate()</code>: <strong>Random</strong> values from the
given distribution.</li>
</ul>
<div id="functions-for-the-normal-distribution" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="functions-for-the-normal-distribution" class="callout-inner">
<h3 class="callout-title">Functions for the Normal distribution</h3>
<div class="callout-content">
<p>If you need it, read in detail about the <a href="https://sakai.unc.edu/access/content/group/3d1eb92e-7848-4f55-90c3-7c72a54e7e43/public/docs/lectures/lecture13.htm#probfunc" class="external-link">R
probability functions for the normal distribution</a>, each of its
definitions and identify in which part of a distribution they are
located!</p>
<figure><img src="fig/fig5a-normaldistribution.png" alt="The four probability functions for the normal distribution (Jack Weiss, 2012)" class="figure mx-auto d-block"><div class="figcaption">The four probability functions for the normal
distribution (<a href="https://sakai.unc.edu/access/content/group/3d1eb92e-7848-4f55-90c3-7c72a54e7e43/public/docs/lectures/lecture13.htm#probfunc" class="external-link">Jack
Weiss, 2012</a>)</div>
</figure>
</div>
</div>
</div>
<p>If you look at <code>?stats::Distributions</code>, each type of
distribution has a unique set of functions. However,
<code>{epiparameter}</code> gives you the same four functions to access
each of the values above for any <code>&lt;epidist&gt;</code> object you
want!</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot this to have a visual reference</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the density value at quantile value of 10 (days)</span></span>
<span><span class="fu">density</span><span class="op">(</span><span class="va">covid_serialint</span>, at <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.01911607</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the cumulative probability at quantile value of 10 (days)</span></span>
<span><span class="fu">cdf</span><span class="op">(</span><span class="va">covid_serialint</span>, q <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.9466605</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the quantile value (day) at a cumulative probability of 60%</span></span>
<span><span class="fu">quantile</span><span class="op">(</span><span class="va">covid_serialint</span>, p <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4.618906</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate 10 random values (days) given</span></span>
<span><span class="co"># the distribution family and its parameters</span></span>
<span><span class="fu">generate</span><span class="op">(</span><span class="va">covid_serialint</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1]  4.646816  6.465435  6.360476  5.804790 14.284979  1.903417  6.574491
 [8]  5.063605  3.588740  4.240636</code></pre>
</div>

<div id="window-for-contact-tracing-and-the-serial-interval" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="window-for-contact-tracing-and-the-serial-interval" class="callout-inner">
<h3 class="callout-title">Window for contact tracing and the serial interval</h3>
<div class="callout-content">
<p>The <strong>serial interval</strong> is important in the optimisation
of contact tracing since it provides a time window for the containment
of a disease spread (<a href="https://academic.oup.com/aje/article/158/11/1039/162725" class="external-link">Fine,
2003</a>). Depending on the serial interval, we can evaluate the need to
expand the number of days pre-onset to consider in the contact tracing
to include more backwards contacts (<a href="https://assets.publishing.service.gov.uk/media/61e9ab3f8fa8f50597fb3078/S0523_Oxford_-_Backwards_contact_tracing.pdf" class="external-link">Davis
et al., 2020</a>).</p>
<p>With the COVID-19 serial interval (<code>covid_serialint</code>)
calculate:</p>
<ul>
<li>How much more of the backward cases could be captured if the contact
tracing method considered contacts up to 6 days pre-onset compared to 2
days pre-onset?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Dar una pista </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>In Figure 5 from the <a href="https://sakai.unc.edu/access/content/group/3d1eb92e-7848-4f55-90c3-7c72a54e7e43/public/docs/lectures/lecture13.htm#probfunc" class="external-link">R
probability functions for the normal distribution</a>, the shadowed
section represents a cumulative probability of <code>0.997</code> for
the quantile value at <code>x = 2</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Mostrar la solución </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">covid_serialint</span>, q <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.1111729</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cdf</span><span class="op">(</span><span class="va">covid_serialint</span>, q <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.7623645</code></pre>
</div>
<p>Given the COVID-19 serial interval:</p>
<ul>
<li><p>A contact tracing method considering contacts up to 2 days
pre-onset will capture around 11.1% of backward cases.</p></li>
<li><p>If this period is extended to 6 days pre-onset, this could
include 76.2% of backward contacts.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> What if </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>If we exchange the question between days and cumulative probability
to:</p>
<ul>
<li>When considering secondary cases, how many days following the
symptom onset of primary cases can we expect 55% of symptom onset to
occur?</li>
</ul>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quantile</span><span class="op">(</span><span class="va">covid_serialint</span>, p <span class="op">=</span> <span class="fl">0.55</span><span class="op">)</span></span></code></pre>
</div>
<p>An interpretation could be:</p>
<ul>
<li>The 55% percent of the symptom onset of secondary cases will happen
after 4.2 days after the symptom onset of primary cases.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="discretise-a-continuous-distribution">Discretise a continuous distribution<a class="anchor" aria-label="anchor" href="#discretise-a-continuous-distribution"></a>
</h2>
<hr class="half-width">
<p>We are getting closer to the end! <code>EpiNow2::LogNormal()</code>
still needs a maximum value (<code>max</code>).</p>
<p>One way to do this is to get the quantile value for the
distribution’s 99th percentile or <code>0.99</code> cumulative
probability. For this, we need access to the set of distribution
functions for our <code>&lt;epidist&gt;</code> object.</p>
<p>We can use the set of distribution functions for a
<em>continuous</em> distribution (as above). However, these values will
be <em>continuous</em> numbers. We can <strong>discretise</strong> the
continuous distribution stored in our <code>&lt;epidist&gt;</code>
object to get discrete values from a continuous distribution.</p>
<p>When we <code>epiparameter::discretise()</code> the continuous
distribution we get a <strong>discrete</strong>(-ized) distribution:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint_discrete</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_serialint_discrete</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Disease: COVID-19
Pathogen: SARS-CoV-2
Epi Distribution: serial interval
Study: Nishiura H, Linton N, Akhmetzhanov A (2020). "Serial interval of novel
coronavirus (COVID-19) infections." _International Journal of
Infectious Diseases_. doi:10.1016/j.ijid.2020.02.060
&lt;https://doi.org/10.1016/j.ijid.2020.02.060&gt;.
Distribution: discrete lnorm
Parameters:
  meanlog: 1.386
  sdlog: 0.568</code></pre>
</div>
<p>We identify this change in the <code>Distribution:</code> output line
of the <code>&lt;epidist&gt;</code> object. Double check this line:</p>
<pre><code>Distribution: discrete lnorm</code></pre>
<p>While for a <strong>continuous</strong> distribution, we plot the
<em>Probability Density Function (PDF)</em>, for a
<strong>discrete</strong> distribution, we plot the <em>Probability Mass
Function (PMF)</em>:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># continuous</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># discrete</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint_discrete</span><span class="op">)</span></span></code></pre>
</div>
<p>To finally get a <code>max</code> value, let’s access the quantile
value of the 99th percentile or <code>0.99</code> probability of the
distribution with the <code>prob_dist$q</code> notation, similarly to
how we access the <code>summary_stats</code> values.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint_discrete_max</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">quantile</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></code></pre>
</div>
<div id="length-of-quarantine-and-incubation-period" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="length-of-quarantine-and-incubation-period" class="callout-inner">
<h3 class="callout-title">Length of quarantine and incubation period</h3>
<div class="callout-content">
<p>The <strong>incubation period</strong> distribution is a useful delay
to assess the length of active monitoring or quarantine (<a href="https://www.acpjournals.org/doi/10.7326/M20-0504" class="external-link">Lauer et al.,
2020</a>). Similarly, delays from symptom onset to recovery (or death)
will determine the required duration of health care and case isolation
(<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<p>Calculate:</p>
<ul>
<li>Within what exact time frame do 99% of individuals exhibiting
COVID-19 symptoms exhibit them after infection?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Dar una pista </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" data-bs-parent="#accordionHint2" aria-labelledby="headingHint2">
<div class="accordion-body">
<p>What delay distribution measures the time between infection and the
onset of symptoms?</p>
<p>The probability functions for <code>&lt;epidist&gt;</code>
<strong>discrete</strong> distributions are the same that we used for
the <em>continuous</em> ones!</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot to have a visual reference</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># density value at quantile value 10 (day)</span></span>
<span><span class="fu">density</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, at <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># cumulative probability at quantile value 10 (day)</span></span>
<span><span class="fu">cdf</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, q <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In what quantile value (days) do we have the 60% cumulative probability?</span></span>
<span><span class="fu">quantile</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, p <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate random values</span></span>
<span><span class="fu">generate</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Mostrar la solución </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_incubation</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"incubation"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Using Linton N, Kobayashi T, Yang Y, Hayashi K, Akhmetzhanov A, Jung S, Yuan
B, Kinoshita R, Nishiura H (2020). "Incubation Period and Other
Epidemiological Characteristics of 2019 Novel Coronavirus Infections
with Right Truncation: A Statistical Analysis of Publicly Available
Case Data." _Journal of Clinical Medicine_. doi:10.3390/jcm9020538
&lt;https://doi.org/10.3390/jcm9020538&gt;..
To retrieve the citation use the 'get_citation' function</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_incubation_discrete</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">covid_incubation</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">quantile</span><span class="op">(</span><span class="va">covid_incubation_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 19</code></pre>
</div>
<p>99% of those who develop COVID-19 symptoms will do so within 16 days
of infection.</p>
<p>Now, <em>Is this result expected in epidemiological terms?</em></p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> How to create a distribution plot? </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>From a maximum value with <code>quantile()</code>, we can create a
sequence of quantile values as a numeric vector and calculate
<code>density()</code> values for each:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a discrete distribution visualisation</span></span>
<span><span class="co"># from a maximum value from the distribution</span></span>
<span><span class="fu">quantile</span><span class="op">(</span><span class="va">covid_serialint_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># generate quantile values</span></span>
<span>  <span class="co"># as a sequence for each natural number</span></span>
<span>  <span class="fu">seq</span><span class="op">(</span><span class="fl">1L</span>, to <span class="op">=</span> <span class="va">.</span>, by <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># coerce numeric vector to data frame</span></span>
<span>  <span class="fu">as_tibble_col</span><span class="op">(</span>column_name <span class="op">=</span> <span class="st">"quantile_values"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    <span class="co"># calculate density values</span></span>
<span>    <span class="co"># for each quantile in the density function</span></span>
<span>    density_values <span class="op">=</span></span>
<span>      <span class="fu">density</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">covid_serialint_discrete</span>,</span>
<span>        at <span class="op">=</span> <span class="va">quantile_values</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># create plot</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>      y <span class="op">=</span> <span class="va">density_values</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-functions-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><strong>Remember:</strong> In infections with pre-symptomatic
transmission, serial intervals can have negative values (<a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext" class="external-link">Nishiura
et al., 2020</a>). When we use the <em>serial interval</em> to
approximate the <em>generation time</em> we need to make this
distribution with positive values only!</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="plug-in-epiparameter-to-epinow2">Plug-in <code>{epiparameter}</code> to <code>{EpiNow2}</code>
<a class="anchor" aria-label="anchor" href="#plug-in-epiparameter-to-epinow2"></a>
</h2>
<hr class="half-width">
<p>Now we can plug everything into the <code>EpiNow2::LogNormal()</code>
function!</p>
<ul>
<li>the <strong>summary statistics</strong> <code>mean</code> and
<code>sd</code> of the distribution,</li>
<li>a maximum value <code>max</code>,</li>
<li>the <code>distribution</code> name.</li>
</ul>
<p>When using <code>EpiNow2::LogNormal()</code> to define a <strong>log
normal</strong> distribution like the one in the
<code>covid_serialint</code> object we can specify the mean and sd as
parameters. Alternatively, to get the “natural” parameters for a log
normal distribution we can convert its summary statistics to
distribution parameters named <code>meanlog</code> and
<code>sdlog</code>. With <code>{epiparameter}</code> we can directly get
the <em>distribution parameters</em> using
<code>epiparameter::get_parameters()</code>:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_serialint_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span></code></pre>
</div>
<p>Then, we have:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">serial_interval_covid</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>    meanlog <span class="op">=</span> <span class="va">covid_serialint_parameters</span><span class="op">[</span><span class="st">"meanlog"</span><span class="op">]</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">covid_serialint_parameters</span><span class="op">[</span><span class="st">"sdlog"</span><span class="op">]</span>,</span>
<span>    max <span class="op">=</span> <span class="va">covid_serialint_discrete_max</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">serial_interval_covid</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- lognormal distribution (max: 14):
  meanlog:
    1.4
  sdlog:
    0.57</code></pre>
</div>
<p>Assuming a COVID-19 scenario, let’s use the first 60 days of the
<code>example_confirmed</code> data set from the <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>
package as <code>reported_cases</code> and the recently created
<code>serial_interval_covid</code> object as inputs to estimate the
time-varying reproduction number using
<code>EpiNow2::epinow()</code>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epinow_estimates_cg</span> <span class="op">&lt;-</span> <span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># cases</span></span>
<span>  data <span class="op">=</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span>,</span>
<span>  <span class="co"># delays</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">serial_interval_covid</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:23:47] epinow: There were 3 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:23:47] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">base</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">epinow_estimates_cg</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-functions-rendered-unnamed-chunk-16-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>plot()</code> output includes the estimated cases by date
of infection, which are reconstructed from the reported cases and
delays.</p>
<div id="warning" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="warning" class="callout-inner">
<h3 class="callout-title">Warning</h3>
<div class="callout-content">
<p>Using the serial interval instead of the generation time is an
alternative that can propagate bias in your estimates, even more so in
diseases with reported pre-symptomatic transmission. (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>)</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="adjusting-for-reporting-delays">Adjusting for reporting delays<a class="anchor" aria-label="anchor" href="#adjusting-for-reporting-delays"></a>
</h2>
<hr class="half-width">
<p>Estimating <span class="math inline">\(R_t\)</span> requires data on
the daily number of new infections. Due to lags in the development of
detectable viral loads, symptom onset, seeking care, and reporting,
these numbers are not readily available. All observations reflect
transmission events from some time in the past. In other words, if <span class="math inline">\(d\)</span> is the delay from infection to
observation, then observations at time <span class="math inline">\(t\)</span> inform <span class="math inline">\(R_{t−d}\)</span>, not <span class="math inline">\(R_t\)</span>. <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008409#sec007" class="external-link">(Gostic
et al., 2020)</a></p>
<figure><img src="fig/disease-reporting.jpg" alt="Timeline for chain of disease reporting, the Netherlands. Lab, laboratory; PHA, public health authority. From Marinović et al., 2015" class="figure mx-auto d-block"><div class="figcaption">
<strong>Timeline for chain of disease reporting,
the Netherlands.</strong> Lab, laboratory; PHA, public health authority.
From <a href="https://wwwnc.cdc.gov/eid/article/21/2/13-0504_article" class="external-link">Marinović
et al., 2015</a>
</div>
</figure><p>The <strong>delay distribution</strong> could be inferred jointly
with the underlying times of infection or estimated as the sum of the <a href="reference.html#incubation">incubation period</a> distribution and
the distribution of delays from symptom onset to observation from line
list data (<a href="reference.html#reportingdelay">reporting delay</a>).
For <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>, we can specify these two complementary delay
distributions in the <code>delays</code> argument.</p>
<figure><img src="fig/rt-adjusting-delays.png" alt="R_{t} is a measure of transmission at time t. Observations after time t must be adjusted. ICU, intensive care unit. From Gostic et al., 2020" class="figure mx-auto d-block"><div class="figcaption">
<strong><span class="math inline">\(R_{t}\)</span> is a measure of transmission at
time <span class="math inline">\(t\)</span>.</strong> Observations after
time <span class="math inline">\(t\)</span> must be adjusted. ICU,
intensive care unit. From <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008409#sec007" class="external-link">Gostic
et al., 2020</a>
</div>
</figure><div id="use-an-incubation-period-for-covid-19-to-estimate-rt" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="use-an-incubation-period-for-covid-19-to-estimate-rt" class="callout-inner">
<h3 class="callout-title">Use an incubation period for COVID-19 to estimate Rt</h3>
<div class="callout-content">
<p>Estimate the time-varying reproduction number for the first 60 days
of the <code>example_confirmed</code> data set from
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>. Access to an incubation period for COVID-19 from
<code>{epiparameter}</code> to use it as a reporting delay.</p>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Dar una pista </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" data-bs-parent="#accordionHint3" aria-labelledby="headingHint3">
<div class="accordion-body">
<p>Use the last <code>epinow()</code> calculation using the
<code>delays</code> argument and the <code>delay_opts()</code> helper
function.</p>
<p>The <code>delays</code> argument and the <code>delay_opts()</code>
helper function are analogous to the <code>generation_time</code>
argument and the <code>generation_time_opts()</code> helper
function.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epinow_estimates</span> <span class="op">&lt;-</span> <span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># cases</span></span>
<span>  reported_cases <span class="op">=</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span>,</span>
<span>  <span class="co"># delays</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">covid_serial_interval</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">covid_incubation_time</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Mostrar la solución </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generation time ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># get covid serial interval</span></span>
<span><span class="va">covid_serialint</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>    author <span class="op">=</span> <span class="st">"Nishiura"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># adapt epidist to epinow2</span></span>
<span><span class="va">covid_serialint_discrete_max</span> <span class="op">&lt;-</span> <span class="va">covid_serialint</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">quantile</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_serialint_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">covid_serialint</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_serial_interval</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>    meanlog <span class="op">=</span> <span class="va">covid_serialint_parameters</span><span class="op">[</span><span class="st">"meanlog"</span><span class="op">]</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">covid_serialint_parameters</span><span class="op">[</span><span class="st">"sdlog"</span><span class="op">]</span>,</span>
<span>    max <span class="op">=</span> <span class="va">covid_serialint_discrete_max</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># incubation time ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># get covid incubation period</span></span>
<span><span class="va">covid_incubation</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"incubation"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Natalie"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adapt epiparameter to epinow2</span></span>
<span><span class="va">covid_incubation_discrete_max</span> <span class="op">&lt;-</span> <span class="va">covid_incubation</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">quantile</span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_incubation_parameters</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">covid_incubation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_incubation_time</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>    meanlog <span class="op">=</span> <span class="va">covid_incubation_parameters</span><span class="op">[</span><span class="st">"meanlog"</span><span class="op">]</span>,</span>
<span>    sdlog <span class="op">=</span> <span class="va">covid_incubation_parameters</span><span class="op">[</span><span class="st">"sdlog"</span><span class="op">]</span>,</span>
<span>    max <span class="op">=</span> <span class="va">covid_incubation_discrete_max</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># epinow ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># run epinow</span></span>
<span><span class="va">epinow_estimates_cgi</span> <span class="op">&lt;-</span> <span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># cases</span></span>
<span>  data <span class="op">=</span> <span class="va">example_confirmed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span><span class="op">]</span>,</span>
<span>  <span class="co"># delays</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">covid_serial_interval</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">covid_incubation_time</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:25:34] epinow: There were 11 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:25:34] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">base</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">epinow_estimates_cgi</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-functions-rendered-unnamed-chunk-17-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Try to complement the <code>delays</code> argument with a reporting
delay like the <code>reporting_delay_fixed</code> object of the previous
episode.</p>
</div>
</div>
</div>
</div>
<div id="how-much-has-it-changed" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="how-much-has-it-changed" class="callout-inner">
<h3 class="callout-title">How much has it changed?</h3>
<div class="callout-content">
<p>After adding the incubation period, discuss:</p>
<ul>
<li>Does the trend of the model fit in the “Estimate” section
change?</li>
<li>Has the uncertainty changed?</li>
<li>How would you explain or interpret any of these changes?</li>
</ul>
<p>Compare all the <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> figures generated
previously.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="challenges">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a>
</h2>
<hr class="half-width">
<div id="a-code-completion-tip" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="a-code-completion-tip" class="callout-inner">
<h3 class="callout-title">A code completion tip</h3>
<div class="callout-content">
<p>If we write the <code>[]</code> next to the object
<code>covid_serialint_parameters[]</code>, within <code>[]</code> we can
use the Tab key <kbd>↹</kbd> for <a href="https://support.posit.co/hc/en-us/articles/205273297-Code-Completion-in-the-RStudio-IDE" class="external-link">code
completion feature</a></p>
<p>This gives quick access to
<code>covid_serialint_parameters["meanlog"]</code> and
<code>covid_serialint_parameters["sdlog"]</code>.</p>
<p>We invite you to try this out in code chunks and the R console!</p>
</div>
</div>
</div>
<div id="ebolas-effective-reproduction-number-adjusted-by-reporting-delays" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="ebolas-effective-reproduction-number-adjusted-by-reporting-delays" class="callout-inner">
<h3 class="callout-title">Ebola’s effective reproduction number adjusted by reporting delays</h3>
<div class="callout-content">
<p>Download and read the <a href="data/ebola_cases.csv">Ebola
dataset</a>:</p>
<ul>
<li>Estimate the effective reproduction number using
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>
</li>
<li>Adjust the estimate by the available reporting delays in
<code>{epiparameter}</code>
</li>
<li>Why did you choose that parameter?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Dar una pista </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" data-bs-parent="#accordionHint4" aria-labelledby="headingHint4">
<div class="accordion-body">
<p>To calculate the <span class="math inline">\(R_t\)</span> using
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>, we need:</p>
<ul>
<li>Aggregated incidence <code>data</code>, with confirmed cases per
day, and</li>
<li>The <code>generation</code> time distribution.</li>
<li>Optionally, reporting <code>delays</code> distributions when
available (e.g., incubation period).</li>
</ul>
<p>To get delay distribution using <code>{epiparameter}</code> we can
use functions like:</p>
<ul>
<li><code>epiparameter::epidist_db()</code></li>
<li><code>epiparameter::parameter_tbl()</code></li>
<li><code>discretise()</code></li>
<li><code>quantile()</code></li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Mostrar la solución </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read data</span></span>
<span><span class="co"># e.g.: if path to file is data/raw-data/ebola_cases.csv then:</span></span>
<span><span class="va">ebola_confirmed</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw-data"</span>, <span class="st">"ebola_cases.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list distributions</span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span>disease <span class="op">=</span> <span class="st">"ebola"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generation time ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># subset one distribution for the generation time</span></span>
<span><span class="va">ebola_serial</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adapt epiparameter to epinow2</span></span>
<span><span class="va">ebola_serial_discrete</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">ebola_serial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">serial_interval_ebola</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="va">ebola_serial</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    sd <span class="op">=</span> <span class="va">ebola_serial</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">sd</span>,</span>
<span>    max <span class="op">=</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">ebola_serial_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># incubation time ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># subset one distribution for delay of the incubation period</span></span>
<span><span class="va">ebola_incubation</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"incubation"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adapt epiparameter to epinow2</span></span>
<span><span class="va">ebola_incubation_discrete</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">ebola_incubation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">incubation_period_ebola</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="va">ebola_incubation</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    sd <span class="op">=</span> <span class="va">ebola_incubation</span><span class="op">$</span><span class="va">summary_stats</span><span class="op">$</span><span class="va">sd</span>,</span>
<span>    max <span class="op">=</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">ebola_serial_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># epinow ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># run epinow</span></span>
<span><span class="va">epinow_estimates_egi</span> <span class="op">&lt;-</span> <span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># cases</span></span>
<span>  data <span class="op">=</span> <span class="va">ebola_confirmed</span>,</span>
<span>  <span class="co"># delays</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">serial_interval_ebola</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_ebola</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:28:18] epinow: There were 3 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:28:18] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">epinow_estimates_egi</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-functions-rendered-unnamed-chunk-20-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="what-to-do-with-weibull-distributions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-to-do-with-weibull-distributions" class="callout-inner">
<h3 class="callout-title">What to do with Weibull distributions?</h3>
<div class="callout-content">
<p>Use the <code>influenza_england_1978_school</code> dataset from the
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> package to calculate the effective reproduction
number using <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> adjusting by the available reporting
delays in <code>{epiparameter}</code>.</p>
</div>
</div>
</div>
<div id="accordionHint5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint5" aria-expanded="false" aria-controls="collapseHint5">
  <h4 class="accordion-header" id="headingHint5"> Dar una pista </h4>
</button>
<div id="collapseHint5" class="accordion-collapse collapse" data-bs-parent="#accordionHint5" aria-labelledby="headingHint5">
<div class="accordion-body">
<p><code>EpiNow2::NonParametric()</code> accepts Probability Mass
Functions (PMF) from any distribution family. Read the reference guide
on <a href="https://epiforecasts.io/EpiNow2/reference/Distributions.html" class="external-link">Probability
distributions</a>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Mostrar la solución </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># What parameters are available for Influenza?</span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span>disease <span class="op">=</span> <span class="st">"influenza"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">epi_distribution</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    3 × 2
  epi_distribution      n
  &lt;chr&gt;             &lt;int&gt;
1 generation time       1
2 incubation period    15
3 serial interval       1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generation time ---------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Read the generation time</span></span>
<span><span class="va">influenza_generation</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"influenza"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"generation"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_generation</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Disease: Influenza
Pathogen: Influenza-A-H1N1
Epi Distribution: generation time
Study: Lessler J, Reich N, Cummings D, New York City Department of Health and
Mental Hygiene Swine Influenza Investigation Team (2009). "Outbreak of
2009 Pandemic Influenza A (H1N1) at a New York City School." _The New
England Journal of Medicine_. doi:10.1056/NEJMoa0906089
&lt;https://doi.org/10.1056/NEJMoa0906089&gt;.
Distribution: weibull
Parameters:
  shape: 2.360
  scale: 3.180</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># EpiNow2 currently accepts Gamma or LogNormal</span></span>
<span><span class="co"># other can pass the PMF function</span></span>
<span></span>
<span><span class="va">influenza_generation_discrete</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">influenza_generation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_generation_max</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">quantile</span><span class="op">(</span><span class="va">influenza_generation_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_generation_pmf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">density</span><span class="op">(</span></span>
<span>    <span class="va">influenza_generation_discrete</span>,</span>
<span>    at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">influenza_generation_max</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_generation_pmf</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.06312336 0.22134988 0.29721220 0.23896828 0.12485164 0.04309454</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># EpiNow2::NonParametric() can also accept the PMF values</span></span>
<span><span class="va">generation_time_influenza</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">NonParametric</span><span class="op">(</span></span>
<span>    pmf <span class="op">=</span> <span class="va">influenza_generation_pmf</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># incubation period -------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Read the incubation period</span></span>
<span><span class="va">influenza_incubation</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"influenza"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"incubation"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Discretize incubation period</span></span>
<span><span class="va">influenza_incubation_discrete</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">discretise</span><span class="op">(</span><span class="va">influenza_incubation</span><span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_incubation_max</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">quantile</span><span class="op">(</span><span class="va">influenza_incubation_discrete</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_incubation_pmf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">density</span><span class="op">(</span></span>
<span>    <span class="va">influenza_incubation_discrete</span>,</span>
<span>    at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">influenza_incubation_max</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">influenza_incubation_pmf</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.05749151 0.16687705 0.22443092 0.21507632 0.16104546 0.09746609 0.04841928</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># EpiNow2::NonParametric() can also accept the PMF values</span></span>
<span><span class="va">incubation_time_influenza</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">NonParametric</span><span class="op">(</span></span>
<span>    pmf <span class="op">=</span> <span class="va">influenza_incubation_pmf</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># epinow ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Read data</span></span>
<span><span class="va">influenza_cleaned</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">outbreaks</span><span class="fu">::</span><span class="va">influenza_england_1978_school</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, confirm <span class="op">=</span> <span class="va">in_bed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run epinow()</span></span>
<span><span class="va">epinow_estimates_igi</span> <span class="op">&lt;-</span> <span class="fu">epinow</span><span class="op">(</span></span>
<span>  <span class="co"># cases</span></span>
<span>  data <span class="op">=</span> <span class="va">influenza_cleaned</span>,</span>
<span>  <span class="co"># delays</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_influenza</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_time_influenza</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:28:26] epinow: There were 2 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:28:26] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">epinow_estimates_igi</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/delays-functions-rendered-unnamed-chunk-21-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<hr class="half-width">
<div id="how-to-get-distribution-parameters-from-statistical-distributions" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="how-to-get-distribution-parameters-from-statistical-distributions" class="callout-inner">
<h3 class="callout-title">How to get distribution parameters from statistical distributions?</h3>
<div class="callout-content">
<p>How to get the mean and standard deviation from a generation time
with <em>only</em> distribution parameters but no summary statistics
like <code>mean</code> or <code>sd</code> for
<code>EpiNow2::Gamma()</code> or <code>EpiNow2::LogNormal()</code>?</p>
<p>Look at the <code>{epiparameter}</code> vignette on <a href="https://epiverse-trace.github.io/epiparameter/articles/extract_convert.html" class="external-link">parameter
extraction and conversion</a> and its <a href="https://epiverse-trace.github.io/epiparameter/articles/extract_convert.html#use-cases" class="external-link">use
cases</a>!</p>
</div>
</div>
</div>
<div id="how-to-estimate-delay-distributions-for-disease-x" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="how-to-estimate-delay-distributions-for-disease-x" class="callout-inner">
<h3 class="callout-title">How to estimate delay distributions for Disease X?</h3>
<div class="callout-content">
<p>Refer to this excellent tutorial on estimating the serial interval
and incubation period of Disease X accounting for <em>censoring</em>
using Bayesian inference with packages like <a href="https://mc-stan.org/rstan/" class="external-link">rstan</a> and
<a href="https://cran.r-project.org/package=coarseDataTools" class="external-link">coarseDataTools</a>.</p>
<ul>
<li>Tutorial in English: <a href="https://rpubs.com/tracelac/diseaseX" class="external-link uri">https://rpubs.com/tracelac/diseaseX</a>
<!-- to request -->
</li>
<li>Tutorial en Español: <a href="https://epiverse-trace.github.io/epimodelac/EnfermedadX.html" class="external-link uri">https://epiverse-trace.github.io/epimodelac/EnfermedadX.html</a>
</li>
</ul>
<p><strong>Then,</strong> after you get your estimated values, you can
manually create your own<code>&lt;epidist&gt;</code> class objects with
<code>epiparameter::epidist()</code>! Take a look at its <a href="https://epiverse-trace.github.io/epiparameter/reference/epidist.html#ref-examples" class="external-link">reference
guide on “Create an <code>&lt;epidist&gt;</code> object”</a>!</p>
<p>Lastly, take a look at the latest <a href="https://epidist.epinowcast.org/" class="external-link"><code>{epidist}</code> R
package</a> which provide methods to address key challenges in
estimating distributions, including truncation, interval censoring, and
dynamical biases.</p>
</div>
</div>
</div>
<!--
## Concept map

update it from last epiparameter test
-->
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Use distribution functions with <code>&lt;epidist&gt;</code> objects
to get summary statistics and informative parameters for public health
interventions like the Window for contact tracing and Length of
quarantine.</li>
<li>Use <code>discretise()</code> to convert continuous to discrete
delay distributions.</li>
<li>Use <code>{epiparameter}</code> to get reporting delays required in
transmissibility estimates.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-create-forecast"><p>Content from <a href="create-forecast.html">Crear una previsión a corto plazo</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/create-forecast.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>¿Cómo puedo crear previsiones a corto plazo a partir de datos de
casos?</li>
<li>¿Cómo tengo en cuenta los informes incompletos en las
previsiones?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Aprender a hacer previsiones de casos utilizando el paquete R
<code>EpiNow2</code>
</li>
<li>Aprende a incluir un proceso de observación en la estimación</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="requisitos-previos" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="requisitos-previos" class="callout-inner">
<h3 class="callout-title">Requisitos previos</h3>
<div class="callout-content">
<ul>
<li>Tutorial completo <a href="quantify-transmissibility.html">Cuantificar la
transmisión</a>
</li>
</ul>
<p>Los alumnos deben familiarizarse con las siguientes dependencias
conceptuales antes de trabajar en este tutorial:</p>
<p><strong>Estadísticas</strong> Distribuciones de probabilidad,
principio del análisis bayesiano.</p>
<p><strong>Teoría epidémica</strong> Número de reproducción
efectiva.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducción">Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n"></a>
</h2>
<hr class="half-width">
<p>Dados los datos de casos de una epidemia, podemos crear estimaciones
del número actual y futuro de casos teniendo en cuenta tanto los
retrasos en la notificación y la infranotificación. Para hacer
afirmaciones sobre el futuro de la epidemia, tenemos que hacer una
suposición sobre cómo las observaciones hasta el presente están
relacionadas con lo que esperamos que ocurra en el futuro. La forma más
sencilla de hacerlo es suponer que “no hay cambios”, es decir, que el
número de reproducciones sigue siendo el mismo en el futuro que el
último observado. En este tutorial crearemos <a href="reference.html#forecast">previsiones</a> suponiendo que el número
de reproducción seguirá siendo el mismo que el estimado en la última
fecha para la que se disponía de datos.</p>
<p>En este tutorial vamos a aprender a utilizar la función
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> para prever los casos teniendo en cuenta las
observaciones incompletas y prever las observaciones secundarias, como
las defunciones.</p>
<p>Utilizaremos la tubería <code>%&gt;%</code> para conectar funciones,
así que vamos a llamar también a la función <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>
paquete:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">EpiNow2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="el-doble-punto" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="el-doble-punto" class="callout-inner">
<h3 class="callout-title">El doble punto</h3>
<div class="callout-content">
<p>El doble punto <code>::</code> en R te permite llamar a una función
específica de un paquete sin cargar todo el paquete en el entorno
actual.</p>
<p>Por ejemplo <code>dplyr::filter(data, condition)</code> utiliza
<code>filter()</code> del <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> paquete.</p>
<p>Esto nos ayuda a recordar las funciones del paquete y a evitar
conflictos de espacio de nombres.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="crear-una-previsión-a-corto-plazo">Crear una previsión a corto plazo<a class="anchor" aria-label="anchor" href="#crear-una-previsi%C3%B3n-a-corto-plazo"></a>
</h2>
<hr class="half-width">
<p>La función <code>epinow()</code> descrita en el <a href="quantify-transmissibility.html">cuantificación de la
transmisión</a> es una envoltura de las funciones:</p>
<ul>
<li>
<code>estimate_infections()</code> utilizadas para estimar los casos
por fecha de infección.</li>
<li>
<code>forecast_infections()</code> Se utiliza para simular
infecciones utilizando un ajuste existente (estimación) a los casos
observados.</li>
</ul>
<p>Utilicemos el mismo código utilizado en <a href="quantify-transmissibility.html">cuantificar la transmisi</a> para
obtener los datos de entrada, los retardos y las priors:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read cases dataset</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {tidyr} to preprocess missing values</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>cases_new <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {incidence2} to compute the daily incidence</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span></span>
<span>    date_index <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    counts <span class="op">=</span> <span class="st">"cases_new"</span>,</span>
<span>    count_values_to <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>    date_names_to <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    complete_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">count_variable</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Incubation period</span></span>
<span><span class="va">incubation_period_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log-tranformed mean</span></span>
<span><span class="va">log_mean</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logmean</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log-transformed std</span></span>
<span><span class="va">log_sd</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logsd</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reporting dalay</span></span>
<span><span class="va">reporting_delay_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="va">log_mean</span>,</span>
<span>  sd <span class="op">=</span> <span class="va">log_sd</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generation time</span></span>
<span><span class="va">generation_time_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">3.6</span>,</span>
<span>  sd <span class="op">=</span> <span class="fl">3.1</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define Rt prior distribution</span></span>
<span><span class="va">rt_prior</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">rt_opts</span><span class="op">(</span>prior <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Ahora podemos extraer la previsión a corto plazo utilizando:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assume we only have the first 90 days of this data</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate and forecast</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="va">rt_prior</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:36:40] epinow: There were 3 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:36:40] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div id="no-esperes-a-que-se-complete" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="no-esperes-a-que-se-complete" class="callout-inner">
<h3 class="callout-title">¡No esperes a que se complete!</h3>
<div class="callout-content">
<p>Esta última parte puede tardar 10 minutos en ejecutarse. Sigue
leyendo este episodio del tutorial mientras esto se ejecuta en segundo
plano. Para más información sobre el tiempo de computación, lee la
sección “Inferencia Bayesiana con Stan” dentro del tutorial <a href="quantify-transmissibility.html">cuantificar la transmisi</a> de la
transmisión.</p>
</div>
</div>
</div>
<p>Podemos visualizar las estimaciones del número de reproducciones
efectivas y del número estimado de casos utilizando <code>plot()</code>.
Las estimaciones se dividen en tres categorías:</p>
<ul>
<li><p><strong>Estimación</strong> (verde): utiliza todos los
datos,</p></li>
<li><p><strong>Estimación basada en datos parciales</strong> (naranja):
contiene un mayor grado de incertidumbre porque dichas estimaciones se
basan en menos datos,</p></li>
<li><p><strong>Previsión</strong> (morado): previsiones hacia el
futuro.</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="previsión-con-observaciones-incompletas">Previsión con observaciones incompletas<a class="anchor" aria-label="anchor" href="#previsi%C3%B3n-con-observaciones-incompletas"></a>
</h3>
<p>En la <a href="quantify-transmissibility.html">cuantificación de la
transmisión</a> tuvimos en cuenta los retrasos en la notificación.
<code>EpiNow2</code> también podemos tener en cuenta las observaciones
incompletas, ya que, en realidad, el 100% de los casos no se notifican.
Pasaremos otro argumento a <code>epinow()</code> función llamada
<code>obs</code> para definir un modelo de observación. El formato de
<code>obs</code> se define mediante la función <code>obs_opt()</code>
(véase <code>?EpiNow2::obs_opts</code> para más detalles).</p>
<p>Supongamos que creemos que los datos del brote COVID-19 del
<code>cases</code> objeto no incluyen todos los casos notificados.
Creemos que sólo observamos el 40% de los casos. Para especificar esto
en el modelo de observación, debemos pasar un factor de escala con una
media y una desviación típica. Si suponemos que el 40% de los casos
están en los datos de casos (con una desviación típica del 1%), entonces
especificamos el factor <code>scale</code> de entrada a
<code>obs_opts()</code> como sigue:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_scale</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre>
</div>
<p>Para ejecutar el marco de inferencia con este proceso de observación,
añadimos <code>obs = obs_opts(scale = obs_scale)</code> a los argumentos
de entrada de <code>epinow()</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define observation model</span></span>
<span><span class="va">obs_scale</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assume we only have the first 90 days of this data</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate and forecast</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="va">rt_prior</span>,</span>
<span>  <span class="co"># Add observation model</span></span>
<span>  obs <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">obs_opts</span><span class="op">(</span>scale <span class="op">=</span> <span class="va">obs_scale</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:45:07] epinow: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
Running the chains for more iterations may help. See
https://mc-stan.org/misc/warnings.html#bulk-ess - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">base</span><span class="fu">::</span><span class="fu">summary</span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                            measure                estimate
                             &lt;char&gt;                  &lt;char&gt;
1:           New infections per day   16894 (9180 -- 29616)
2: Expected change in daily reports       Likely decreasing
3:       Effective reproduction no.      0.87 (0.59 -- 1.2)
4:                   Rate of growth -0.046 (-0.18 -- 0.092)
5:     Doubling/halving time (days)       -15 (7.5 -- -3.8)</code></pre>
</div>
<p>Las estimaciones de las medidas de transmisión, como el número de
reproducción efectivo y la tasa de crecimiento, son similares (o tienen
el mismo valor) que cuando no tuvimos en cuenta las observaciones
incompletas (ver <a href="quantify-transmissibility.html">cuantificar el
episodio de trans</a> en la sección “Encontrar estimaciones”). Sin
embargo, el número de nuevos casos confirmados por fecha de infección ha
cambiado sustancialmente de magnitud para reflejar la suposición de que
sólo el 40% de los casos están en el conjunto de datos.</p>
<p>También podemos cambiar la distribución por defecto de Binomial
Negativa a Poisson, eliminar el efecto de semana por defecto y más.
Consulta <code>?EpiNow2::obs_opts</code> para más detalles.</p>
</div>
<div class="section level3 debate">
<h3 id="cuáles-son-las-implicaciones-de-este-cambio">¿Cuáles son las implicaciones de este cambio?<a class="anchor" aria-label="anchor" href="#cu%C3%A1les-son-las-implicaciones-de-este-cambio"></a>
</h3>
<ul>
<li>Comparar diferentes porcentajes de observaciones %</li>
<li>¿En qué se diferencian en el número de infecciones estimadas?</li>
<li>¿Qué implicaciones tiene este cambio para la salud pública?</li>
</ul>
</div>
</section><section><h2 class="section-heading" id="previsión-de-observaciones-secundarias">Previsión de observaciones secundarias<a class="anchor" aria-label="anchor" href="#previsi%C3%B3n-de-observaciones-secundarias"></a>
</h2>
<hr class="half-width">
<p><code>EpiNow2</code> también tiene la capacidad de estimar y
pronosticar observaciones secundarias, por ejemplo, muertes y
hospitalizaciones, a partir de una observación primaria, por ejemplo,
casos. Aquí ilustraremos cómo prever el número de muertes derivadas de
los casos observados de COVID-19 en las primeras fases del brote del
Reino Unido.</p>
<p>En primer lugar, debemos formatear nuestros datos para que tengan las
siguientes columnas:</p>
<ul>
<li>
<code>date</code>: la fecha (como objeto de fecha ver
<code>?is.Date()</code>),</li>
<li>
<code>primary</code>: número de observaciones primarias en esa
fecha, en este ejemplo <strong>casos</strong>,</li>
<li>
<code>secondary</code>: número de observaciones secundarias fecha,
en este ejemplo <strong>defunciones</strong>.</li>
</ul>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reported_cases_deaths</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {tidyr} to preprocess missing values</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>cases_new <span class="op">=</span> <span class="fl">0</span>, deaths_new <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {incidence2} to compute the daily incidence</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span></span>
<span>    date_index <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    counts <span class="op">=</span> <span class="fu">c</span><span class="op">(</span>primary <span class="op">=</span> <span class="st">"cases_new"</span>, secondary <span class="op">=</span> <span class="st">"deaths_new"</span><span class="op">)</span>,</span>
<span>    date_names_to <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    complete_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># rearrange to wide format for {EpiNow2}</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">count_variable</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/create-forecast-rendered-unnamed-chunk-8-1.png" alt="Distribution of secondary cases (deaths). We will drop the first 30 days with no observed deaths. We will use the deaths between day 31 and day 60 to estimate the secondary observations. We will forecast deaths from day 61 to day 90." class="figure mx-auto d-block"><figcaption>
Distribution of secondary cases (deaths). We will drop the first 30 days
with no observed deaths. We will use the deaths between day 31 and day
60 to estimate the secondary observations. We will forecast deaths from
day 61 to day 90.
</figcaption></figure><p>Utilizando los datos sobre casos y muertes entre el día 31 y el día
60, estimaremos la relación entre las observaciones primarias y
secundarias utilizando <code>estimate_secondary()</code> y, a
continuación, pronosticaremos las muertes futuras mediante
<code>forecast_secondary()</code>. Para más detalles sobre el modelo,
consulta el <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_secondary.html" class="external-link">documentación
del</a>.</p>
<p>Debemos especificar el tipo de observación mediante <code>type</code>
en <code>secondary_opts()</code>, las opciones incluyen:</p>
<ul>
<li>“incidencia”: las observaciones secundarias surgen de las
observaciones primarias previas, es decir, de las muertes que surgen de
los casos registrados.</li>
<li>“Prevalencia”: las observaciones secundarias surgen de una
combinación de observaciones primarias actuales y observaciones
secundarias anteriores, es decir, el uso de camas hospitalarias que
surge de los ingresos hospitalarios actuales y del uso de camas
hospitalarias anteriores.</li>
</ul>
<p>En este ejemplo especificamos
<code>secondary_opts(type = "incidence")</code>. Consulta
<code>?EpiNow2::secondary_opts</code> para más detalles.</p>
<p>La última entrada clave es la distribución del retraso entre las
observaciones primaria y secundaria. Aquí se trata del retraso entre la
notificación del caso y la muerte, suponemos que sigue una distribución
gamma con una media de 14 días y una desviación típica de 5 días
(Alternativamente, podemos utilizar <code>{epiparameter}</code> para <a href="https://epiverse-trace.github.io/tutorials-early/delays-reuse.html" class="external-link">acceder
a los retrasos epidemiológicos</a>). Utilizando <code>Gamma()</code>
especificamos una distribución gamma fija.</p>
<p>Hay más entradas de función para <code>estimate_secondary()</code>
que se pueden especificar, incluida la adición de un proceso de
observación, véase <code>?EpiNow2::estimate_secondary</code> para más
detalles sobre estas opciones.</p>
<p>Encontrar el ajuste del modelo entre casos y muertes:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate from day 31 to day 60 of this data</span></span>
<span><span class="va">cases_to_estimate</span> <span class="op">&lt;-</span> <span class="va">reported_cases_deaths</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">31</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Delay distribution between case report and deaths</span></span>
<span><span class="va">delay_report_to_death</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">14</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate secondary cases</span></span>
<span><span class="va">estimate_cases_to_deaths</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">estimate_secondary</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">cases_to_estimate</span>,</span>
<span>  secondary <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">secondary_opts</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"incidence"</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">delay_report_to_death</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="ten-cuidado-con-la-escala-de-tiempo" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="ten-cuidado-con-la-escala-de-tiempo" class="callout-inner">
<h3 class="callout-title">Ten cuidado con la escala de tiempo</h3>
<div class="callout-content">
<p>En las primeras fases de un brote puede haber cambios sustanciales en
las pruebas y la notificación. Si hay cambios en las pruebas de un mes a
otro, habrá un sesgo en el ajuste del modelo. Por tanto, debes tener
cuidado con la escala temporal de los datos utilizados en el ajuste y la
previsión del modelo.</p>
</div>
</div>
</div>
<p>Trazamos el ajuste del modelo (cintas sombreadas) con las
observaciones secundarias (diagrama de barras) y las observaciones
primarias (línea de puntos) de la siguiente manera:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">estimate_cases_to_deaths</span>, primary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Para utilizar este ajuste del modelo para pronosticar las muertes,
pasamos un marco de datos consistente en la observación primaria (casos)
para las fechas no utilizadas en el ajuste del modelo.</p>
<p><em>Nota : en este episodio estamos utilizando datos en los que
conocemos las muertes y los casos, por lo que creamos un marco de datos
extrayendo los casos. Pero, en la práctica, se trataría de otro conjunto
de datos formado sólo por los casos.</em></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast from day 61 to day 90</span></span>
<span><span class="va">cases_to_forecast</span> <span class="op">&lt;-</span> <span class="va">reported_cases_deaths</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice</span><span class="op">(</span><span class="fl">61</span><span class="op">:</span><span class="fl">90</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="va">primary</span><span class="op">)</span></span></code></pre>
</div>
<p>Para pronosticar, utilizamos el ajuste del modelo
<code>estimate_cases_to_deaths</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast secondary cases</span></span>
<span><span class="va">deaths_forecast</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">forecast_secondary</span><span class="op">(</span></span>
<span>  estimate <span class="op">=</span> <span class="va">estimate_cases_to_deaths</span>,</span>
<span>  primary <span class="op">=</span> <span class="va">cases_to_forecast</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">deaths_forecast</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  haz una trama de previsión
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deaths_forecast</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">pluck</span><span class="op">(</span><span class="st">"predictions"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">secondary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="st">"grey"</span>, col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_90</span>, ymax <span class="op">=</span> <span class="va">upper_90</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_50</span>, ymax <span class="op">=</span> <span class="va">upper_50</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.4</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_20</span>, ymax <span class="op">=</span> <span class="va">upper_20</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.6</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Reports per day"</span>, x <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"week"</span>, date_labels <span class="op">=</span> <span class="st">"%b %d"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>El gráfico muestra la previsión de observaciones secundarias
(defunciones) en las fechas para las que hemos registrado casos. También
es posible prever las defunciones mediante la previsión de casos, para
lo que debes especificar <code>primary</code> como
<code>estimates</code> salida de <code>estimate_infections()</code>.</p>
<div id="intervalos-creíbles" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="intervalos-creíbles" class="callout-inner">
<h3 class="callout-title">Intervalos creíbles</h3>
<div class="callout-content">
<p>En todos <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> figuras de resultados, las regiones
sombreadas reflejan los intervalos de credibilidad del 90%, 50% y 20% en
orden de más claro a más oscuro.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="reto-análisis-del-brote-de-ébola">Reto: Análisis del brote de ébola<a class="anchor" aria-label="anchor" href="#reto-an%C3%A1lisis-del-brote-de-%C3%A9bola"></a>
</h2>
<hr class="half-width">
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Desafío</h3>
<div class="callout-content">
<p>Descarga el archivo <a href="data/ebola_cases.csv">casos_ébola.csv</a> y léelo en R. Los datos
simulados consisten en la fecha de aparición de los síntomas y el número
de casos confirmados de las primeras fases del brote de ébola en Sierra
Leona en 2014.</p>
<p>Utiliza los 3 primeros meses (120 días) de datos:</p>
<ol style="list-style-type: decimal">
<li>Estima si los casos aumentan o disminuyen en el día 120 del
brote</li>
<li>Contar con una capacidad de observación del 80% de los casos.</li>
<li>Crea una previsión de dos semanas del número de casos.</li>
</ol>
<p>Puedes utilizar los siguientes valores de parámetro para la
distribución o distribuciones del retraso y la distribución del tiempo
de generación.</p>
<ul>
<li>Periodo de incubación: Log normal<span class="math inline">\((2.487,0.330)\)</span> (<a href="https://doi.org/10.1016/j.phrp.2011.04.001" class="external-link">Eichner et
al. 2011</a> a través de <code>{epiparameter}</code>)</li>
<li>Tiempo de generación: Gamma<span class="math inline">\((15.3,
10.1)\)</span> (<a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1411100" class="external-link">Equipo de
respuesta al ébola de la OMS 2014</a>)</li>
</ul>
<p>Puedes incluir cierta incertidumbre en torno a la media y la
desviación típica de estas distribuciones.</p>
<div class="pista">
<p>Utilizamos el número de reproducción efectivo y la tasa de
crecimiento para estimar si los casos aumentan o disminuyen.</p>
<p>Podemos utilizar el <code>horizon</code> argumento dentro del
<code>epinow()</code> para ampliar el periodo de tiempo de la previsión.
El valor por defecto es de siete días.</p>
<p>Asegúrate de que los datos tienen el formato correcto :</p>
<ul>
<li>
<code>date</code>: la fecha (como objeto de fecha ver
<code>?is.Date()</code>),</li>
<li>
<code>confirm</code> número de casos confirmados en esa fecha.</li>
</ul>
</div>
<div class="section level3 solución">
<h3 id="solución">SOLUCIÓN<a class="anchor" aria-label="anchor" href="#soluci%C3%B3n"></a>
</h3>
<p>Para estimar el número efectivo de reproducción y la tasa de
crecimiento, utilizaremos la función <code>epinow()</code>.</p>
<p>Como los datos consisten en la fecha de aparición de los síntomas,
sólo necesitamos especificar una distribución de retardo para el periodo
de incubación y el tiempo de generación.</p>
<p>Especificamos las distribuciones con cierta incertidumbre en torno a
la media y la desviación típica de la distribución log normal para el
periodo de incubación y la distribución Gamma para el tiempo de
generación.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span>disease <span class="op">=</span> <span class="st">"ebola"</span>, epi_dist <span class="op">=</span> <span class="st">"incubation"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    5 × 7
  disease   pathogen epi_distribution prob_distribution author  year sample_size
  &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1 Ebola Vi… Ebola V… incubation peri… lnorm             Eichn…  2011         196
2 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015        1798
3 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015          49
4 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015         957
5 Ebola Vi… Ebola V… incubation peri… gamma             WHO E…  2015         792</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_eichner</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"incubation"</span>,</span>
<span>  author <span class="op">=</span> <span class="st">"Eichner"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_eichner_parameters</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">ebola_eichner</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_incubation_period</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">LogNormal</span><span class="op">(</span></span>
<span>  meanlog <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="va">ebola_eichner_parameters</span><span class="op">[</span><span class="st">"meanlog"</span><span class="op">]</span>,</span>
<span>    sd <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="va">ebola_eichner_parameters</span><span class="op">[</span><span class="st">"sdlog"</span><span class="op">]</span>,</span>
<span>    sd <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_generation_time</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Gamma</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">15.3</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  sd <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">Normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">10.1</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Leemos los datos de entrada utilizando
<code>readr::read_csv()</code>. Esta función reconoce que la columna
<code>date</code> es una <code>&lt;date&gt;</code> vector de clase.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read data</span></span>
<span><span class="co"># e.g.: if path to file is data/raw-data/ebola_cases.csv then:</span></span>
<span><span class="va">ebola_cases_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw-data"</span>, <span class="st">"ebola_cases.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Preprocesa y adapta los datos brutos para <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_cases</span> <span class="op">&lt;-</span> <span class="va">ebola_cases_raw</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {tidyr} to preprocess missing values</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>confirm <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use {incidence2} to compute the daily incidence</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span></span>
<span>    date_index <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    counts <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>    count_values_to <span class="op">=</span> <span class="st">"confirm"</span>,</span>
<span>    date_names_to <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>    complete_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">count_variable</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="va">ebola_cases</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 123 × 2
   date       confirm
   &lt;date&gt;       &lt;dbl&gt;
 1 2014-05-18       1
 2 2014-05-19       0
 3 2014-05-20       2
 4 2014-05-21       4
 5 2014-05-22       6
 6 2014-05-23       1
 7 2014-05-24       2
 8 2014-05-25       0
 9 2014-05-26      10
10 2014-05-27       8
# ℹ 113 more rows</code></pre>
</div>
<p>Definimos un modelo de observación para escalar el número estimado y
previsto de nuevas infecciones:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define observation model</span></span>
<span><span class="co"># mean of 80% and standard deviation of 1%</span></span>
<span><span class="va">ebola_obs_scale</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.8</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre>
</div>
<p>Como queremos crear también una previsión a dos semanas,
especificamos <code>horizon = 14</code> para prever 14 días en lugar de
los 7 días por defecto.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">ebola_cases</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">120</span><span class="op">)</span>, <span class="co"># first 3 months of data only</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">ebola_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">ebola_incubation_period</span><span class="op">)</span>,</span>
<span>  <span class="co"># Add observation model</span></span>
<span>  obs <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">obs_opts</span><span class="op">(</span>scale <span class="op">=</span> <span class="va">ebola_obs_scale</span><span class="op">)</span>,</span>
<span>  <span class="co"># horizon needs to be 14 days to create two week forecast (default is 7 days)</span></span>
<span>  horizon <span class="op">=</span> <span class="fl">14</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-09-24 02:47:22] epinow: There were 9 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. -
WARN [2024-09-24 02:47:22] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">ebola_estimates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                            measure               estimate
                             &lt;char&gt;                 &lt;char&gt;
1:           New infections per day         84 (33 -- 202)
2: Expected change in daily reports      Likely increasing
3:       Effective reproduction no.      1.5 (0.81 -- 2.6)
4:                   Rate of growth 0.034 (-0.039 -- 0.11)
5:     Doubling/halving time (days)        20 (6.5 -- -18)</code></pre>
</div>
<p>El número de reproducción efectivo <span class="math inline">\(R_t\)</span> estimado (en la última fecha de los
datos) es 1.5 (0.81 – 2.6). La tasa de crecimiento exponencial del
número de casos es 0.034 (-0.039 – 0.11).</p>
<p>Visualiza las estimaciones:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">ebola_estimates</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="previsión-con-estimaciones-de-r_t" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="previsión-con-estimaciones-de-r_t" class="callout-inner">
<h3 class="callout-title">Previsión con estimaciones de <span class="math inline">\(R_t\)</span>
</h3>
<div class="callout-content">
<p>Por defecto, las previsiones a corto plazo se crean utilizando la
última estimación del número de reproducción <span class="math inline">\(R_t\)</span>. Como esta estimación se basa en
datos parciales, tiene una incertidumbre considerable.</p>
<p>El número de reproducciones que se proyecta en el futuro puede
cambiarse por una estimación menos reciente basada en más datos
utilizando <code>rt_opts()</code>:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">rt_opts</span><span class="op">(</span>future <span class="op">=</span> <span class="st">"estimate"</span><span class="op">)</span></span></code></pre>
</div>
<p>El resultado serán previsiones menos inciertas (ya que se basan en
<span class="math inline">\(R_t\)</span> con un intervalo de
incertidumbre más estrecho), pero las previsiones se basarán en
estimaciones menos recientes de <span class="math inline">\(R_t\)</span>
y supondrán que no ha habido cambios desde entonces.</p>
<p>Además, existe la opción de <a href="reference.html#projection">proyectar</a> el valor de <span class="math inline">\(R_t\)</span> en el futuro utilizando un modelo
genérico fijando <code>future = "project"</code>. Como esta opción
utiliza un modelo para prever el valor de <span class="math inline">\(R_t\)</span> el resultado serán previsiones más
inciertas que <code>estimate</code> por ejemplo <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_infections_options.html#projecting-the-reproduction-number-with-the-gaussian-process" class="external-link">ver
aquí</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="resumen">Resumen<a class="anchor" aria-label="anchor" href="#resumen"></a>
</h2>
<hr class="half-width">
<p><code>EpiNow2</code> puede utilizarse para crear previsiones a corto
plazo y estimar la relación entre distintos resultados. Hay una serie de
opciones de modelo que pueden implementarse para diferentes análisis,
incluida la adición de un proceso de observación para tener en cuenta
los informes incompletos. Consulta la <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_infections_options.html" class="external-link">viñeta</a>
para más detalles sobre las distintas opciones de modelo en
<code>EpiNow2</code> que no se tratan en estos tutoriales.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Podemos crear previsiones a corto plazo haciendo suposiciones sobre
el comportamiento futuro del número de reproducción</li>
<li>La notificación incompleta de casos puede tenerse en cuenta en las
estimaciones</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-severity-static"><p>Content from <a href="severity-static.html">Estimación de la severidad del brote</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/severity-static.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li><p>¿Por qué estimamos la gravedad clínica de una epidemia?</p></li>
<li><p>¿Cómo se puede estimar el tasa de letalidad (TL o CFR por sus
siglas en inglés: <em>Case Fatality Risk</em>) al principio de una
epidemia en curso?</p></li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li><p>Estimar la tasa de letalidad a partir de datos de casos agregados
utilizando el paquete <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>, llamado así dado que tasa de
letalidad se conoce como <em>case fatality risk</em> en inglés (riesgo
de fatalidad de casos).</p></li>
<li><p>Estima la tasa de letalidad, ajustando este cálculo teniendo en
cuenta el intervalo entre la aparición de síntomas y la muerte del
paciente utilizando los paquetes <code>{epiparameter}</code> y
<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>.</p></li>
<li><p>Estima la letalidad de una enfermedad durante la fase de
crecimiento exponencial de una epidemia en expansión utilizando
<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="requisitos-previos" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="requisitos-previos" class="callout-inner">
<h3 class="callout-title">Requisitos previos</h3>
<div class="callout-content">
<p>Este episodio requiere que estés familiarizado con</p>
<p><strong>Ciencia de datos</strong> Programación básica con R</p>
<p><strong>Teoría epidémica</strong>: <a href="reference.html#delaydist">Distribuciones temporales</a>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducción">Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n"></a>
</h2>
<hr class="half-width">
<p>Entre las preguntas más comunes en la fase inicial de una epidemia se
incluyen:</p>
<ul>
<li>¿Cuál es el impacto probable del brote en la salud pública en
términos de gravedad clínica?</li>
<li>¿Cuáles son los grupos más gravemente afectados?</li>
<li>¿Tiene el brote potencial para causar una epidemia de grandes
dimensiones o incluso una pandemia?</li>
</ul>
<p>Podemos evaluar el potencial pandémico de una epidemia con dos
medidas críticas: la transmisibilidad y la gravedad clínica (<a href="https://www.science.org/doi/full/10.1126/science.1176062" class="external-link">Fraser
et al., 2009</a>, <a href="https://www.cdc.gov/flu/pandemic-resources/national-strategy/severity-assessment-framework-508.html" class="external-link">CDC,
2016</a>).</p>
<figure><img src="fig/cfr-hhs-scenarios-psaf.png" alt="Escenarios de Planificación de Pandemias del HHS basados en el Marco de Evaluación de la Gravedad de la Pandemia. Éste utiliza una medida combinada de gravedad clínica y transmisibilidad para caracterizar los escenarios de pandemia de gripe. HHS: Departamento de Salud y Servicios Humanos de los Estados Unidos (CDC, 2016)." class="figure mx-auto d-block"><div class="figcaption">Escenarios de Planificación de Pandemias del HHS
basados en el Marco de Evaluación de la Gravedad de la Pandemia. Éste
utiliza una medida combinada de gravedad clínica y transmisibilidad para
caracterizar los escenarios de pandemia de gripe. <strong>HHS</strong>:
Departamento de Salud y Servicios Humanos de los Estados Unidos (<a href="https://www.cdc.gov/flu/pandemic-resources/national-strategy/severity-assessment-framework-508.html" class="external-link">CDC,
2016</a>).</div>
</figure><p>Un enfoque epidemiológico para estimar la gravedad clínica consiste
en cuantificar la tasa de letalidad (TL). TL es la probabilidad
condicional de muerte una vez confirmado el diagnóstico de la
enfermedad, calculada como el número acumulado de muertes por una
enfermedad infecciosa dividido por el número de casos diagnosticados
confirmados. Sin embargo, calcularlo directamente durante el curso de
una epidemia tiende a dar como resultado un TL sesgado, dado el <a href="reference.html#delaydist">intervalo temporal</a> que ocurre desde
el inicio de lo síntomas hasta la muerte. Este retraso temporal varía
sustancialmente a medida que avanza la epidemia y se estabiliza en las
últimas fases del brote (<a href="https://academic.oup.com/aje/article/162/5/479/82647?login=false#620743" class="external-link">Ghani
et al., 2005</a>).</p>
<figure><img src="fig/cfr-pone.0006852.g003-fig_c.png" alt="Estimaciones sesgadas de la tasa de letalidad como función del tiempo (línea gruesa), calculado como el número acumulado de muertes dividido por el número de casos confirmados en el tiempo t. La estimación de la tasa de letalidad al final de un brote (~30 de mayo) corresponde con la tasa de letalidad verdadera. La línea continua horizontal y las líneas de puntos muestran el valor esperado y los intervalos de confianza del 95% (95% IC) de la predicción de la tasa de letalidad ajustada al retraso temporal entre el periodo inicial de síntomas y muerte , utilizando los datos observados hasta el 27 de Marzo de 2003 (Nishiura et al., 2009)" class="figure mx-auto d-block"><div class="figcaption">Estimaciones sesgadas de la tasa de letalidad
como función del tiempo (línea gruesa), calculado como el número
acumulado de muertes dividido por el número de casos confirmados en el
tiempo <span class="math inline">\(t\)</span>. La estimación de la tasa
de letalidad al final de un brote (~30 de mayo) corresponde con la tasa
de letalidad verdadera. La línea continua horizontal y las líneas de
puntos muestran el valor esperado y los intervalos de confianza del 95%
(<span class="math inline">\(95%\)</span> IC) de la predicción de la
tasa de letalidad ajustada al retraso temporal entre el periodo inicial
de síntomas y muerte , utilizando los datos observados hasta el 27 de
Marzo de 2003 (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a>)</div>
</figure><p>En términos más generales, estimar la gravedad puede ser útil incluso
fuera de un escenario de planificación pandémica y en el contexto de la
salud pública rutinaria. Saber si un brote tiene o tuvo una gravedad
diferente a la del registro histórico puede motivar investigaciones
causales, que podrían ser intrínsecas al agente infeccioso (por ejemplo,
una nueva cepa más grave) o debidas a factores subyacentes en la
población (por ejemplo, inmunidad reducida o factores de morbilidad) (<a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0003846" class="external-link">Lipsitch
et al., 2015</a>).</p>
<p>En este tutorial vamos a aprender a utilizar la función
<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> para calcular y ajustar una estimación de la tasa de
letalidad utilizando <a href="reference.html#delaydist">distribuciones
temporales</a> provenientes de <code>{epiparameter}</code> o de otras
fuentes, basándose en los métodos desarrollados por <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a> además, aprenderemos como reimplementar las funciones
de <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> para realizar otras mediciones de la gravedad de
la enfermedad, por ejemplo, el riesgo de fatalidad hospitalaria.</p>
<p>Utilizaremos el operador <code>%&gt;%</code> para conectar funciones,
por lo que es necesario también acceder al
paquete<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">cfr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">outbreaks</span><span class="op">)</span></span></code></pre>
</div>
<div id="el-doble-punto" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="el-doble-punto" class="callout-inner">
<h3 class="callout-title">El doble punto</h3>
<div class="callout-content">
<p>El doble punto <code>::</code> en R te permite llamar a una función
específica de un paquete sin cargar todo el paquete en el entorno
actual.</p>
<p>Por ejemplo <code>dplyr::filter(data, condition)</code> utiliza
<code>filter()</code> del paquete <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>.</p>
<p>Esto nos ayuda a recordar las funciones requeridas y evitar usar
funciones que fueron creadas con el mismo nombre pero provienen de otros
paquetes.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="fuentes-de-datos-para-la-gravedad-clínica">Fuentes de datos para la gravedad clínica<a class="anchor" aria-label="anchor" href="#fuentes-de-datos-para-la-gravedad-cl%C3%ADnica"></a>
</h2>
<hr class="half-width">
<p>¿Qué fuentes de datos podemos utilizar para estimar la gravedad
clínica de un brote epidémico? <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(20)30243-7/fulltext" class="external-link">Verity
et al., 2020</a> resume el espectro de casos de COVID-19:</p>
<figure><img src="fig/cfr-spectrum-cases-covid19.jpg" alt="Espectro de casos de COVID-19. La tasa de letalidad pretende estimar la proporción de muertes entre los casos confirmados en una epidemia. (Verity et al., 2020)" class="figure mx-auto d-block"><div class="figcaption">Espectro de casos de COVID-19. La tasa de
letalidad pretende estimar la proporción de muertes entre los casos
confirmados en una epidemia. (<a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(20)30243-7/fulltext#gr1" class="external-link">Verity
et al., 2020</a>)</div>
</figure><ul>
<li><p>En la cúspide de la pirámide, los que cumplían los criterios de
caso de la OMS para <strong>grave</strong> o críticos, identificados en
el ámbito hospitalario, presentando una neumonía vírica atípica. Estos
casos se habrían identificado en China continental y entre los
categorizados internacionalmente como de transmisión local.</p></li>
<li><p>Es probable que haya muchos más casos
<strong>sintomáticos</strong> (es decir, con fiebre, tos o mialgia) pero
no requiriesen hospitalización. Estos casos se habrían identificado
mediante el rastro de casos potenciales en vuelos internacionales a
zonas de alto riesgo y mediante el rastreo de los contactos de los casos
confirmados, o a través de vigilancia pasiva de otras enfermedades
infecciosas respiratorias en la población.</p></li>
<li>
<p>La parte inferior de la pirámide representa enfermedad
<strong>leve</strong> (y posiblemente <strong>asintomática</strong>).
Estos casos podrían identificarse mediante el rastreo de contactos,
mediante pruebas serológicas.</p>
<h2 id="tasa-de-letalidad-no-ajustada">Tasa de letalidad no
ajustada</h2>
</li>
</ul>
<p>Medimos la gravedad de la enfermedad en términos de riesgo/tasa de
letalidad (TL). TL se interpreta como la probabilidad condicional de
muerte dado un diagnóstico confirmado, calculada como el número
acumulado de muertes <span class="math inline">\(D_{t}\)</span> sobre el
número acumulado de casos confirmados <span class="math inline">\(C_{t}\)</span> en un momento determinado <span class="math inline">\(t\)</span>. Podemos referirnos al <em>TL
sesgado</em> (<span class="math inline">\(b_{t}\)</span>):</p>
<p><span class="math display">\[ b_{t} =  \frac{D_{t}}{C_{t}}
\]</span></p>
<p>Este cálculo es <em>sesgado</em> porque genera una subestimación de
la TL real, debido al retraso temporal desde el inicio de los síntomas
hasta la muerte, que sólo se estabiliza en las últimas fases del
brote.</p>
<!-- ¿añadir aquí la llamada sobre ratio o riesgo?  -->
<!-- https://github.com/epiverse-trace/cfr/issues/130 -->
<p>Para calcular la TL de forma directa y sin ajustar el retraso
temporal entre la aparición de síntomas y la muerte del paciente
(conocida como tasa de letalidad “naive”), el paquete <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>
requiere un una base de datos (dataframe) que contenga las siguientes
tres columnas:</p>
<ul>
<li><code>date</code></li>
<li><code>cases</code></li>
<li><code>deaths</code></li>
</ul>
<p>Exploremos la base de datos <code>ebola1976</code> incluido en {cfr}
que procede del primer brote de ébola en lo que entonces se llamaba
Zaire (ahora República Democrática del Congo) en 1976, analizado por
Camacho et al. (2014).</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cargamos la base de datos Ebola 1976, incluida en el paquete {cfr}</span></span>
<span><span class="fu">data</span><span class="op">(</span><span class="st">"ebola1976"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Asumiendo que solo tenemos datos para los primeros 30 días del brote</span></span>
<span><span class="va">ebola1976</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 30 × 3
   date       cases deaths
   &lt;date&gt;     &lt;int&gt;  &lt;int&gt;
 1 1976-08-25     1      0
 2 1976-08-26     0      0
 3 1976-08-27     0      0
 4 1976-08-28     0      0
 5 1976-08-29     0      0
 6 1976-08-30     0      0
 7 1976-08-31     0      0
 8 1976-09-01     1      0
 9 1976-09-02     1      0
10 1976-09-03     1      0
# ℹ 20 more rows</code></pre>
</div>
<div id="necesitamos-datos-de-incidencia-agregados" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="necesitamos-datos-de-incidencia-agregados" class="callout-inner">
<h3 class="callout-title">Necesitamos datos de incidencia agregados</h3>
<div class="callout-content">
<p><a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> lee datos de incidencia <strong>agregados</strong>
por día</p>
<!-- Similar al paquete `{EpiNow2}` con la diferencia de que para `{cfr}` necesitamos una columna más llamada `deaths`. -->
<p>Estos deben ser <strong>agregados</strong> por día, es decir, cada
fila de la base de datos contiene el número diario de casos y muertes
notificadas. También deben incluirse aquellos días que tengan valores
nulos o ausentes, de forma similar a los datos de series temporales.</p>
<p><a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> requiere datos diarios y no puede considerar otras
unidades temporales de agregación, como semanas o meses.</p>
<!-- sugiere formas de tratar los datos semanales de entrada brutos -->
<!-- https://github.com/epiverse-trace/cfr/issues/117 -->
</div>
</div>
</div>
<p>Utilizando la función <code>cfr_static()</code> directamente,
calculamos la tasa de letalidad sin ajustar:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cálculo de la tasa de letalidad sin ajustar durante los primeros 30 días</span></span>
<span><span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_static</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ebola1976</span> <span class="op">%&gt;%</span> <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  severity_estimate severity_low severity_high
1         0.4740741    0.3875497     0.5617606</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Desafío</h3>
<div class="callout-content">
<p>Descarga el archivo <a href="data/sarscov2_cases_deaths.csv">sarscov2_casos_defunciones.csv</a>
y léelo en R.</p>
<p>Estima la tasa de letalidad sin ajustar.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Dar una pista </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>Comprueba el formato de los datos introducidos.</p>
<ul>
<li>¿Contiene datos diarios?</li>
<li>¿Los nombres de las columnas son los requeridos por
<code>cfr_static()</code>?</li>
<li>¿Cómo se cambian los nombres de las columnas de una base de datos
(dataframe) en R?</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Mostrar la solución </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Leemos los datos introducidos mediante
<code>readr::read_csv()</code>. Esta función reconoce que la columna
<code>date</code> tiene el formato correcto,<code>&lt;date&gt;</code>,
que corresponde a fechas.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lee la base de datos</span></span>
<span><span class="co"># por ejemplo, si la ruta al archivo es data/raw-data/ebola_cases.csv :</span></span>
<span><span class="va">sarscov2_input</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw-data"</span>, <span class="st">"sarscov2_cases_deaths.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inspect data</span></span>
<span><span class="va">sarscov2_input</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 93 × 3
   date       cases_jpn deaths_jpn
   &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;
 1 2020-01-20         1          0
 2 2020-01-21         1          0
 3 2020-01-22         0          0
 4 2020-01-23         1          0
 5 2020-01-24         1          0
 6 2020-01-25         3          0
 7 2020-01-26         3          0
 8 2020-01-27         4          0
 9 2020-01-28         6          0
10 2020-01-29         7          0
# ℹ 83 more rows</code></pre>
</div>
<p>Podemos utilizar <code>dplyr::rename()</code> para cambiar los
nombres de las columnas de este archivo y adaptarlos a los requeridos
por <code>cfr_static()</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cambio de nombre de las columnas en base al formato requerido por `cfr_static`</span></span>
<span><span class="va">sarscov2_input</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rename</span><span class="op">(</span></span>
<span>    cases <span class="op">=</span> <span class="va">cases_jpn</span>,</span>
<span>    deaths <span class="op">=</span> <span class="va">deaths_jpn</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_static</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  severity_estimate severity_low severity_high
1        0.01895208   0.01828832    0.01963342</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="sesgos-que-afectan-a-la-estimación-de-la-tl">Sesgos que afectan a la estimación de la TL<a class="anchor" aria-label="anchor" href="#sesgos-que-afectan-a-la-estimaci%C3%B3n-de-la-tl"></a>
</h2>
<hr class="half-width">
<div id="dos-sesgos-que-afectan-a-la-estimación-de-la-tl" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="dos-sesgos-que-afectan-a-la-estimación-de-la-tl" class="callout-inner">
<h3 class="callout-title">Dos sesgos que afectan a la estimación de la TL</h3>
<div class="callout-content">
<p><a href="https://journals.plos.org/plosntds/article?id=10.1371/journal.pntd.0003846" class="external-link">Lipsitch
et al., 2015</a> describen dos posibles sesgos que pueden afectar a la
estimación de la tasa de letalidad (y sus posibles soluciones):</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> 1. Sesgo por la identificación predominante de los casos más graves </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Para enfermedades con un <em>espectro</em> de presentaciones
clínicas, es más probable que los casos de mayor gravedad sean
reconocidos y notificados a las autoridades de salud pública y se
registran en las bases de datos de vigilancia, ya que las personas con
síntomas graves son las que suelen buscar atención médica y acuden al
centro de salud/hospital.</p>
<p>Por lo tanto, la TL será normalmente más elevada entre <em>los casos
detectados</em> que entre toda la población de casos, dado que esta
última puede incluir individuos con presentaciones leves, subclínicas, y
(según algunas definiciones de “caso”) asintomáticas.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> 2. Sesgo debido al retraso en la notificación de la defunción </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>En tiempo real durante una epidemia, suele haber un retraso temporal
entre el momento en que alguien muere y el momento en que se notifica su
muerte a la autoridad correspondiente. Por lo tanto, la lista de casos
en tiempo real incluye a personas que morirán a causa de la enfermedad
en el futuro, pero que aún siguen vivas, o que han muerto, pero cuya
muerte no se ha notificado aún. Así pues, dividir el número acumulado de
muertes notificadas por el número acumulado de casos notificados en un
momento concreto durante un brote epidémico subestimará la TL
verdadera.</p>
<p>Los determinantes clave de la magnitud del sesgo son la <em>tasa de
crecimiento</em> de la epidemia y la <em>distribución</em> del intervalo
de tiempo desde la notificación del caso hasta la notificación de la
defunción. Cuanto más largos sea este intervalo de tiempo y mayor sea la
tasa de crecimiento, mayor será el sesgo.</p>
<p>En este episodio del tutorial, vamos a centrarnos en las soluciones
para hacer frente a este sesgo utilizando el paquete de
R<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> ¡!</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Caso de estudio: Gripe A (H1N1), México, 2009 </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Mejorar la estimación de la tasa de letalidad, ajustando su cálculo
al retraso temporal entre notificación de casos y muerte es crucial para
determinar la gravedad de la enfermedad, adaptar la intensidad y el tipo
de intervenciones de salud pública y asesorar a la población.</p>
<p>En 2009, durante el virus de la gripe porcina, Gripe A (H1N1) en
México, la estimación temprana de la tasa de letalidad fue sesgada. Los
informes iniciales del gobierno de México sugerían una infección
virulenta, mientras que, en otros países, el mismo virus se percibía
como leve (<a href="https://content.time.com/time/health/article/0,8599,1894534,00.html" class="external-link">TIME,
2009</a>).</p>
<p>En EE.UU. y Canadá, no se atribuyó ninguna muerte al virus en los
diez primeros días tras la declaración de emergencia de salud pública
por parte de la Organización Mundial de la Salud.</p>
<p><a href="https://www.science.org/doi/full/10.1126/science.1176062" class="external-link">Fraser
et al., 2009</a> reinterpretó los datos evaluando los sesgos y
obteniendo una gravedad clínica inferior a la de la pandemia de gripe de
1918, pero comparable a la observada en la pandemia de 1957.</p>
</div>
</div>
</div>
</div>

</section><section><h2 class="section-heading" id="tl-ajustada-al-retraso-temporal">TL ajustada al retraso temporal<a class="anchor" aria-label="anchor" href="#tl-ajustada-al-retraso-temporal"></a>
</h2>
<hr class="half-width">
<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al, 2009</a> desarrollaron un método que tiene en cuenta la
<strong>distribución temporal</strong> desde el inicio de los síntomas
hasta la muerte.</p>
<p>Los brotes en tiempo real pueden tener un número de muertes
insuficiente para determinar la distribución temporal entre el inicio de
síntomas y la muerte. Por tanto, podemos estimar la <em>distribución
temporal</em> en brotes históricos o utilizar las distribuciones
incluidas en paquetes de R como <code>{epiparameter}</code> o
<code>{epireview}</code> que los recogen de la literatura científica
publicada. Para una guía paso a paso, lee el episodio tutorial sobre
cómo <a href="https://epiverse-trace.github.io/tutorials-early/delays-reuse.html" class="external-link">acceder
a distribuciones temporales epidemiológicas</a>.</p>
<p>Utilicemos <code>{epiparameter}</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get delay distribution</span></span>
<span><span class="va">onset_to_death_ebola</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"Ebola"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"onset_to_death"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot &lt;epidist&gt; object</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">onset_to_death_ebola</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/severity-static-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Para calcular la TL ajustada, podemos utilizar la función
<code>cfr_static()</code>, a través del argumento
<code>delay_density</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the delay-adjusted CFR</span></span>
<span><span class="co"># for the first 30 days</span></span>
<span><span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_static</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">ebola1976</span> <span class="op">%&gt;%</span> <span class="fu">slice_head</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  delay_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">density</span><span class="op">(</span><span class="va">onset_to_death_ebola</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Total cases = 135 and p = 0.955: using Normal approximation to binomial likelihood.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  severity_estimate severity_low severity_high
1            0.9717       0.8201        0.9866</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Total cases = 135 and p = 0.955: using Normal approximation to binomial likelihood.</code></pre>
</div>
<p>La tasa de letalidad ajustada indicó que la gravedad de la enfermedad
<em>al final del brote</em> o con el <em>últimos datos disponibles en
ese momento</em> es 0.9717 con un intervalo de confianza del 95% entre
0.8201 y 0.9866, con un valor superior al obtenido a través del cálculo
directo sin ajustar.</p>
<div id="utiliza-la-clase-epidist" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="utiliza-la-clase-epidist" class="callout-inner">
<h3 class="callout-title">Utiliza la clase epidist</h3>
<div class="callout-content">
<p>Cuando utilices una clase <code>&lt;epidist&gt;</code> puedes
utilizar esta expresión como plantilla:</p>
<p><code>function(x) density(&lt;EPIDIST_OBJECT&gt;, x)</code></p>
<p>Para distribuciones cuyos parámetros no estén disponibles en
<code>{epiparameter}</code>, te proponemos dos alternativas:</p>
<ul>
<li><p>Crear un objeto <code>&lt;epidist&gt;</code>, que puede ser
utilizado con otros paquetes de R para análisis de brotes. Lee la <a href="https://epiverse-trace.github.io/epiparameter/reference/epidist.html" class="external-link">documentación
de referencia de <code>epiparameter::epidist()</code></a> o</p></li>
<li><p>Lee la viñeta para <a href="https://epiverse-trace.github.io/cfr/articles/delay_distributions.html" class="external-link">una
introducción al trabajo con distribuciones temporales</a>.</p></li>
</ul>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Desafío</h3>
<div class="callout-content">
<p>Utiliza el mismo archivo del reto anterior (<a href="data/sarscov2_cases_deaths.csv">sarscov2_casos_muertes.csv</a>).</p>
<p>Estima la TL ajustada al retraso temporal utilizando la distribución
apropiada y</p>
<ul>
<li>¡Compara los valores de la TL ajustada y sin ajuste temporal!</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Dar una pista </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<ul>
<li>Encuentra el <code>&lt;epidist&gt;</code> ¡apropiado!</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Mostrar la solución </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Utilizamos <code>{epiparameter}</code> para acceder a una
distribución temporal para los datos de incidencia agregados del
SARS-CoV-2:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sarscov2_delay</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"onset to death"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>Leemos el archivo de datos mediante <code>readr::read_csv()</code>.
Esta función reconoce que la columna <code>date</code> es de la clase
<code>&lt;date&gt;</code>, es decir, una fecha.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read data</span></span>
<span><span class="co"># e.g.: if path to file is data/raw-data/ebola_cases.csv then:</span></span>
<span><span class="va">sarscov2_input</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw-data"</span>, <span class="st">"sarscov2_cases_deaths.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inspect data</span></span>
<span><span class="va">sarscov2_input</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 93 × 3
   date       cases_jpn deaths_jpn
   &lt;date&gt;         &lt;dbl&gt;      &lt;dbl&gt;
 1 2020-01-20         1          0
 2 2020-01-21         1          0
 3 2020-01-22         0          0
 4 2020-01-23         1          0
 5 2020-01-24         1          0
 6 2020-01-25         3          0
 7 2020-01-26         3          0
 8 2020-01-27         4          0
 9 2020-01-28         6          0
10 2020-01-29         7          0
# ℹ 83 more rows</code></pre>
</div>
<p>Podemos utilizar <code>dplyr::rename()</code> para cambiar los
nombres de las columnas del archivo a los requeridos
por<code>cfr_static()</code>.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rename before Estimate naive CFR</span></span>
<span><span class="va">sarscov2_input</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rename</span><span class="op">(</span></span>
<span>    cases <span class="op">=</span> <span class="va">cases_jpn</span>,</span>
<span>    deaths <span class="op">=</span> <span class="va">deaths_jpn</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_static</span><span class="op">(</span>delay_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">density</span><span class="op">(</span><span class="va">sarscov2_delay</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Total cases = 159402 and p = 0.0734: using Normal approximation to binomial likelihood.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  severity_estimate severity_low severity_high
1             0.047       0.0221        0.2931</code></pre>
</div>
<p>Interpreta las diferencias entre las estimaciones de la tasa de
letalidad sin ajustar y con ajuste temporal al intervalo entre la
aparición inicial de síntomas en los casos y su muerte.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> ¿Cuándo utilizar distribuciones discretas? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>En <code>cfr_static()</code> y toda la familia de funciones en
<code>cfr_*()</code>, la opción más adecuada son las distribuciones
<strong>discretas</strong>. Esto se debe a que trabajaremos con datos
diarios de casos y defunciones.</p>
<p>Podemos suponer que la función de densidad de probabilidad (PDF) de
una distribución <em>continua</em> es equivalente a la función de masa
de probabilidad (PMF) de la distribución <em>discreta</em>
correspondiente.</p>
<p>Sin embargo, esta suposición puede no ser adecuada en el caso de
distribuciones con picos pronunciados y baja varianza, en las que los
valores se concentran alrededor de la tendencia central. En tales casos,
se espera que la disparidad media entre la PDF y la PMF sea más
pronunciada en comparación con las distribuciones más dispersas. Una
forma de abordar esto es discretizar la distribución continua. Esto lo
podemos hacer en R, si discretizamos los objetos
<code>&lt;epidist&gt;</code>, utilizando la función
<code>epiparameter::discretise()</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> ¿Cómo funciona {cfr}? </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<p>Para ajustar la tasa de letalidad, <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a> utilizan los datos de incidencia de casos y muertes
para estimar el número de casos con resultados conocidos:</p>
<p><span class="math display">\[
u_t = \dfrac{\sum_{i = 0}^t
\sum_{j = 0}^\infty c_{i - j} f_{j}}{\sum_{i = 0} c_i},
\]</span></p>
<p>donde</p>
<ul>
<li>
<span class="math inline">\(c_{t}\)</span> es la incidencia diaria
de casos en el momento <span class="math inline">\(t\)</span>,</li>
<li>
<span class="math inline">\(f_{t}\)</span> es el valor de la función
de masa de probabilidad (PMF) de la <strong>distribución
temporal</strong> entre el inicio de síntomas y la muerte, y</li>
<li>
<span class="math inline">\(u_{t}\)</span> representa el factor de
subestimación de los resultados conocidos.</li>
</ul>
<p><span class="math inline">\(u_{t}\)</span> se utiliza para
<strong>escalar</strong> el valor del número acumulado de casos en el
denominador en el cálculo de la TL. Se calcula internamente con la
función <a href="https://epiverse-trace.github.io/cfr/reference/estimate_outcomes.html" class="external-link"><code>estimate_outcomes()</code></a></p>
<p>El estimador para la tasa de letalidad puede expresarse como:</p>
<p><span class="math display">\[p_{t} = \frac{b_{t}}{u_{t}}\]</span></p>
<p>donde <span class="math inline">\(p_{t}\)</span> es la proporción
realizada de casos confirmados que morirán a causa de la infección (o la
TL real), y <span class="math inline">\(b_{t}\)</span> es la estimación
cruda y sesgada de la TL.</p>
<p>A partir de esta última ecuación, observamos que la TL no sesgada
<span class="math inline">\(p_{t}\)</span> es mayor que la TL sesgada
<span class="math inline">\(b_{t}\)</span> porque en <span class="math inline">\(u_{t}\)</span> el numerador es menor que el
denominador (observa que <span class="math inline">\(f_{t}\)</span> es
la distribución de probabilidad del <em>retraso temporal</em> entre
síntomas y muerte). Por tanto, nos referimos a <span class="math inline">\(b_{t}\)</span> como el estimador sesgado de la
tasa de letalidad.</p>
<p>Cuando observamos todo el curso de una epidemia (desde <span class="math inline">\(t \rightarrow \infty\)</span>), <span class="math inline">\(u_{t}\)</span> tiende a 1, lo que hace que <span class="math inline">\(b_{t}\)</span> tiende a <span class="math inline">\(p_{t}\)</span> y se convierta en un estimador no
sesgado (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a>).</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="estimación-temprana-de-la-tl">Estimación temprana de la TL<a class="anchor" aria-label="anchor" href="#estimaci%C3%B3n-temprana-de-la-tl"></a>
</h2>
<hr class="half-width">
<p>En el reto anterior, descubrimos que el valor de la tasa de letalidad
ajustada y no ajustada son diferentes.</p>
<p>La TL sin ajustar es útil para obtener una estimación global de la
gravedad del brote. Una vez que el brote haya finalizado o haya
progresado de forma que se notifiquen más muertes, la TL estimada es
entonces <em>más cercana a</em> la TL “verdadera” o no sesgada.</p>
<p>Por otra parte, la TL <strong>ajustada</strong> puede ser utilizada
para estimar la gravedad de una enfermedad infecciosa emergente de una
forma más temprana durante una epidemia.</p>
<p>Podemos explorar la <em>TL ajustada al retraso temporal</em> de forma
temprana utilizando la función <code>cfr_rolling()</code></p>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Aviso</h3>
<div class="callout-content">
<p><code>cfr_rolling()</code> es una función que calcula automáticamente
la TL en cada día del brote con los datos disponibles hasta ese día, lo
que ahorra tiempo al usuario, ya que no hace falta calcular este
parámetro manualmente para cada momento.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the rolling daily naive CFR</span></span>
<span><span class="co"># for all the 73 days in the Ebola dataset</span></span>
<span><span class="va">rolling_cfr_naive</span> <span class="op">&lt;-</span> <span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_rolling</span><span class="op">(</span>data <span class="op">=</span> <span class="va">ebola1976</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`cfr_rolling()` is a convenience function to help understand how additional data influences the overall (static) severity. Use `cfr_time_varying()` instead to estimate severity changes over the course of the outbreak.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu">tail</span><span class="op">(</span><span class="va">rolling_cfr_naive</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>         date severity_estimate severity_low severity_high
68 1976-10-31         0.9510204    0.9160061     0.9744387
69 1976-11-01         0.9510204    0.9160061     0.9744387
70 1976-11-02         0.9510204    0.9160061     0.9744387
71 1976-11-03         0.9510204    0.9160061     0.9744387
72 1976-11-04         0.9510204    0.9160061     0.9744387
73 1976-11-05         0.9551020    0.9210866     0.9773771</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the rolling daily delay-adjusted CFR</span></span>
<span><span class="co"># for all the 73 days in the Ebola dataset</span></span>
<span><span class="va">rolling_cfr_adjusted</span> <span class="op">&lt;-</span> <span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_rolling</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">ebola1976</span>,</span>
<span>  delay_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">density</span><span class="op">(</span><span class="va">onset_to_death_ebola</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`cfr_rolling()` is a convenience function to help understand how additional data influences the overall (static) severity. Use `cfr_time_varying()` instead to estimate severity changes over the course of the outbreak.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Some daily ratios of total deaths to total cases with known outcome are below 0.01%: some CFR estimates may be unreliable.FALSE</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu">tail</span><span class="op">(</span><span class="va">rolling_cfr_adjusted</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>         date severity_estimate severity_low severity_high
68 1976-10-31            0.9843       0.9003        0.9925
69 1976-11-01            0.9843       0.9003        0.9925
70 1976-11-02            0.9817       0.8838        0.9913
71 1976-11-03            0.9817       0.8838        0.9913
72 1976-11-04            0.9817       0.8838        0.9913
73 1976-11-05            0.9818       0.8843        0.9913</code></pre>
</div>
<p>Con <code>utils::tail()</code> mostramos como los últimos valores
estimados de la TL ajustada y sin ajustar tienen rangos superpuestos de
intervalos de confianza del 95%.</p>
<p>Ahora, visualicemos ambos resultados en una serie temporal. ¿Cómo se
comportarían en tiempo real las estimaciones de TL ajustadas y sin
ajustar?</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the latest delay-adjusted CFR</span></span>
<span><span class="va">rolling_cfr_adjusted_end</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">rolling_cfr_adjusted</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">slice_tail</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bind by rows both output data frames</span></span>
<span><span class="fu">bind_rows</span><span class="op">(</span></span>
<span>  <span class="va">rolling_cfr_naive</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"naive"</span><span class="op">)</span>,</span>
<span>  <span class="va">rolling_cfr_adjusted</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"adjusted"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># visualise both adjusted and unadjusted rolling estimates</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      <span class="va">date</span>,</span>
<span>      ymin <span class="op">=</span> <span class="va">severity_low</span>,</span>
<span>      ymax <span class="op">=</span> <span class="va">severity_high</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">method</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">date</span>, <span class="va">severity_estimate</span>, colour <span class="op">=</span> <span class="va">method</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rolling_cfr_adjusted_end</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">severity_estimate</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rolling_cfr_adjusted_end</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">severity_low</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">rolling_cfr_adjusted_end</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">severity_high</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/severity-static-rendered-unnamed-chunk-19-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>La línea horizontal representa la TL ajustada al retraso temporal,
estimada al final del brote. La línea punteada significa que la
estimación tiene un intervalo de confianza del 95% (IC 95%).</p>
<p><strong>Observa</strong> que este cálculo ajustado al retraso
temporal entre síntomas y muerte es especialmente útil cuando los únicos
datos disponibles son <em>curvas epidémica de casos confirmados</em> (es
decir, cuando no se dispone de datos individuales, especialmente durante
la fase inicial de la epidemia). Cuando hay pocas muertes o ninguna, hay
que hacer una suposición para la <em>distribución temporal</em> desde la
aparición de síntomas hasta la muerte, por ejemplo, a partir de la
literatura basada en brotes anteriores. <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a> representan esto en las figuras con datos del brote de
SARS en Hong Kong, 2003.</p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Caso de estudio: Brote de SARS, Hong Kong, 2003 </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>Las figuras A y B muestran el número acumulado de casos y muertes por
SRAS, y la figura C muestra las estimaciones observadas (sesgadas) del
CFR en función del tiempo, es decir, el número acumulado de muertes
sobre casos en el momento <span class="math inline">\(t\)</span>. Debido
al retraso temporal desde el inicio de los síntomas hasta la muerte, la
estimación sesgada de la Tasa de Letalidad en el tiempo <span class="math inline">\(t\)</span> subestima el valor en las etapas
finales del brote (es decir, 302/1755 = 17,2%).</p>
<figure><img src="fig/cfr-pone.0006852.g003-fig_abc.png" alt="Riesgo observado (sesgado) de letalidad confirmada del síndrome respiratorio agudo grave (SRAS) en Hong Kong, 2003. (Nishiura et al., 2009)" class="figure mx-auto d-block"><div class="figcaption">Riesgo observado (sesgado) de letalidad
confirmada del síndrome respiratorio agudo grave (SRAS) en Hong Kong,
2003. (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a>)</div>
</figure><p>No obstante, incluso utilizando únicamente los datos observados para
el periodo comprendido entre el 19 de marzo y el 2 de abril,
<code>cfr_static()</code> puede obtener una predicción adecuada (Figura
D), por ejemplo, la TL ajustada al retraso en el 27 de marzo es del
18,1% (IC del 95%: 10,5, 28,1). Se observa una sobreestimación en las
fases muy tempranas de la epidemia, pero los límites de confianza del
95% en las fases posteriores incluyen la TL realizado (es decir, 17,2
%).</p>
<figure><img src="fig/cfr-pone.0006852.g003-fig_d.png" alt="Determinación temprana del riesgo de letalidad confirmada ajustado al retraso del síndrome respiratorio agudo grave (SRAS) en Hong Kong, 2003. (Nishiura et al., 2009)" class="figure mx-auto d-block"><div class="figcaption">Determinación temprana del riesgo de letalidad
confirmada ajustado al retraso del síndrome respiratorio agudo grave
(SRAS) en Hong Kong, 2003. (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a>)</div>
</figure>
</div>
</div>
</div>
</div>
<div id="interpretar-la-estimación-de-la-tl-en-la-fase-inicial-del-brote" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="interpretar-la-estimación-de-la-tl-en-la-fase-inicial-del-brote" class="callout-inner">
<h3 class="callout-title">Interpretar la estimación de la TL en la fase inicial del brote</h3>
<div class="callout-content">
<p>Basándote en la figura anterior:</p>
<ul>
<li>¿Cuántos días hay entre el inicio del brote y la fecha en la que el
intervalo de confianza de la <em>TL ajustada</em> se cruza con el
intervalo de confianza de la <em>TL sin ajustar</em>? ¿Los intervalos se
cruzan con la TL estimada al final del brote?</li>
</ul>
<p>Discusión:</p>
<ul>
<li>¿Cuáles son las implicaciones para la política de salud pública de
tener una <em>TL ajustada por retraso temporal</em>?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Dar una pista </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>Podemos utilizar la inspección visual o el análisis de los marcos de
datos de salida.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Mostrar la solución </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Hay casi un mes de diferencia.</p>
<p>Nótese que la estimación tiene una incertidumbre considerable al
principio de la serie temporal. Al cabo de dos semanas, la TL ajustada
se aproxima a la estimación global de la TL al final del brote.</p>
<p>¿Es este patrón similar al de otros brotes? Podemos utilizar los
conjuntos de datos de los retos de este episodio. ¡Te invitamos a
averiguarlo!</p>
</div>
</div>
</div>
</div>
<div id="lista-de-verificación" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="lista-de-verificación" class="callout-inner">
<h3 class="callout-title">Lista de verificación</h3>
<div class="callout-content">
<p>Con <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> estimamos la TL como la proporción de muertes
entre <strong>confirmadas</strong> confirmados.</p>
<p>Utilizando sólo el número de casos <strong>confirmados</strong> está
claro que se pasarán por alto todos los casos que no busquen tratamiento
médico o no sean notificados, así como todos los casos asintomáticos.
Esto significa que la estimación de la TL es superior a la proporción de
muertes entre los infectados.</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> ¿Por qué difieren la TL sin ajustar y la ajustada al retraso temporal? </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p><a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> tiene como objetivo obtener un estimador insesgado
“mucho antes” de observar el curso completo del brote. Para ello
<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> utiliza el factor de subestimación <span class="math inline">\(u_{t}\)</span> para estimar la TL sin sesgo <span class="math inline">\(p_{t}\)</span> , utilizando métodos de máxima
verosimilitud, dado el <em>proceso de muestreo</em> definido por <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006852" class="external-link">Nishiura
et al., 2009</a>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8"> ¿Qué es el proceso de muestreo? </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<figure><img src="fig/cfr-pone.0006852.g001.png" alt="La población de casos confirmados y el proceso de muestreo para estimar la TL sin sesgo durante el transcurso de un brote. (Nishiura et al., 2009)" class="figure mx-auto d-block"><div class="figcaption">La población de casos confirmados y el proceso
de muestreo para estimar la TL sin sesgo durante el transcurso de un
brote. (<a href="https://doi.org/10.1371/journal.pone.0006852.g001" class="external-link">Nishiura et
al., 2009</a>)</div>
</figure><p>En <em>datos agregados de incidencia</em> en el momento <span class="math inline">\(t\)</span> conocemos el número acumulado de casos
confirmados y muertes, <span class="math inline">\(C_{t}\)</span> y
<span class="math inline">\(D_{t}\)</span> y deseamos estimar la TL sin
sesgo <span class="math inline">\(\pi\)</span> mediante el factor de
subestimación <span class="math inline">\(u_{t}\)</span>.</p>
<p>Si conociéramos el factor de subestimación <span class="math inline">\(u_{t}\)</span> podríamos especificar el tamaño de
la población de casos confirmados que ya no corren riesgo (<span class="math inline">\(u_{t}C_{t}\)</span>, <strong>sombreado</strong>),
aunque no sabemos qué individuos supervivientes pertenecen a este grupo.
Una proporción <span class="math inline">\(\pi\)</span> de los del grupo
de casos aún en riesgo (tamaño <span class="math inline">\((1-
u_{t})C_{t}\)</span>, <strong>sin sombrear</strong>) se espera que
muera.</p>
<p>Ya que cada caso que deja de estar en riesgo tiene una probabilidad
independiente de morir, <span class="math inline">\(\pi\)</span> el
número de muertes, <span class="math inline">\(D_{t}\)</span> es una
muestra de una distribución binomial con tamaño de muestra <span class="math inline">\(u_{t}C_{t}\)</span> y probabilidad de morir <span class="math inline">\(p_{t}\)</span> = <span class="math inline">\(\pi\)</span>.</p>
<p>Esto se representa mediante la siguiente función de verosimilitud
para obtener la estimación de máxima verosimilitud de la TL sin sesgo
<span class="math inline">\(p_{t}\)</span> = <span class="math inline">\(\pi\)</span>:</p>
<p><span class="math display">\[
{\sf L}(\pi | C_{t},D_{t},u_{t}) = \log{\dbinom{u_{t}C_{t}}{D_{t}}} +
D_{t} \log{\pi} +
(u_{t}C_{t} - D_{t})\log{(1 - \pi)},
\]</span></p>
<p>Esta estimación la realiza la función interna
<code>?cfr:::estimate_severity()</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9"> Limitaciones </h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" aria-labelledby="headingSolution9" data-bs-parent="#accordionSolution9">
<div class="accordion-body">
<ul>
<li>La TL ajustada al retraso temporal no aborda todas las fuentes de
error en los datos, como el infradiagnóstico de individuos
infectados.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="desafíos">Desafíos<a class="anchor" aria-label="anchor" href="#desaf%C3%ADos"></a>
</h2>
<hr class="half-width">
<div id="los-datos-agregados-difieren-de-los-listados-de-casos-individuales" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="los-datos-agregados-difieren-de-los-listados-de-casos-individuales" class="callout-inner">
<h3 class="callout-title">Los datos agregados difieren de los listados de casos individuales</h3>
<div class="callout-content">
<p>Los datos de incidencia <em>agregados</em> difieren de
<strong>lista</strong> en los que cada observación contiene datos a
nivel individual.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">outbreaks</span><span class="fu">::</span><span class="va">ebola_sierraleone_2014</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 11,903 × 8
      id   age sex   status    date_of_onset date_of_sample district chiefdom
   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;date&gt;        &lt;date&gt;         &lt;fct&gt;    &lt;fct&gt;
 1     1    20 F     confirmed 2014-05-18    2014-05-23     Kailahun Kissi Teng
 2     2    42 F     confirmed 2014-05-20    2014-05-25     Kailahun Kissi Teng
 3     3    45 F     confirmed 2014-05-20    2014-05-25     Kailahun Kissi Tonge
 4     4    15 F     confirmed 2014-05-21    2014-05-26     Kailahun Kissi Teng
 5     5    19 F     confirmed 2014-05-21    2014-05-26     Kailahun Kissi Teng
 6     6    55 F     confirmed 2014-05-21    2014-05-26     Kailahun Kissi Teng
 7     7    50 F     confirmed 2014-05-21    2014-05-26     Kailahun Kissi Teng
 8     8     8 F     confirmed 2014-05-22    2014-05-27     Kailahun Kissi Teng
 9     9    54 F     confirmed 2014-05-22    2014-05-27     Kailahun Kissi Teng
10    10    57 F     confirmed 2014-05-22    2014-05-27     Kailahun Kissi Teng
# ℹ 11,893 more rows</code></pre>
</div>
</div>
</div>
</div>
<div id="utiliza-el-paquete-incidence2-para-reordenar-tus-datos" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="utiliza-el-paquete-incidence2-para-reordenar-tus-datos" class="callout-inner">
<h3 class="callout-title">Utiliza el paquete incidence2 para reordenar tus datos</h3>
<div class="callout-content">
<p>Usando el paquete<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a>, carga el listado de casos
“MERS” incluido en el objeto <code>mers_korea_2015</code>.</p>
<p>Reordena el listado de casos para que tenga la estructura de entrada
requerida por el paquete <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>.</p>
<p>Estima el HFR ajustado al retardo utilizando el retardo de
distribución correspondiente.</p>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Dar una pista </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" aria-labelledby="headingHint4" data-bs-parent="#accordionHint4">
<div class="accordion-body">
<p><strong>¿Cómo reorganizar mis datos de entrada?</strong></p>
<p>Reorganizar los datos de entrada para el análisis de datos puede
llevarte la mayor parte del tiempo. Para estar listo para el análisis
con <em>datos de incidencia agregados</em> te animamos a utilizar
<a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> ¡!</p>
<p>Primero, en la viñeta <a href="https://www.reconverse.org/incidence2/articles/incidence2.html" class="external-link">Inicio</a>
de <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> explora cómo utilizar
<code>date_index</code> al leer un listado de casos con fechas en varias
columnas.</p>
<p>A continuación, consulta la viñeta <a href="https://epiverse-trace.github.io/cfr/articles/data_from_incidence2.html" class="external-link">Manejo
de datos de <code>{incidence2}</code></a> del paquete
<a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a>, sobre cómo utilizar la función
<code>cfr::prepare_data()</code> con los objetos incidence2.</p>
<!-- cita la entrada howto one lineslist + incidencia2 + conexión cfr -->
</div>
</div>
</div>
</div>
<div id="accordionSolution10" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution10" aria-expanded="false" aria-controls="collapseSolution10">
  <h4 class="accordion-header" id="headingSolution10"> Mostrar la solución </h4>
</button>
<div id="collapseSolution10" class="accordion-collapse collapse" aria-labelledby="headingSolution10" data-bs-parent="#accordionSolution10">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Carga los paquetes</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">cfr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">incidence2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">outbreaks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Accede a la distribución de retrasos temporales</span></span>
<span><span class="va">mers_delay</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"mers"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"onset to death"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Lee el listado de casos</span></span>
<span><span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"dt_"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 162 × 6
   dt_onset   dt_report  dt_start_exp dt_end_exp dt_diag    dt_death
   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;       &lt;date&gt;     &lt;date&gt;     &lt;date&gt;
 1 2015-05-11 2015-05-19 2015-04-18   2015-05-04 2015-05-20 NA
 2 2015-05-18 2015-05-20 2015-05-15   2015-05-20 2015-05-20 NA
 3 2015-05-20 2015-05-20 2015-05-16   2015-05-16 2015-05-21 2015-06-04
 4 2015-05-25 2015-05-26 2015-05-16   2015-05-20 2015-05-26 NA
 5 2015-05-25 2015-05-27 2015-05-17   2015-05-17 2015-05-26 NA
 6 2015-05-24 2015-05-28 2015-05-15   2015-05-17 2015-05-28 2015-06-01
 7 2015-05-21 2015-05-28 2015-05-16   2015-05-17 2015-05-28 NA
 8 2015-05-26 2015-05-29 2015-05-15   2015-05-15 2015-05-29 NA
 9 NA         2015-05-29 2015-05-15   2015-05-17 2015-05-29 NA
10 2015-05-21 2015-05-29 2015-05-16   2015-05-16 2015-05-29 NA
# ℹ 152 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Usa {incidence2} para contabilizar la incidencia diaria</span></span>
<span><span class="va">mers_incidence</span> <span class="op">&lt;-</span> <span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># convertir a un objeto incidence2</span></span>
<span>  <span class="fu">incidence</span><span class="op">(</span>date_index <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"dt_onset"</span>, <span class="st">"dt_death"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># completa las fechas de la primera a la última</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">complete_dates</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Explora los resultados de incidence2</span></span>
<span><span class="va">mers_incidence</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># incidence:  72 x 3
# count vars: dt_death, dt_onset
   date_index count_variable count
   &lt;date&gt;     &lt;chr&gt;          &lt;int&gt;
 1 2015-05-11 dt_death           0
 2 2015-05-11 dt_onset           1
 3 2015-05-12 dt_death           0
 4 2015-05-12 dt_onset           0
 5 2015-05-13 dt_death           0
 6 2015-05-13 dt_onset           0
 7 2015-05-14 dt_death           0
 8 2015-05-14 dt_onset           0
 9 2015-05-15 dt_death           0
10 2015-05-15 dt_onset           0
# ℹ 62 more rows</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepara los datos {incidence2} para usarlos en {cfr}</span></span>
<span><span class="va">mers_incidence</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">prepare_data</span><span class="op">(</span></span>
<span>    cases_variable <span class="op">=</span> <span class="st">"dt_onset"</span>,</span>
<span>    deaths_variable <span class="op">=</span> <span class="st">"dt_death"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>         date deaths cases
1  2015-05-11      0     1
2  2015-05-12      0     0
3  2015-05-13      0     0
4  2015-05-14      0     0
5  2015-05-15      0     0
6  2015-05-16      0     0
7  2015-05-17      0     1
8  2015-05-18      0     1
9  2015-05-19      0     0
10 2015-05-20      0     5
11 2015-05-21      0     6
12 2015-05-22      0     2
13 2015-05-23      0     4
14 2015-05-24      0     2
15 2015-05-25      0     3
16 2015-05-26      0     1
17 2015-05-27      0     2
18 2015-05-28      0     1
19 2015-05-29      0     3
20 2015-05-30      0     5
21 2015-05-31      0    10
22 2015-06-01      2    16
23 2015-06-02      0    11
24 2015-06-03      1     7
25 2015-06-04      1    12
26 2015-06-05      1     9
27 2015-06-06      0     7
28 2015-06-07      0     7
29 2015-06-08      2     6
30 2015-06-09      0     1
31 2015-06-10      2     6
32 2015-06-11      1     3
33 2015-06-12      0     0
34 2015-06-13      0     2
35 2015-06-14      0     0
36 2015-06-15      0     1</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estima la TL ajustada a retrasos temporales</span></span>
<span><span class="va">mers_incidence</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cfr</span><span class="fu">::</span><span class="fu">prepare_data</span><span class="op">(</span></span>
<span>    cases_variable <span class="op">=</span> <span class="st">"dt_onset"</span>,</span>
<span>    deaths_variable <span class="op">=</span> <span class="st">"dt_death"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">cfr</span><span class="fu">::</span><span class="fu">cfr_static</span><span class="op">(</span>delay_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">density</span><span class="op">(</span><span class="va">mers_delay</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  severity_estimate severity_low severity_high
1            0.0907        0.042        0.4847</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="heterogeneidad-de-la-gravedad" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="heterogeneidad-de-la-gravedad" class="callout-inner">
<h3 class="callout-title">Heterogeneidad de la gravedad</h3>
<div class="callout-content">
<p>La TL puede diferir entre poblaciones (por ejemplo, edad, espacio,
tratamiento); cuantificar estas heterogeneidades puede ayudar a dirigir
los recursos adecuadamente y a comparar distintos regímenes
asistenciales (<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<p>Utiliza la base de datos <code>cfr::covid_data</code> para estimar
una TL ajustada al retraso temporal estratificada por países.</p>
</div>
</div>
</div>
<div id="accordionHint5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint5" aria-expanded="false" aria-controls="collapseHint5">
  <h4 class="accordion-header" id="headingHint5"> Dar una pista </h4>
</button>
<div id="collapseHint5" class="accordion-collapse collapse" aria-labelledby="headingHint5" data-bs-parent="#accordionHint5">
<div class="accordion-body">
<p>Una forma de hacer un <em>análisis estratificado</em> es aplicar un
modelo a datos anidados. Esta <a href="https://tidyr.tidyverse.org/articles/nest.html#nested-data-and-models" class="external-link">viñeta
<code>{tidyr}</code></a> te muestra cómo aplicar la función
<code>group_by()</code> + <code>nest()</code> a los datos anidados, y
luego <code>mutate()</code> + <code>map()</code> para aplicar el
modelo.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution11" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution11" aria-expanded="false" aria-controls="collapseSolution11">
  <h4 class="accordion-header" id="headingSolution11"> Mostrar la solución </h4>
</button>
<div id="collapseSolution11" class="accordion-collapse collapse" aria-labelledby="headingSolution11" data-bs-parent="#accordionSolution11">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">cfr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covid_data</span> <span class="op">%&gt;%</span> <span class="fu">glimpse</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 20,786
Columns: 4
$ date    &lt;date&gt; 2020-01-03, 2020-01-03, 2020-01-03, 2020-01-03, 2020-01-03, 2…
$ country &lt;chr&gt; "Argentina", "Brazil", "Colombia", "France", "Germany", "India…
$ cases   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ deaths  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delay_onset_death</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epidist_db</span><span class="op">(</span></span>
<span>    disease <span class="op">=</span> <span class="st">"covid"</span>,</span>
<span>    epi_dist <span class="op">=</span> <span class="st">"onset to death"</span>,</span>
<span>    single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">covid_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">nest</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    temp <span class="op">=</span></span>
<span>      <span class="fu">map</span><span class="op">(</span></span>
<span>        .x <span class="op">=</span> <span class="va">data</span>,</span>
<span>        .f <span class="op">=</span> <span class="fu">cfr</span><span class="fu">::</span><span class="va">cfr_static</span>,</span>
<span>        delay_density <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">density</span><span class="op">(</span><span class="va">delay_onset_death</span>, <span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">temp</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 19 × 5
# Groups:   country [19]
   country        data     severity_estimate severity_low severity_high
   &lt;chr&gt;          &lt;list&gt;               &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
 1 Argentina      &lt;tibble&gt;            0.0133       0.0133        0.0133
 2 Brazil         &lt;tibble&gt;            0.0195       0.0195        0.0195
 3 Colombia       &lt;tibble&gt;            0.0225       0.0224        0.0226
 4 France         &lt;tibble&gt;            0.0044       0.0044        0.0044
 5 Germany        &lt;tibble&gt;            0.0045       0.0045        0.0045
 6 India          &lt;tibble&gt;            0.0119       0.0119        0.0119
 7 Indonesia      &lt;tibble&gt;            0.024        0.0239        0.0241
 8 Iran           &lt;tibble&gt;            0.0191       0.0191        0.0192
 9 Italy          &lt;tibble&gt;            0.0075       0.0075        0.0075
10 Mexico         &lt;tibble&gt;            0.0461       0.046         0.0462
11 Peru           &lt;tibble&gt;            0.0318       0.0151        0.202
12 Poland         &lt;tibble&gt;            0.0186       0.0186        0.0187
13 Russia         &lt;tibble&gt;            0.0182       0.0182        0.0182
14 South Africa   &lt;tibble&gt;            0.0254       0.0253        0.0255
15 Spain          &lt;tibble&gt;            0.0087       0.0087        0.0087
16 Turkey         &lt;tibble&gt;            0.006        0.006         0.006
17 Ukraine        &lt;tibble&gt;            0.0204       0.0203        0.0205
18 United Kingdom &lt;tibble&gt;            0.009        0.009         0.009
19 United States  &lt;tibble&gt;            0.0111       0.0111        0.0111</code></pre>
</div>
<p>¡Estupendo! Ahora puedes utilizar un código similar para cualquier
otro análisis estratificado, como la edad, las regiones u otros.</p>
<p>Pero, ¿cómo podemos interpretar que existe una variabilidad de
gravedad por países a partir del mismo patógeno diagnosticado?</p>
<p>Factores locales como la capacidad de análisis, la definición de caso
y el régimen de muestreo pueden afectar a la notificación de casos y
muertes, afectando así a la comprobación de los casos. Echa un vistazo a
la viñeta <a href="https://epiverse-trace.github.io/cfr/articles/estimate_ascertainment.html" class="external-link">Estimar
la proporción de casos que se determinan durante un brote</a> del
paquete <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> para más información ¡!</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="apéndice">Apéndice<a class="anchor" aria-label="anchor" href="#ap%C3%A9ndice"></a>
</h2>
<hr class="half-width">
<p>El paquete <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> tiene una función llamada
<code>cfr_time_varying()</code> con una funcionalidad distinta de
<code>cfr_rolling()</code>.</p>
<div id="cuándo-utilizar-cfr_rolling" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cuándo-utilizar-cfr_rolling" class="callout-inner">
<h3 class="callout-title">¿Cuándo utilizar cfr_rolling()?</h3>
<div class="callout-content">
<p><strong>cfr_rolling()</strong> muestra la TL estimada en cada día del
brote, dado que los datos futuros sobre casos y muertes no están
disponibles en ese momento. El valor final de <em>cfr_rolling()</em>
estimado es idéntico al de <em>cfr_static()</em> con los mismos
datos.</p>
<p>Recuerda, como se muestra arriba <em>cfr_rolling()</em> es útil para
obtener estimaciones de la TL en las primeras fases y comprobar si la
estimación de la TL de un brote se ha estabilizado. Así,
<em>cfr_rolling()</em> no es sensible a la duración ni al tamaño de la
epidemia.</p>
</div>
</div>
</div>
<div id="cuándo-utilizar-cfr_time_varying" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cuándo-utilizar-cfr_time_varying" class="callout-inner">
<h3 class="callout-title">¿Cuándo utilizar cfr_time_varying()?</h3>
<div class="callout-content">
<p>Por otra parte, <strong>cfr_time_varying()</strong> calcula la TL a
lo largo de una ventana móvil y ayuda a comprender los cambios en la TL
debidos a cambios en la epidemia, por ejemplo, debidos a una nueva
variante o a una mayor inmunidad por vacunación.</p>
<p>Sin embargo, <em>cfr_time_variying()</em> es sensible a la
incertidumbre del muestreo. Por tanto, es sensible al tamaño del brote.
Cuanto mayor sea el número de casos con resultados esperados en un día
determinado, más estimaciones razonables de la TL variable en el tiempo
obtendremos.</p>
<p>Por ejemplo, con 100 casos, la estimación del riesgo de mortalidad
tendrá, a grandes rasgos, un intervalo de confianza del 95% ±10% de la
estimación media (IC binomial). Por tanto, si tenemos &gt;100 casos con
resultados esperados <em>en un día determinado</em> podemos obtener
estimaciones razonables de la TL variable en el tiempo. Pero si sólo
tenemos &gt;100 casos <em>a lo largo de toda la epidemia</em>
probablemente tengamos que basarnos en <strong>cfr_rolling()</strong>
que utiliza los datos acumulados.</p>
<p>Te invitamos a leer esta <a href="https://epiverse-trace.github.io/cfr/articles/estimate_time_varying_severity.html" class="external-link">viñeta
sobre <code>cfr_time_varying()</code></a>.</p>
</div>
</div>
</div>
<div id="más-medidas-de-gravedad" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="más-medidas-de-gravedad" class="callout-inner">
<h3 class="callout-title">Más medidas de gravedad</h3>
<div class="callout-content">
<p>Supongamos que necesitamos evaluar la gravedad clínica de la epidemia
en un contexto distinto al de los datos de vigilancia, como la gravedad
entre los casos que llegan a los hospitales o los casos que recogiste en
una encuesta serológica representativa.</p>
<p>Utilizando <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> podemos cambiar las entradas para el
numerador <strong>casos</strong> (<code>cases</code>) y el denominador
<strong>muertes</strong> (<code>deaths</code>) para estimar más medidas
de gravedad, como el Riesgo de Fatalidad por Infección (RFI) o el Riesgo
de Fatalidad por Hospitalización (RFH). Podemos seguir esta
analogía:</p>
</div>
</div>
</div>
<div id="accordionSolution12" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution12" aria-expanded="false" aria-controls="collapseSolution12">
  <h4 class="accordion-header" id="headingSolution12"> Riesgo de mortalidad por infección y hospitalización </h4>
</button>
<div id="collapseSolution12" class="accordion-collapse collapse" aria-labelledby="headingSolution12" data-bs-parent="#accordionSolution12">
<div class="accordion-body">
<p>Si para la una <em>Tasa de letalidad</em> (TL o CFR en inglés),
exigimos:</p>
<ul>
<li>
<em>Incidencia</em> de casos y muertes, con una:</li>
<li>Distribución de retraso temporal entre casos y muertes (o una
aproximación cercana, como el tiempo entre inicio de los síntomas y la
muerte).</li>
</ul>
<p>Entonces, el <em>Riesgo de Fatalidad por Infección</em> (IFR, por sus
siglas en inglés) requiere:</p>
<ul>
<li>Incidencia de <em>infecciones</em> y muertes, con una:</li>
<li>Distribución de retraso temporal desde la infección hasta la muerte
(o una aproximación cercana).</li>
</ul>
<p>Del mismo modo, el <em>Riesgo de Fatalidad por Hospitalización</em>
(HFR) requiere:</p>
<ul>
<li>Incidencia de <em>hospitalizaciones</em> y muertes, y una:</li>
<li>Distribución del retraso temporal entre la hospitalización y la
muerte.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution13" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution13" aria-expanded="false" aria-controls="collapseSolution13">
  <h4 class="accordion-header" id="headingSolution13"> Fuentes de datos para más medidas de gravedad </h4>
</button>
<div id="collapseSolution13" class="accordion-collapse collapse" aria-labelledby="headingSolution13" data-bs-parent="#accordionSolution13">
<div class="accordion-body">
<p><a href="https://www.nature.com/articles/s41467-020-19238-2/figures/1" class="external-link">Yang
et al., 2020</a> resume diferentes definiciones y fuentes de datos:</p>
<figure><img src="fig/cfr-s41467-020-19238-2-fig_a.png" alt="Niveles de gravedad de las infecciones por SRAS-CoV-2 y parámetros de interés. Se supone que cada nivel es un subconjunto del nivel inferior." class="figure mx-auto d-block"><div class="figcaption">Niveles de gravedad de las infecciones por
SRAS-CoV-2 y parámetros de interés. Se supone que cada nivel es un
subconjunto del nivel inferior.</div>
</figure><ul>
<li>sCFR riesgo sintomático de letalidad,</li>
<li>sCHR riesgo sintomático de hospitalización,</li>
<li>mCFR riesgo de caso-fatalidad médicamente atendido,</li>
<li>mCHR riesgo de hospitalización de casos atendidos médicamente,</li>
<li>HFR riesgo de hospitalización-fatalidad.</li>
</ul>
<figure><img src="fig/cfr-s41467-020-19238-2-fig_b.png" alt="Diagrama esquemático de los análisis de referencia. Las flechas rojas, azules y verdes indican el flujo de datos desde los casos confirmados por laboratorio de la vigilancia pasiva, los casos diagnosticados clínicamente y los casos confirmados por laboratorio de los cribados activos." class="figure mx-auto d-block"><div class="figcaption">Diagrama esquemático de los análisis de
referencia. Las flechas rojas, azules y verdes indican el flujo de datos
desde los casos confirmados por laboratorio de la vigilancia pasiva, los
casos diagnosticados clínicamente y los casos confirmados por
laboratorio de los cribados activos.</div>
</figure>
</div>
</div>
</div>
</div>
<div id="discussion5" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discusión</h3>
<div class="callout-content">
<p>Basándote en tu experiencia:</p>
<ul>
<li>Comparte algún brote anterior en el que hayas participado en su
respuesta.</li>
</ul>
<p>Responde a estas preguntas:</p>
<ul>
<li>¿Cómo evaluaste la gravedad clínica del brote?</li>
<li>¿Cuáles fueron las principales fuentes de sesgo?</li>
<li>¿Qué hiciste para tener en cuenta el sesgo identificado?</li>
<li>¿Qué análisis complementario harías para resolver el sesgo?</li>
</ul>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li><p>Utiliza <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> para estimar la gravedad</p></li>
<li><p>Utiliza <code>cfr_static()</code> para estimar la TL global con
los últimos datos disponibles.</p></li>
<li><p>Utiliza <code>cfr_rolling()</code> para mostrar cuál sería la TL
estimada en cada día del brote.</p></li>
<li><p>Utiliza la <code>delay_density</code> para ajustar la TL según la
distribución de retrasos correspondiente.</p></li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-superspreading-estimate"><p>Content from <a href="superspreading-estimate.html">Account for superspreading</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/superspreading-estimate.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>How can we estimate individual-level variation in transmission
(i.e. superspreading potential) from contact tracing data?</li>
<li>What are the implications for variation in transmission for
decision-making?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Estimate the distribution of onward transmission from infected
individuals (i.e. offspring distribution) from outbreak data using
<a href="https://www.repidemicsconsortium.org/epicontacts/" class="external-link">epicontacts</a>.</li>
<li>Estimate the extent of individual-level variation (i.e. the
dispersion parameter) of the offspring distribution using
<a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a>.</li>
<li>Estimate the proportion of transmission that is linked to
‘superspreading events’ using <code>{superspreading}</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<p>Learners should familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Statistics</strong>: common probability distributions,
particularly Poisson and negative binomial.</p>
<p><strong>Epidemic theory</strong>: The reproduction number, R.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<!-- we know --><p>From smallpox to severe acute respiratory syndrome coronavirus 2
(SARS-CoV-2), some infected individuals spread infection to more people
than others. Disease transmission is the result of a combination of
biological and social factors, and these factors average out to some
extent at the population level during a large epidemic. Hence
researchers often use population averages to assess the potential for
disease to spread. However, in the earlier or later phases of an
outbreak, individual differences in infectiousness can be more
important. In particular, they increase the chance of superspreading
events (SSEs), which can ignite explosive epidemics and also influence
the chances of controlling transmission (<a href="https://wellcomeopenresearch.org/articles/5-83" class="external-link">Lloyd-Smith et
al., 2005</a>).</p>
<figure><img src="fig/see-intro-superspreading.png" alt="Chains of SARS-CoV-2 transmission in Hong Kong initiated by local or imported cases. (a), Transmission network of a cluster of cases traced back to a collection of four bars across Hong Kong (n = 106). (b), Transmission network associated with a wedding without clear infector–infectee pairs but linked back to a preceding social gathering and local source (n = 22). (c), Transmission network associated with a temple cluster of undetermined source (n = 19). (d), All other clusters of SARS-CoV-2 infections where the source and transmission chain could be determined (Adam et al., 2020)." class="figure mx-auto d-block"><div class="figcaption">
<strong>Chains of SARS-CoV-2 transmission in
Hong Kong initiated by local or imported cases.</strong>
(<strong>a</strong>), Transmission network of a cluster of cases traced
back to a collection of four bars across Hong Kong (n = 106).
(<strong>b</strong>), Transmission network associated with a wedding
without clear infector–infectee pairs but linked back to a preceding
social gathering and local source (n = 22). (<strong>c</strong>),
Transmission network associated with a temple cluster of undetermined
source (n = 19). (<strong>d</strong>), All other clusters of SARS-CoV-2
infections where the source and transmission chain could be determined
(<a href="https://www.nature.com/articles/s41591-020-1092-0" class="external-link">Adam et
al., 2020</a>).</div>
</figure><!-- we dont know --><p>The <a href="reference.html#basic">basic reproduction number</a>,
<span class="math inline">\(R_{0}\)</span>, measures the average number
of cases caused by one infectious individual in a entirely susceptible
population. Estimates of <span class="math inline">\(R_{0}\)</span> are
useful for understanding the average dynamics of an epidemic at the
population-level, but can obscure considerable individual variation in
infectiousness. This was highlighted during the global emergence of
SARS-CoV-2 by numerous ‘superspreading events’ in which certain
infectious individuals generated unusually large numbers of secondary
cases (<a href="https://wellcomeopenresearch.org/articles/5-83" class="external-link">LeClerc
et al, 2020</a>).</p>
<figure><img src="fig/see-intro-secondary-cases-fig-b.png" alt="R = 0.58 and k = 0.43." class="figure mx-auto d-block"><div class="figcaption">
<strong>Observed offspring distribution of
SARS-CoV-2 transmission in Hong Kong.</strong> N = 91 SARS-CoV-2
infectors, N = 153 terminal infectees and N = 46 sporadic local cases.
Histogram bars indicate the proportion of onward transmission per amount
of secondary cases. Line corresponds to a fitted negative binomial
distribution (<a href="https://www.nature.com/articles/s41591-020-1092-0" class="external-link">Adam et al.,
2020</a>).</div>
</figure><!-- we want --><p>In this tutorial, we are going to quantify individual variation in
transmission, and hence estimate the potential for superspreading
events. Then we are going to use these estimates to explore the
implications of superspreading for contact tracing interventions.</p>
<p>We are going to use data from the <a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> package,
manage the linelist and contacts data using <a href="https://www.repidemicsconsortium.org/epicontacts/" class="external-link">epicontacts</a>,
and estimate distribution parameters with <a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a>.
Lastly, we are going to use <code>{superspreading}</code> to explore the
implications of variation in transmission for decision-making.</p>
<p>We’ll use the pipe <code>%&gt;%</code> to connect some of the
functions from these packages, so let’s also call the
<a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> package.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">outbreaks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epicontacts</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">fitdistrplus</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">superspreading</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-double-colon" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="the-double-colon" class="callout-inner">
<h3 class="callout-title">The double-colon</h3>
<div class="callout-content">
<p>The double-colon <code>::</code> in R let you call a specific
function from a package without loading the entire package into the
current environment.</p>
<p>For example, <code>dplyr::filter(data, condition)</code> uses
<code>filter()</code> from the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package.</p>
<p>This help us remember package functions and avoid namespace
conflicts.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="the-individual-reprodution-number">The individual reprodution number<a class="anchor" aria-label="anchor" href="#the-individual-reprodution-number"></a>
</h2>
<hr class="half-width">
<p>The individual reproduction number is defined as the number of
secondary cases caused by a particular infected individual.</p>
<p>Early in an outbreak we can use contact data to reconstruct
transmission chains (i.e. who infected whom) and calculate the number of
secondary cases generated by each individual. This reconstruction of
linked transmission events from contact data can provide an
understanding about how different individuals have contributed to
transmission during an epidemic (<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<p>Let’s practice this using the <code>mers_korea_2015</code> linelist
and contact data from the <a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> package and integrate
them with the <a href="https://www.repidemicsconsortium.org/epicontacts/" class="external-link">epicontacts</a> package to calculate the
distribution of secondary cases during the 2015 MERS-CoV outbreak in
South Korea (<a href="https://community.appliedepi.org/t/estimating-the-degree-of-super-spreading-from-transmission-chain-data/103/2" class="external-link">Campbell,
2022</a>):</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first, make an epicontacts object</span></span>
<span><span class="va">epi_contacts</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epicontacts</span><span class="fu">::</span><span class="fu">make_epicontacts</span><span class="op">(</span></span>
<span>    linelist <span class="op">=</span> <span class="fu">outbreaks</span><span class="fu">::</span><span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">linelist</span>,</span>
<span>    contacts <span class="op">=</span> <span class="fu">outbreaks</span><span class="fu">::</span><span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">contacts</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise contact network</span></span>
<span><span class="fu">epicontacts</span><span class="fu">::</span><span class="fu">vis_epicontacts</span><span class="op">(</span><span class="va">epi_contacts</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-estimate-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Is contact data tidy? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Contact data from a transmission chain can provide information on
which infected individuals came into contact with others. We expect to
have the infector (<code>from</code>) and the infectee (<code>to</code>)
plus additional columns of variables related to their contact, such as
location (<code>exposure</code>) and date of contact.</p>
<p>Following <a href="https://tidyr.tidyverse.org/articles/tidy-data.html#tidy-data" class="external-link">tidy
data</a> principles, the observation unit in our contact dataset is the
<strong>infector-infectee</strong> pair. Although one infector can
infect multiple infectees, from contact tracing investigations we may
record contacts linked to more than one infector (e.g. within a
household). But we should expect to have unique infector-infectee pairs,
because typically each infected person will have acquired the infection
from one other.</p>
<p>To ensure these unique pairs, we can check on replicates for
infectees:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no infector-infectee pairs are replicated</span></span>
<span><span class="va">epi_contacts</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">pluck</span><span class="op">(</span><span class="st">"contacts"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">to</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 4
# Groups:   to [2]
  from  to     exposure       diff_dt_onset
  &lt;chr&gt; &lt;chr&gt;  &lt;fct&gt;                  &lt;int&gt;
1 SK_16 SK_107 Emergency room            17
2 SK_87 SK_107 Emergency room             2
3 SK_14 SK_39  Hospital room             16
4 SK_11 SK_39  Hospital room             13
5 SK_12 SK_39  Hospital room             12</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>When each infector-infectee row is unique, the number of entries per
infector corresponds to the number of secondary cases generated by that
individual.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># count secondary cases per infector</span></span>
<span><span class="va">infector_secondary</span> <span class="op">&lt;-</span> <span class="va">epi_contacts</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">pluck</span><span class="op">(</span><span class="st">"contacts"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">from</span>, name <span class="op">=</span> <span class="st">"secondary_cases"</span><span class="op">)</span></span></code></pre>
</div>
<p>But this output only contains number of secondary cases for reported
infectors, not for each of the individuals in the whole
<code>epicontacts</code> object.</p>
<p>To get this, first, we can use <code>epicontacts::get_id()</code> to
get the full list of unique identifiers (“id”) from the
<code>epicontacts</code> class object. Second, join it with the count
secondary cases per infector stored in the
<code>infector_secondary</code> object. Third, replace the missing
values with <code>0</code> to express no report of secondary cases from
them.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_secondary</span> <span class="op">&lt;-</span> <span class="va">epi_contacts</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># extract ids in contact *and* linelist using "which" argument</span></span>
<span>  <span class="fu">epicontacts</span><span class="fu">::</span><span class="fu">get_id</span><span class="op">(</span>which <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># transform vector to dataframe to use left_join()</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu">enframe</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, value <span class="op">=</span> <span class="st">"from"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># join count secondary cases per infectee</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">left_join</span><span class="op">(</span><span class="va">infector_secondary</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># infectee with missing secondary cases are replaced with zero</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span></span>
<span>    replace <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>secondary_cases <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p>From a histogram of the <code>all_secondary</code> object, we can
identify the <strong>individual-level variation</strong> in the number
of secondary cases. Three cases were related to more than 20 secondary
cases, while the complementary cases with less than five or zero
secondary cases.</p>
<!-- Visualizing the number of secondary cases on a histogram will help us to relate this with the statistical distribution to fit: -->
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## plot the distribution</span></span>
<span><span class="va">all_secondary</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">secondary_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of secondary cases"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-estimate-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The number of secondary cases can be used to <em>empirically</em>
estimate the <strong>offspring distribution</strong>, which is the
number of secondary <em>infections</em> caused by each case. One
candidate statistical distribution used to model the offspring
distribution is the <strong>negative binomial</strong> distribution with
two parameters:</p>
<ul>
<li><p><strong>Mean</strong>, which represents the <span class="math inline">\(R_{0}\)</span>, the average number of (secondary)
cases produced by a single individual in an entirely susceptible
population, and</p></li>
<li><p><strong>Dispersion</strong>, expressed as <span class="math inline">\(k\)</span>, which represents the individual-level
variation in transmission by single individuals.</p></li>
</ul>
<figure><img src="fig/superspreading-estimate-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>From the histogram and density plot, we can identify that the
offspring distribution is highly skewed or
<strong>overdispersed</strong>. In this framework, the superspreading
events (SSEs) are not arbitrary or exceptional, but simply realizations
from the right-hand tail of the offspring distribution, which we can
quantify and analyse (<a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a>).</p>
<div id="terminology-recap" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="terminology-recap" class="callout-inner">
<h3 class="callout-title">Terminology recap</h3>
<div class="callout-content">
<ul>
<li>From linelist and contact data, we calculate the <strong>number of
secondary cases</strong> caused by the observed infected
individuals.</li>
<li>Whereas <span class="math inline">\(R_{0}\)</span> captures the
average transmission in the population, we can define the
<strong>individual reproduction number</strong> as a random variable
representing the <em>expected</em> number of secondary cases caused by a
infected individual.</li>
<li>From the stochastic effects in transmission, the number of secondary
<em>infections</em> caused by each case is described by an
<strong>offspring distribution</strong>.</li>
<li>An <em>empirical</em> offspring distribution can be modeled by the
<strong>negative-binomial</strong> distribution with mean <span class="math inline">\(R_{0}\)</span> and dispersion parameter <span class="math inline">\(k\)</span>.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Poisson, overdispersion, and Negative Binomial </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<!-- distribution stories -->
<p>For occurrences of associated discrete events we can use
<strong>Poisson</strong> or negative binomial discrete
distributions.</p>
<p>In a Poisson distribution, mean is equal to variance. But when
variance is higher than the mean, this is called
<strong>overdispersion</strong>. In biological applications,
overdispersion occurs and so a negative binomial may be worth
considering as an alternative to Poisson distribution.</p>
<p><strong>Negative binomial</strong> distribution is specially useful
for discrete data over an unbounded positive range whose sample variance
exceeds the sample mean. In such terms, the observations are
overdispersed with respect to a Poisson distribution, for which the mean
is equal to the variance.</p>
<p>In epidemiology, <a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" class="external-link">negative
binomial</a> have being used to model disease transmission for
infectious diseases where the likely number of onward infections may
vary considerably from individual to individual and from setting to
setting, capturing all variation in infectious histories of individuals,
including properties of the biological (i.e. degree of viral shedding)
and environmental circumstances (e.g. type and location of contact).</p>
</div>
</div>
</div>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Desafío</h3>
<div class="callout-content">
<p>Calculate the distribution of secondary cases for Ebola using the
<code>ebola_sim_clean</code> object from <a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a>
package.</p>
<p>Is the offspring distribution of Ebola skewed or overdispersed?</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Dar una pista </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p><strong>Note:</strong> This dataset has 5829 cases. Running
<code>epicontacts::vis_epicontacts()</code> may overload your
session!</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Mostrar la solución </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first, make an epicontacts object</span></span>
<span><span class="va">ebola_contacts</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">epicontacts</span><span class="fu">::</span><span class="fu">make_epicontacts</span><span class="op">(</span></span>
<span>    linelist <span class="op">=</span> <span class="va">ebola_sim_clean</span><span class="op">$</span><span class="va">linelist</span>,</span>
<span>    contacts <span class="op">=</span> <span class="va">ebola_sim_clean</span><span class="op">$</span><span class="va">contacts</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># count secondary cases</span></span>
<span></span>
<span><span class="va">ebola_infector_secondary</span> <span class="op">&lt;-</span> <span class="va">ebola_contacts</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">pluck</span><span class="op">(</span><span class="st">"contacts"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">from</span>, name <span class="op">=</span> <span class="st">"secondary_cases"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_secondary</span> <span class="op">&lt;-</span> <span class="va">ebola_contacts</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># extract ids in contact *and* linelist using "which" argument</span></span>
<span>  <span class="fu">epicontacts</span><span class="fu">::</span><span class="fu">get_id</span><span class="op">(</span>which <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># transform vector to dataframe to use left_join()</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu">enframe</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, value <span class="op">=</span> <span class="st">"from"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># join count secondary cases per infectee</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">left_join</span><span class="op">(</span><span class="va">ebola_infector_secondary</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># infectee with missing secondary cases are replaced with zero</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">replace_na</span><span class="op">(</span></span>
<span>    replace <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>secondary_cases <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## plot the distribution</span></span>
<span><span class="va">ebola_secondary</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">secondary_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Number of secondary cases"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Frequency"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-estimate-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>From a visual inspection, the distribution of secondary cases for the
Ebola data set in <code>ebola_sim_clean</code> shows an skewed
distribution with secondary cases equal or lower than 6. We need to
complement this observation with a statistical analysis to evaluate for
overdispersion.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="estimate-the-dispersion-parameter">Estimate the dispersion parameter<a class="anchor" aria-label="anchor" href="#estimate-the-dispersion-parameter"></a>
</h2>
<hr class="half-width">
<p>To empirically estimate the dispersion parameter <span class="math inline">\(k\)</span>, we could fit a negative binomial
distribution to the number of secondary cases.</p>
<p>We can fit distributions to data using the
<a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a> package, which provides maximum likelihood
estimates.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">fitdistrplus</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## fit distribution</span></span>
<span><span class="va">offspring_fit</span> <span class="op">&lt;-</span> <span class="va">all_secondary</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">pull</span><span class="op">(</span><span class="va">secondary_cases</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu">fitdist</span><span class="op">(</span>distr <span class="op">=</span> <span class="st">"nbinom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">offspring_fit</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Fitting of the distribution ' nbinom ' by maximum likelihood
Parameters:
       estimate  Std. Error
size 0.02039807 0.007278299
mu   0.60452947 0.337893199</code></pre>
</div>
<div id="name-of-parameters" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="name-of-parameters" class="callout-inner">
<h3 class="callout-title">Name of parameters</h3>
<div class="callout-content">
<p>From the <a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a> output:</p>
<ul>
<li>The <code>size</code> object refers to the estimated dispersion
parameter <span class="math inline">\(k\)</span>, and</li>
<li>The <code>mu</code> object refers to the estimated mean, which
represents the <span class="math inline">\(R_{0}\)</span>,</li>
</ul>
</div>
</div>
</div>
<p>From the number secondary cases distribution we estimated a
dispersion parameter <span class="math inline">\(k\)</span> of 0.02,
with a 95% Confidence Interval from 0.006 to 0.035. As the value of
<span class="math inline">\(k\)</span> is significantly lower than one,
we can conclude that there is considerable potential for superspreading
events.</p>
<p>We can overlap the estimated density values of the fitted negative
binomial distribution and the histogram of the number of secondary
cases:</p>
<figure><img src="fig/superspreading-estimate-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="individual-level-variation-in-transmission" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="individual-level-variation-in-transmission" class="callout-inner">
<h3 class="callout-title">Individual-level variation in transmission</h3>
<div class="callout-content">
<p>The individual-level variation in transmission is defined by the
relationship between the mean (<span class="math inline">\(R_{0}\)</span>), dispersion (<span class="math inline">\(k\)</span>), and the variance of a negative
binomial distribution.</p>
<p>The negative binomial model has <span class="math inline">\(variance
= R_{0}(1+\frac{R_{0}}{k})\)</span>, so smaller values of <span class="math inline">\(k\)</span> indicate greater variance and,
consequently, greater <strong>individual-level variation</strong> in
transmission.</p>
<p><span class="math display">\[\uparrow variance =
R_{0}(1+\frac{R_{0}}{\downarrow k})\]</span></p>
<p>When <span class="math inline">\(k\)</span> approaches infinity
(<span class="math inline">\(k \rightarrow \infty\)</span>) the variance
equals the mean (because <span class="math inline">\(\frac{R_{0}}{\infty}=0\)</span>). This makes the
conventional Poisson model an special case of the negative binomial
model.</p>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Desafío</h3>
<div class="callout-content">
<p>Use the distribution of secondary cases from the
<code>ebola_sim_clean</code> object from <a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a>
package.</p>
<p>Fit a negative binomial distribution to estimate the mean and
dispersion parameter of the offspring distribution.</p>
<p>Does the estimated dispersion parameter of Ebola provide evidence of
an individual-level variation in transmission?</p>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Dar una pista </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>Review how we fitted a negative binomial distribution using the
<code>fitdistrplus::fitdist()</code> function.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Mostrar la solución </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_offspring</span> <span class="op">&lt;-</span> <span class="va">ebola_secondary</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">pull</span><span class="op">(</span><span class="va">secondary_cases</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu">fitdist</span><span class="op">(</span>distr <span class="op">=</span> <span class="st">"nbinom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_offspring</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Fitting of the distribution ' nbinom ' by maximum likelihood
Parameters:
     estimate  Std. Error
size 2.353899 0.250124611
mu   0.539300 0.009699219</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## extract the "size" parameter</span></span>
<span><span class="va">ebola_mid</span> <span class="op">&lt;-</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">estimate</span><span class="op">[[</span><span class="st">"size"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## calculate the 95% confidence intervals using the standard error estimate and</span></span>
<span><span class="co">## the 0.025 and 0.975 quantiles of the normal distribution.</span></span>
<span></span>
<span><span class="va">ebola_lower</span> <span class="op">&lt;-</span> <span class="va">ebola_mid</span> <span class="op">+</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">sd</span><span class="op">[[</span><span class="st">"size"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fu">qnorm</span><span class="op">(</span><span class="fl">0.025</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_upper</span> <span class="op">&lt;-</span> <span class="va">ebola_mid</span> <span class="op">+</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">sd</span><span class="op">[[</span><span class="st">"size"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="fu">qnorm</span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ebola_mid</span></span>
<span><span class="co"># ebola_lower</span></span>
<span><span class="co"># ebola_upper</span></span></code></pre>
</div>
<p>From the number secondary cases distribution we estimated a
dispersion parameter <span class="math inline">\(k\)</span> of 2.354,
with a 95% Confidence Interval from 1.864 to 2.844.</p>
<p>For dispersion parameter estimates higher than one we get low
distribution variance, hence, low individual-level variation in
transmission.</p>
<p>But does this mean that the secondary case distribution does not have
superspreading events (SSEs)? You will later find one additional
challenge: How do you define an SSE threshold for Ebola?</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Select the best model </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>We can use the maximum likelihood estimates from
<a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a> to compare different models and assess fit
performance using estimators like the AIC and BIC. Read further in the
vignette on <a href="https://epiverse-trace.github.io/superspreading/articles/estimate_individual_level_transmission.html" class="external-link">Estimate
individual-level transmission</a> and use the
<code>{superspreading}</code> helper function <code>ic_tbl()</code> for
this!</p>
</div>
</div>
</div>
</div>
<div id="the-dispersion-parameter-across-diseases" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="the-dispersion-parameter-across-diseases" class="callout-inner">
<h3 class="callout-title">The dispersion parameter across diseases</h3>
<div class="callout-content">
<p>Research into sexually transmitted and vector-borne diseases has
previously suggested a ‘20/80’ rule, with 20% of individuals
contributing at least 80% of the transmission potential (<a href="https://www.pnas.org/doi/10.1073/pnas.94.1.338" class="external-link">Woolhouse et
al</a>).</p>
<p>On its own, the dispersion parameter <span class="math inline">\(k\)</span> is hard to interpret intuitively, and
hence converting into proportional summary can enable easier comparison.
When we consider a wider range of pathogens, we can see there is no hard
and fast rule for the percentage that generates 80% of transmission, but
variation does emerge as a common feature of infectious diseases</p>
<ul>
<li><p>When the 20% most infectious cases contribute to the 80% of
transmission (or more), there is a high individual-level variation in
transmission, with a highly overdispersed offspring distribution (<span class="math inline">\(k&lt;0.1\)</span>), e.g., SARS-1.</p></li>
<li><p>When the 20% most infectious cases contribute to the ~50% of
transmission, there is a low individual-level variation in transmission,
with a moderately dispersed offspring distribution (<span class="math inline">\(k &gt; 0.1\)</span>), e.g. Pneumonic
Plague.</p></li>
</ul>
<figure><img src="fig/SEE-individual-reproductive-number-fig-c-d.png" alt="Evidence for variation in individual reproductive number. (Left, c) Proportion of transmission expected from the most infectious 20% of cases, for 10 outbreak or surveillance data sets (triangles). Dashed lines show proportions expected under the 20/80 rule (top) and homogeneity (bottom). (Right, d), Reported superspreading events (SSEs; diamonds) relative to estimated reproductive number R (squares) for twelve directly transmitted infections. Crosses show the 99th-percentile proposed as threshold for SSEs. (More figure details in Lloyd-Smith et al., 2005)" class="figure mx-auto d-block"><div class="figcaption">
<strong>Evidence for variation in individual
reproductive number</strong>. (Left, c) Proportion of transmission
expected from the most infectious 20% of cases, for 10 outbreak or
surveillance data sets (triangles). Dashed lines show proportions
expected under the 20/80 rule (top) and homogeneity (bottom). (Right,
d), Reported superspreading events (SSEs; diamonds) relative to
estimated reproductive number R (squares) for twelve directly
transmitted infections. Crosses show the 99th-percentile proposed as
threshold for SSEs. (More figure details in <a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a>)</div>
</figure>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="controlling-superspreading-with-contact-tracing">Controlling superspreading with contact tracing<a class="anchor" aria-label="anchor" href="#controlling-superspreading-with-contact-tracing"></a>
</h2>
<hr class="half-width">
<p>During an outbreak, it is common to try and reduce transmission by
identifying people who have come into contact with an infected person,
then quarantine them in case they subsequently turn out to be infected.
Such contact tracing can be deployed in multiple ways. ‘Forward’ contact
tracing targets downstream contacts who may have been infected by a
newly identifed infection (i.e. the ‘index case’). ‘Backward’ tracing
instead tracks the upstream primary case who infected the index case (or
a setting or event at which the index case was infected), for example by
retracing history of contact to the likely point of exposure. This makes
it possible to identify others who were also potentially infected by
this earlier primary case.</p>
<p>In the presence of individual-level variation in transmission, i.e.,
with an overdispersed offspring distribution, if this primary case is
identified, a larger fraction of the transmission chain can be detected
by forward tracing each of the contacts of this primary case (<a href="https://wellcomeopenresearch.org/articles/5-239/v3" class="external-link">Endo et al.,
2020</a>).</p>
<figure><img src="fig/contact-tracing-strategies.png" alt="Schematic representation of contact tracing strategies. Black arrows indicate the directions of transmission, blue and Orange arrows, a successful or failed contact tracing, respectivelly. When there is evidence of individual-level variation in transmission, often resulting in superspreading, backward contact tracing from the index case (blue circle) increase the probability to find the primary case (green circle) or clusters with a larger fraction of cases, potentially increasing the number of quarentined cases (yellow circles). Claire Blackmore, 2021" class="figure mx-auto d-block"><div class="figcaption">Schematic representation of contact tracing
strategies. Black arrows indicate the directions of transmission, blue
and Orange arrows, a successful or failed contact tracing,
respectivelly. When there is evidence of individual-level variation in
transmission, often resulting in superspreading, backward contact
tracing from the index case (blue circle) increase the probability to
find the primary case (green circle) or clusters with a larger fraction
of cases, potentially increasing the number of quarentined cases (yellow
circles). <a href="https://www.paho.org/sites/default/files/backward_contact_tracing_v3_0.pdf" class="external-link">Claire
Blackmore, 2021</a>
</div>
</figure><p>When there is evidence of individual-level variation
(i.e. overdispersion), often resulting in so-called superspreading
events, a large proportion of infections may be linked to a small
proportion of original clusters. As a result, finding and targeting
originating clusters in combination with reducing onwards infection may
substantially enhance the effectiveness of tracing methods (<a href="https://wellcomeopenresearch.org/articles/5-239/v3" class="external-link">Endo et al.,
2020</a>).</p>
<p>Empirical evidence focused on evaluating the efficiency of backward
tracing lead to 42% more cases identified than forward tracing
supporting its implementation when rigorous suppression of transmission
is justified (<a href="https://www.nature.com/articles/s41467-022-32531-6" class="external-link">Raymenants et
al., 2022</a>)</p>
</section><section><h2 class="section-heading" id="probability-of-cases-in-a-given-cluster">Probability of cases in a given cluster<a class="anchor" aria-label="anchor" href="#probability-of-cases-in-a-given-cluster"></a>
</h2>
<hr class="half-width">
<p>Using <code>{superspreading}</code>, we can estimate the probability
of having a cluster of secondary infections caused by a primary case
identified by backward tracing of size <span class="math inline">\(X\)</span> or larger (<a href="https://wellcomeopenresearch.org/articles/5-239/v3" class="external-link">Endo et al.,
2020</a>).</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for random number generator</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate the probability of</span></span>
<span><span class="co"># having a cluster size of 5, 10, or 25</span></span>
<span><span class="co"># secondary cases from a primary case,</span></span>
<span><span class="co"># given known reproduction number and</span></span>
<span><span class="co"># dispersion parameter.</span></span>
<span><span class="fu">superspreading</span><span class="fu">::</span><span class="fu">proportion_cluster_size</span><span class="op">(</span></span>
<span>  R <span class="op">=</span> <span class="va">offspring_fit</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"mu"</span><span class="op">]</span>,</span>
<span>  k <span class="op">=</span> <span class="va">offspring_fit</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>  cluster_size <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          R          k prop_5 prop_10 prop_25
1 0.6045295 0.02039807  87.9%   74.6%   46.1%</code></pre>
</div>
<p>Even though we have an <span class="math inline">\(R&lt;1\)</span>, a
highly overdispersed offspring distribution (<span class="math inline">\(k=0.02\)</span>) means that if we detect a new
case, there is a 46.1% probability they originated from a cluster of 25
infections or more. Hence, by following a backwards strategy, contact
tracing efforts will increase the probability of successfully contain
and quarantining this large number of earlier infected individuals,
rather than simply focusing on the new case, who is likely to have
infected nobody (because <span class="math inline">\(k\)</span> is very
small).</p>
<p>We can also use this number to prevent gathering of certain sized to
reduce the epidemic by preventing potential superspreading events.
Interventions can target to reduce the reproduction number in order to
reduce the probability of having clusters of secondary cases.</p>
<div id="backward-contact-tracing-for-ebola" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="backward-contact-tracing-for-ebola" class="callout-inner">
<h3 class="callout-title">Backward contact tracing for Ebola</h3>
<div class="callout-content">
<p>Use the Ebola estimated parameters for <code>ebola_sim_clean</code>
object from <a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> package.</p>
<p>Calculate the probability of having a cluster of secondary infections
caused by a primary case identified by backward tracing of size 5, 10,
15 or larger.</p>
<p>Would implementing a backward strategy at this stage of the Ebola
outbreak increase the probability of containing and quarantining more
onward cases?</p>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Dar una pista </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>Review how we estimated the probability of having clusters of a fixed
size, given an offspring distribution mean and dispersion parameters,
using the <code>superspreading::proportion_cluster_size()</code>
function.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Mostrar la solución </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate the probability of</span></span>
<span><span class="co"># having a cluster size of 5, 10, or 25</span></span>
<span><span class="co"># secondary cases from a primary case,</span></span>
<span><span class="co"># given known reproduction number and</span></span>
<span><span class="co"># dispersion parameter.</span></span>
<span><span class="fu">superspreading</span><span class="fu">::</span><span class="fu">proportion_cluster_size</span><span class="op">(</span></span>
<span>  R <span class="op">=</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"mu"</span><span class="op">]</span>,</span>
<span>  k <span class="op">=</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>  cluster_size <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>       R        k prop_5 prop_10 prop_25
1 0.5393 2.353899   1.8%      0%      0%</code></pre>
</div>
<p>The probability of having clusters of five people is 1.8%. At this
stage, given this offspring distribution parameters, a backward strategy
may not increase the probability of contain and quarantine more onward
cases.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="challenges">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a>
</h2>
<hr class="half-width">
<div id="does-ebola-have-any-superspreading-event" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="does-ebola-have-any-superspreading-event" class="callout-inner">
<h3 class="callout-title">Does Ebola have any superspreading event?</h3>
<div class="callout-content">
<p>‘Superspreading events’ can mean different things to different
people, so <a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a> proposed a general protocol for defining a superspreading event
(SSE). If the number of secondary infections caused by each case, <span class="math inline">\(Z\)</span>, follows a negative binomial
distribution (<span class="math inline">\(R, k\)</span>):</p>
<ul>
<li>We define an SSE as any infected individual who infects more than
<span class="math inline">\(Z(n)\)</span> others, where <span class="math inline">\(Z(n)\)</span> is the nth percentile of the <span class="math inline">\(Poisson(R)\)</span> distribution.</li>
<li>A 99th-percentile SSE is then any case causing more infections than
would occur in 99% of infectious histories in a homogeneous
population</li>
</ul>
<p>Using the corresponding distribution function, estimate the SSE
threshold to define a SSE for the Ebola offspring distribution estimates
for the <code>ebola_sim_clean</code> object from
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> package.</p>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Dar una pista </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" aria-labelledby="headingHint4" data-bs-parent="#accordionHint4">
<div class="accordion-body">
<p>In a Poisson distribution, the <strong>lambda</strong> or
<strong>rate</strong> parameter are equal to the estimated
<strong>mean</strong> from a negative binomial distribution. You can
explore this in <a href="https://ben18785.shinyapps.io/distribution-zoo/" class="external-link">The distribution
zoo</a> shiny app.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Mostrar la solución </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>To get the quantile value for the 99th-percentile we need to use the
<a href="https://sakai.unc.edu/access/content/group/3d1eb92e-7848-4f55-90c3-7c72a54e7e43/public/docs/lectures/lecture13.htm#probfunc" class="external-link">density
function</a> for the Poisson distribution <code>dpois()</code>.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get mean</span></span>
<span><span class="va">ebola_mu_mid</span> <span class="op">&lt;-</span> <span class="va">ebola_offspring</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"mu"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># get 99th-percentile from poisson distribution</span></span>
<span><span class="co"># with mean equal to mu</span></span>
<span><span class="fu">stats</span><span class="fu">::</span><span class="fu">qpois</span><span class="op">(</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  lambda <span class="op">=</span> <span class="va">ebola_mu_mid</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 3</code></pre>
</div>
<p>Compare this values with the ones reported by <a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a>. See figure below:</p>
<figure><img src="fig/SEE-individual-reproductive-number-fig-d.png" alt="Reported superspreading events (SSEs; diamonds) relative to estimated reproduction number R (squares) for twelve directly transmitted infections. Lines show 5–95 percentile range of the number of secondary cases following a Poisson distribution with lambda equal to the reproduction number (Z∼Poisson(R)), and crosses show the 99th-percentile proposed as threshold for SSEs. Stars represent SSEs caused by more than one source case. ‘Other’ diseases are: 1, Streptococcus group A; 2, Lassa fever; 3, Mycoplasma pneumonia; 4, pneumonic plague; 5, tuberculosis. R is not shown for ‘other’ diseases, and is off-scale for monkeypox." class="figure mx-auto d-block"><div class="figcaption">Reported superspreading events (SSEs; diamonds)
relative to estimated reproduction number R (squares) for twelve
directly transmitted infections. Lines show 5–95 percentile range of the
number of secondary cases following a Poisson distribution with lambda
equal to the reproduction number (<span class="math inline">\(Z∼Poisson(R)\)</span>), and crosses show the
99th-percentile proposed as threshold for SSEs. Stars represent SSEs
caused by more than one source case. ‘Other’ diseases are: 1,
Streptococcus group A; 2, Lassa fever; 3, Mycoplasma pneumonia; 4,
pneumonic plague; 5, tuberculosis. R is not shown for ‘other’ diseases,
and is off-scale for monkeypox.</div>
</figure>
</div>
</div>
</div>
</div>
<div id="expected-proportion-of-transmission" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="expected-proportion-of-transmission" class="callout-inner">
<h3 class="callout-title">Expected proportion of transmission</h3>
<div class="callout-content">
<p>What is the proportion of cases responsible for 80% of
transmission?</p>
<p>Use <code>{superspreading}</code> and compare the estimates for
<strong>MERS</strong> using the offspring distributions parameters from
this tutorial episode, with <strong>SARS-1</strong> and
<strong>Ebola</strong> offspring distributions parameter accessible via
the <code>{epiparameter}</code> R package.</p>
</div>
</div>
</div>
<div id="accordionHint5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint5" aria-expanded="false" aria-controls="collapseHint5">
  <h4 class="accordion-header" id="headingHint5"> Dar una pista </h4>
</button>
<div id="collapseHint5" class="accordion-collapse collapse" aria-labelledby="headingHint5" data-bs-parent="#accordionHint5">
<div class="accordion-body">
<p>To use <code>superspreading::proportion_transmission()</code> we
recommend to read the <a href="https://epiverse-trace.github.io/superspreading/reference/proportion_transmission.html" class="external-link">Estimate
what proportion of cases cause a certain proportion of transmission</a>
reference manual.</p>
<p>Currently, <code>{epiparameter}</code> has offspring distributions
for SARS, Smallpox, Mpox, Pneumonic Plague, Hantavirus Pulmonary
Syndrome, Ebola Virus Disease. Let’s access the offspring distribution
<code>mean</code> and <code>dispersion</code> parameters for SARS-1:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load parameters</span></span>
<span><span class="va">sars</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"SARS"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"offspring distribution"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sars_params</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">sars</span><span class="op">)</span></span>
<span><span class="va">sars_params</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      mean dispersion
      1.63       0.16 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Mostrar la solución </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' estimate for ebola --------------</span></span>
<span></span>
<span><span class="va">ebola_epiparameter</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"Ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"offspring distribution"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ebola_params</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">ebola_epiparameter</span><span class="op">)</span></span>
<span><span class="va">ebola_params</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      mean dispersion
       1.5        5.1 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate</span></span>
<span><span class="co"># proportion of cases that</span></span>
<span><span class="co"># generate 80% of transmission</span></span>
<span><span class="fu">superspreading</span><span class="fu">::</span><span class="fu">proportion_transmission</span><span class="op">(</span></span>
<span>  R <span class="op">=</span> <span class="va">ebola_params</span><span class="op">[[</span><span class="st">"mean"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  k <span class="op">=</span> <span class="va">ebola_params</span><span class="op">[[</span><span class="st">"dispersion"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  percent_transmission <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    R   k prop_80
1 1.5 5.1   43.2%</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' estimate for sars --------------</span></span>
<span></span>
<span><span class="co"># estimate</span></span>
<span><span class="co"># proportion of cases that</span></span>
<span><span class="co"># generate 80% of transmission</span></span>
<span><span class="fu">superspreading</span><span class="fu">::</span><span class="fu">proportion_transmission</span><span class="op">(</span></span>
<span>  R <span class="op">=</span> <span class="va">sars_params</span><span class="op">[[</span><span class="st">"mean"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  k <span class="op">=</span> <span class="va">sars_params</span><span class="op">[[</span><span class="st">"dispersion"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  percent_transmission <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     R    k prop_80
1 1.63 0.16     13%</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' estimate for mers --------------</span></span>
<span></span>
<span><span class="co"># estimate</span></span>
<span><span class="co"># proportion of cases that</span></span>
<span><span class="co"># generate 80% of transmission</span></span>
<span><span class="fu">superspreading</span><span class="fu">::</span><span class="fu">proportion_transmission</span><span class="op">(</span></span>
<span>  R <span class="op">=</span> <span class="va">offspring_fit</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"mu"</span><span class="op">]</span>,</span>
<span>  k <span class="op">=</span> <span class="va">offspring_fit</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>  percent_transmission <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>          R          k prop_80
1 0.6045295 0.02039807    2.1%</code></pre>
</div>
<p>MERS has the lowest percent of cases (2.1%) responsible of the 80% of
the transmission, representative of highly overdispersed offspring
distributions.</p>
<p>Ebola has the highest percent of cases (43%) responsible of the 80%
of the transmission. This is representative of offspring distributions
with high dispersion parameters.</p>
</div>
</div>
</div>
</div>
<div id="inverse-dispersion" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="inverse-dispersion" class="callout-inner">
<h3 class="callout-title">inverse-dispersion?</h3>
<div class="callout-content">
<p>The dispersion parameter <span class="math inline">\(k\)</span> can
be expressed differently across the literature.</p>
<ul>
<li>In the Wikipedia page for the negative binomial, this parameter is
defined in its reciprocal form (refer to the <a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" class="external-link">variance
equation</a>).</li>
<li>In <a href="https://ben18785.shinyapps.io/distribution-zoo/" class="external-link">the
distribution zoo</a> shiny app, the dispersion parameter <span class="math inline">\(k\)</span> is named “Inverse-dispersion” but it is
equal to parameter estimated in this episode. We invite you to explore
this!</li>
</ul>
</div>
</div>
</div>
<div id="heterogeneity" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="heterogeneity" class="callout-inner">
<h3 class="callout-title">heterogeneity?</h3>
<div class="callout-content">
<p>The individual-level variation in transmission is also referred as
the heterogeneity in the transmission or degree of heterogeneity in <a href="https://wellcomeopenresearch.org/articles/5-83" class="external-link">Lloyd-Smith et
al., 2005</a>, heterogeneous infectiousness in <a href="https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-018-2330-z" class="external-link">Campbell
et al., 2018</a> when introducing the <code>{outbreaker2}</code>
package. Similarly, a contact network can store heterogeneous
epidemiological contacts as in the documentation of the
<a href="https://www.repidemicsconsortium.org/epicontacts/" class="external-link">epicontacts</a> package (<a href="https://www.repidemicsconsortium.org/epicontacts/articles/epicontacts.html" class="external-link">Nagraj
et al., 2018</a>).</p>
</div>
</div>
</div>
<div id="read-these-blog-posts" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="read-these-blog-posts" class="callout-inner">
<h3 class="callout-title">Read these blog posts</h3>
<div class="callout-content">
<p>The <a href="https://plus.maths.org/content/monkeypox" class="external-link">Tracing
monkeypox</a> article from the <a href="https://maths.org/juniper/" class="external-link">JUNIPER</a> consortium showcases the
usefulness of network models on contact tracing.</p>
<p>The <a href="https://kucharski.substack.com/p/going-viral" class="external-link">Going
viral</a> post from Adam Kucharski shares insides from YouTube virality,
disease outbreaks, and marketing campaigns on the conditions that spark
contagion online.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Use <a href="https://www.repidemicsconsortium.org/epicontacts/" class="external-link">epicontacts</a> to calculate the number of secondary
cases cause by a particular individual from linelist and contact
data.</li>
<li>Use <a href="https://lbbe-software.github.io/fitdistrplus/" class="external-link">fitdistrplus</a> to empirically estimate the
offspring distribution from the number of secondary cases
distribution.</li>
<li>Use <code>{superspreading}</code> to estimate the probability of
having clusters of a given size from primary cases and inform contact
tracing efforts.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-superspreading-simulate"><p>Content from <a href="superspreading-simulate.html">Simulate transmission chains</a></p>
<hr>
<p>Última actualización: 2024-09-24 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/superspreading-simulate.Rmd" class="external-link">Mejora esta página <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Mostrar todas las soluciones " data-collapse="Cerrar todas las soluciones "> Mostrar todas las soluciones <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Hoja de ruta</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Preguntas</h3>
<ul>
<li>How can we simulate transmission chains based on infection
characteristics?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objetivos</h3>
<ul>
<li>Create a short term projection using a branching process with
<code>{epichains}</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<p>Learners should familiarise themselves with the following concept
dependencies before working through this tutorial:</p>
<p><strong>Statistics</strong>: Common probability distributions,
including Poisson and negative binomial.</p>
<p><strong>Epidemic theory</strong>: The reproduction number, <span class="math inline">\(R\)</span>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<!-- what we know --><p>Individual variation in transmission can affect both the potential
for an epidemic to establish in a population and the ease of control (<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<ul>
<li><p>Greater variation reduces the overall probably of a single new
case causing a large local outbreak, because most cases infect few
others and individuals that generate a large number of secondary cases
are relatively rare.</p></li>
<li><p>However, if a ‘superspreading event’ does occur and the outbreak
gets established, this variation can make an outbreak harder to control
using <em>mass interventions</em> (i.e. blanket interventions that
implicitly assume everyone contributes equally to transmission), because
some cases contribute disproportionality: a single uncontrolled case may
generate a large number of secondary cases.</p></li>
<li><p>Conversely, variation in transmission may provide opportunities
for <em>targeted interventions</em> if the individuals who contribute
more to transmission (due to biological or behavioural factors), or the
settings in which ‘superspreading events’ occur, share
socio-demographic, environmental or geographical characteristics that
can be defined.</p></li>
</ul>
<!-- what we dont know --><p>How can we quantify the potential of a new infection to cause a large
outbreak based on its reproduction number <span class="math inline">\(R\)</span> and the dispersion <span class="math inline">\(k\)</span> of its offspring distribution?</p>
<figure style="text-align: center"><img src="fig/superspreading-simulate-rendered-unnamed-chunk-1-1.png" alt="Observed number of cumulative cases from the Middle East respiratory syndrome (MERS) outbreak in South Korea, 2015, alongside with simulated transmission chains assuming an offspring distribution with $R=0.6$ and $k=0.02$." class="figure mx-auto d-block"><figcaption>
Observed number of cumulative cases from the Middle East respiratory
syndrome (MERS) outbreak in South Korea, 2015, alongside with simulated
transmission chains assuming an offspring distribution with <span class="math inline">\(R=0.6\)</span> and <span class="math inline">\(k=0.02\)</span>.
</figcaption></figure><!-- what we are going to do --><p>In this episode, we will use the <code>{epichains}</code> package to
simulate transmission chains and estimate the potential for large
outbreaks following the introduction of a new case. We are going to use
it with functions from <code>{epiparameter}</code>, <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>
and <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a>, so also loading the <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>
package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epichains</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-double-colon" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="the-double-colon" class="callout-inner">
<h3 class="callout-title">The double-colon</h3>
<div class="callout-content">
<p>The double-colon <code>::</code> in R let you call a specific
function from a package without loading the entire package into the
current environment.</p>
<p>For example, <code>dplyr::filter(data, condition)</code> uses
<code>filter()</code> from the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package.</p>
<p>This help us remember package functions and avoid namespace
conflicts.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="simulation-of-uncontrolled-outbreaks">Simulation of uncontrolled outbreaks<a class="anchor" aria-label="anchor" href="#simulation-of-uncontrolled-outbreaks"></a>
</h2>
<hr class="half-width">
<p>Infectious disease epidemics spread through populations when a chain
of infected individuals transmit the infection to others. <a href="https://epiverse-trace.github.io/epichains/articles/theoretical_background.html" class="external-link">Branching
processes</a> can be used to model this transmission. A branching
process is a stochastic process (i.e. a random process that can be
described by a known probability distribution), where each infectious
individual gives rise to a random number of individuals in the next
generation of infection, starting with the index case in generation 1.
The distribution of the number of secondary cases each individual
generates is called the offspring distribution (<a href="https://epiverse-trace.github.io/epichains/articles/epichains.html" class="external-link">Azam
&amp; Funk, 2024</a>).</p>
<p><code>{epichains}</code> provides methods to analyse and simulate the
<em>size</em> and <em>length</em> of branching processes with an given
offspring distribution. <code>{epichains}</code> implements a rapid and
simple model to simulate transmission chains to assess epidemic risk,
project cases into the future, and evaluate interventions that change
<span class="math inline">\(R\)</span>.</p>
<div id="chain-size-and-length" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="chain-size-and-length" class="callout-inner">
<h3 class="callout-title">chain size and length</h3>
<div class="callout-content">
<ul>
<li><p>The <strong>size</strong> of the transmission chain is defined as
the total number of individuals infected across all generations of
infection, and</p></li>
<li><p>the <strong>length</strong> of the transmission chain is the
number of generations from the first case to the last case in the
outbreak before the chain ended.</p></li>
</ul>
<p>The <em>size</em> calculation includes the first case, and the
<em>length</em> calculation contains the first generation when the first
case starts the chain (See figure below).</p>
<figure><img src="https://raw.githubusercontent.com/epiverse-trace/epichains/main/vignettes/img/transmission_chain_example.png" alt="An example of a transmission chain starting with a single case C1. Cases are represented by blue circles and arrows indicating who infected whom. The chain grows through generations Gen 1, Gen 2, and Gen 3, producing cases C2, C3, C4, C5, and C6. The chain ends at generation Gen 3 with cases C4, C5, and C6. The size of C1’s chain is 6, including C1 (that is, the sum of all blue circles), and the length is 3, which includes Gen 1 (maximum number of generations reached by C1’s chain) (Azam &amp; Funk, 2024)." class="figure mx-auto d-block"><div class="figcaption">
<strong>An example of a transmission chain
starting with a single case C1.</strong> Cases are represented by blue
circles and arrows indicating who infected whom. The chain grows through
generations Gen 1, Gen 2, and Gen 3, producing cases C2, C3, C4, C5, and
C6. The chain ends at generation Gen 3 with cases C4, C5, and C6. The
size of C1’s chain is 6, including C1 (that is, the sum of all blue
circles), and the length is 3, which includes Gen 1 (maximum number of
generations reached by C1’s chain) (<a href="https://epiverse-trace.github.io/epichains/articles/epichains.html" class="external-link">Azam
&amp; Funk, 2024</a>).</div>
</figure>
</div>
</div>
</div>
<p>To use <code>{epichains}</code>, we need to know (or assume) two key
epidemiological values: the offspring distribution and the generation
time.</p>
</section><section><h2 class="section-heading" id="get-the-offspring-distribution">Get the offspring distribution<a class="anchor" aria-label="anchor" href="#get-the-offspring-distribution"></a>
</h2>
<hr class="half-width">
<p>Here we assume the MERS offspring distribution follows a negative
binomial distribution, with mean (reproduction number <span class="math inline">\(R\)</span>) and dispersion <span class="math inline">\(k\)</span> values estimated from the linelist and
contact data of <code>mers_korea_2015</code> in the
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> R package in the previous episode.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mers_offspring</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.60</span>, dispersion <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span></code></pre>
</div>
<div id="offspring-distribution-for-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="offspring-distribution-for-epichains" class="callout-inner">
<h3 class="callout-title">offspring distribution for epichains</h3>
<div class="callout-content">
<p>We input an offspring distribution to <code>{epichains}</code> by
referring to the R function that generates random values from the
distribution we want. For a negative binomial distribution, we use
<code>rnbinom</code> with its corresponding <code>mu</code> and
<code>size</code> arguments:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>  offspring_dist <span class="ot">=</span> rnbinom,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  mu <span class="ot">=</span> mers_offspring[<span class="st">"mean"</span>],</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  size <span class="ot">=</span> mers_offspring[<span class="st">"dispersion"</span>],</span></code></pre>
</div>
<p>The reference manual in <code>?rnbinom</code> tells us our required
specific arguments.</p>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Poisson and other distributions </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p><code>{epichains}</code> can accept any R function that generates
random numbers, so the specified arguments will change depending on the
R function used. For more details on the range of possible options, see
the function reference manual.</p>
<p>For example, let’s say we want to use a Poisson distribution for the
offspring distribution. First, read the argument required in the
<code>?rpois</code> reference manual. Second, specify the
<code>lambda</code> argument parameter, also known as rate or mean in
the literature. In <code>{epichains}</code>, this can look like
this:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>  offspring_dist <span class="ot">=</span> rpois,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  lambda <span class="ot">=</span> mers_offspring[<span class="st">"mean"</span>],</span></code></pre>
</div>
<p>In this example, we can specify
<code>lambda = mers_offspring["mean"]</code> because the mean number of
secondary cases generated (i.e. <span class="math inline">\(R\)</span>)
should be the same regardless of the distribution we assume. What
changes is the variance of the distribution, and hence the level of
individual-level variation in transmission. When the dispersion
parameter <span class="math inline">\(k\)</span> approaches infinity
(<span class="math inline">\(k \rightarrow \infty\)</span>) in a
negative binomial distribution, the variance equals the mean. This makes
the conventional Poisson distribution a special case of the negative
binomial distribution.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="get-generation-time">Get generation time<a class="anchor" aria-label="anchor" href="#get-generation-time"></a>
</h2>
<hr class="half-width">
<p>The <a href="reference.html#serialinterval">serial interval</a>
distribution is often used to approximate the generation time
distribution. This approximation is commonly used because it is easier
to observe and measure the onset of symptoms in each case than the
precise time of infection.</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> generation time vs serial interval </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<figure><img src="fig/serial-interval-observed.jpeg" alt="A schematic of the relationship of different time periods of transmission between an infector and an infectee in a transmission pair. Exposure window is defined as the time interval having viral exposure, and transmission window is defined as the time interval for onward transmission with respect to the infection time (Chung Lau et al., 2021)." class="figure mx-auto d-block"><div class="figcaption">A schematic of the relationship of different
time periods of transmission between an infector and an infectee in a
transmission pair. Exposure window is defined as the time interval
having viral exposure, and transmission window is defined as the time
interval for onward transmission with respect to the infection time (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>).</div>
</figure><p>However, using the <em>serial interval</em> as an approximation of
the <em>generation time</em> is primarily valid for diseases in which
infectiousness starts after symptom onset (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>). In cases where infectiousness starts before
symptom onset, the serial intervals can have negative values, which is
the case for diseases with pre-symptomatic transmission (<a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext#gr2" class="external-link">Nishiura
et al., 2020</a>).</p>
</div>
</div>
</div>
</div>
<p>Let’s use the <code>{epiparameter}</code> package to access and use
the available serial interval for MERS disease:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">serial_interval</span> <span class="op">&lt;-</span> <span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"mers"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">serial_interval</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The serial interval for MERS has a mean of 12.6 days and a standard
deviation of 2.8 days.</p>
<div id="generation-time-for-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="generation-time-for-epichains" class="callout-inner">
<h3 class="callout-title">generation time for epichains</h3>
<div class="callout-content">
<p>In <code>{epichains}</code>, we need to specify the generation time
as a function that generates random numbers. Using
<code>{epiparameter}</code> has the advantage of using the distribution
function <code>epiparameter::generate()</code> for this input. This will
look like this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>This interface is similar to the one <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> uses to link
with <code>{epiparameter}</code>. Read the <a href="https://epiverse-trace.github.io/cfr/articles/delay_distributions.html" class="external-link">work
with delay distributions</a> vignette for further context.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="simulate-a-single-chain">Simulate a single chain<a class="anchor" aria-label="anchor" href="#simulate-a-single-chain"></a>
</h2>
<hr class="half-width">
<p>Now we are prepared to use the <code>simulate_chains()</code>
function from <code>{epichains}</code> to create <strong>one</strong>
transmission chain:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>  <span class="co"># simulation controls</span></span>
<span>  n_chains <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  <span class="co"># offspring</span></span>
<span>  offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>  size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>  <span class="co"># generation</span></span>
<span>  generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p><code>simulate_chains()</code> requires three sets of arguments as a
minimum:</p>
<ul>
<li>simulation controls,</li>
<li>offspring distribution, and</li>
<li>generation time.</li>
</ul>
<p>In the lines above, we described how to specify the offspring
distribution and generation time. The <strong>simulation
controls</strong> include at least two arguments:</p>
<ul>
<li>
<code>index_case</code>, which defines the number of index cases to
simulate transmission chains for and</li>
<li>
<code>statistic</code>, which defines a chain statistic to track
(either <code>"size"</code> or <code>"length"</code>) as the stopping
criteria for each chain being simulated.</li>
</ul>
<div id="stopping-criteria" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="stopping-criteria" class="callout-inner">
<h3 class="callout-title">Stopping criteria</h3>
<div class="callout-content">
<p>This is an customisable feature of <code>{epichains}</code>. By
default, branching process simulations end when they have gone extinct.
For long-lasting transmission chains, in <code>simulate_chains()</code>
you can add the <code>stat_max</code> argument.</p>
<p>For example, if we set an stopping criteria for
<code>statistic = "size"</code> of <code>stat_max = 500</code>, no more
offspring will be produced after a chain of size 500.</p>
</div>
</div>
</div>
<p>The <code>simulate_chains()</code> output creates a
<code>&lt;epichains&gt;</code> class object, which we can then analyse
further in R.</p>
</section><section><h2 class="section-heading" id="simulate-multiple-chains">Simulate multiple chains<a class="anchor" aria-label="anchor" href="#simulate-multiple-chains"></a>
</h2>
<hr class="half-width">
<p>We can use <code>simulate_chains()</code> to create multiple chains
and increase the probability of simulating uncontrolled outbreak
projections given an overdispersed offspring distribution.</p>
<p>We need to specify three additional elements:</p>
<ul>
<li>
<code>set.seed(&lt;integer&gt;)</code>, which is a random number
generator function with a specified seed value, the
<code>&lt;integer&gt;</code> number, to ensure consistent results across
different runs of the code.</li>
<li>
<code>number_simulations</code>, which defines the number of
simulations to run.</li>
<li>
<code>initial_cases</code> defines the number of initial cases to
input to the <code>n_chains</code> argument explained in the lines
above.</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for random number generator</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="co"># Number of simulation runs</span></span>
<span><span class="va">number_simulations</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="co"># Number of initial cases</span></span>
<span><span class="va">initial_cases</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre>
</div>
<p><code>number_simulations</code> and <code>initial_cases</code> are
conveniently stored in objects to facilitate downstream reuse in the
workflow.</p>
<div id="iteration-using-purrr" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="iteration-using-purrr" class="callout-inner">
<h3 class="callout-title">Iteration using purrr</h3>
<div class="callout-content">
<p><a href="https://r4ds.hadley.nz/iteration.html" class="external-link">Iteration</a> aims to
perform the same action on different objects repeatedly.</p>
<p>Learn how to use the core <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a> functions like
<code>map()</code> from the YouTube tutorial on <a href="https://www.youtube.com/watch?v=nd-Y8b22YaQ" class="external-link">How to purrr</a> by
Equitable Equations.</p>
<p>Or, if you previously used the <code>*apply</code> family of
functions, visit the package vignette on <a href="https://purrr.tidyverse.org/articles/base.html" class="external-link">purrr base R</a>,
which shares key differences, direct translations, and examples.</p>
</div>
</div>
</div>
<p>To get multiple chains, we must apply the
<code>simulate_chains()</code> function to each chain defined by a
sequence of numbers from 1 to 1000.</p>
<div id="purrr-and-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="purrr-and-epichains" class="callout-inner">
<h3 class="callout-title">purrr and epichains</h3>
<div class="callout-content">
<p>First, let’s sketch how we use <code>purrr::map()</code> with
<code>epichains::simulate_chains()</code>. The <code>map()</code>
function requires two arguments:</p>
<ul>
<li>
<code>.x</code>, with a vector of numbers, and</li>
<li>
<code>.f</code>, a function to iterate to each vector value.</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">map</span><span class="op">(</span></span>
<span>  <span class="co"># vector of numbers (simulation IDs)</span></span>
<span>  .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>  <span class="co"># function to iterate to each simulation ID number</span></span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simulate_chains</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co"># creates a column with the simulation ID number</span></span>
<span>      <span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># combine list outputs (for each simulation ID) into a single data frame</span></span>
<span>  <span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>The <code>sim</code> element is placed to register the iteration
number (<strong>simulation ID</strong>) as a new column in the
<code>&lt;epichains&gt;</code> output. The
<code>purrr::list_rbind()</code> function aims to combine all the list
outputs from <code>map()</code>.</p>
<p><strong>Why a dot (<code>.</code>) as a prefix?</strong> In the <a href="https://design.tidyverse.org/dots-prefix.html" class="external-link">tidy design
principles</a> book we have a chapter on the dot prefix!</p>
</div>
</div>
</div>
<p>Now, we are prepared to use <code>map()</code> to repeatedly simulate
from <code>simulate_chains()</code> and store in a vector from 1 to
1000:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_chains_map</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># iterate one function across multiple numbers (simulation IDs)</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span></span>
<span>    <span class="co"># vector of numbers (simulation IDs)</span></span>
<span>    .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>    <span class="co"># function to iterate to each simulation ID number</span></span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>        <span class="co"># simulation controls</span></span>
<span>        n_chains <span class="op">=</span> <span class="va">initial_cases</span>,</span>
<span>        statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>        <span class="co"># offspring</span></span>
<span>        offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>        mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>        size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>        <span class="co"># generation</span></span>
<span>        generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="co"># creates a column with the simulation ID number</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># combine list outputs (for each simulation ID) into a single data frame</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="read-the-epichains-output" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="read-the-epichains-output" class="callout-inner">
<h3 class="callout-title">Read the epichains output</h3>
<div class="callout-content">
<p>To explore the output format of the <code>&lt;epichains&gt;</code>
class object of name <code>simulated_chains_map</code>, let’s look at
the simulated <code>simulation_id</code> number 806.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> The epichains object </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Let’s use <code>dplyr::filter()</code> for this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chain_to_observe</span> <span class="op">&lt;-</span> <span class="fl">806</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### get epichain summary ----------------------------------------------------</span></span>
<span></span>
<span><span class="va">simulated_chains_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">simulation_id</span> <span class="op">==</span> <span class="va">chain_to_observe</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`&lt;epichains&gt;` object

&lt; epichains head (from first known infector) &gt;

  chain infector infectee generation     time simulation_id
2     1        1        2          2 16.38623           806
3     1        1        3          2 11.79430           806
4     1        1        4          2 10.77252           806
5     1        1        5          2 11.39945           806
6     1        1        6          2 10.23130           806
7     1        2        7          3 26.01046           806


Number of infectors (known): 3
Number of generations: 3
Use `as.data.frame(&lt;object_name&gt;)` to view the full output in the console.</code></pre>
</div>
<p>Key elements from this output are in the footer, the piece of text
that appears at the bottom:</p>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Number of infectors (known): 3
Number of generations: 3</code></pre>
</div>
<p>The simulated <code>simulation_id</code> number 806 has three known
infectors and three generations. These numbers are more visible when
reading the <code>&lt;epichains&gt;</code> objects as a data frame.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> The epichains data frame </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### infector-infectee data frame --------------------------------------------</span></span>
<span></span>
<span><span class="va">simulated_chains_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">simulation_id</span> <span class="op">==</span> <span class="va">chain_to_observe</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 9 × 6
  chain infector infectee generation  time simulation_id
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;int&gt; &lt;dbl&gt;         &lt;int&gt;
1     1       NA        1          1   0             806
2     1        1        2          2  16.4           806
3     1        1        3          2  11.8           806
4     1        1        4          2  10.8           806
5     1        1        5          2  11.4           806
6     1        1        6          2  10.2           806
7     1        2        7          3  26.0           806
8     1        2        8          3  29.8           806
9     1        2        9          3  26.6           806</code></pre>
</div>
<p>Chain 806 tells us a <strong>story</strong>: “In the first
transmission generation at <code>time = 0</code>, one index case
infected the first case with <code>sim_id = 1</code>. Then, in the
second transmission generation (between <code>time</code> 10 to 16),
<code>sim_id = 1</code> infected five cases. Later, in the third
transmission generation (between <code>time</code> 26 to 30),
<code>sim_id = 2</code> infected three new cases.”</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> An infectee data frame </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The output data frame collects <strong>infectees</strong> as the
observation unit:</p>
<ul>
<li>Each infectee has a <code>sim_id</code>.</li>
<li>Each <em>infectee</em> that behaved as an <em>infector</em> is
registered in the <code>infector</code> column using <code>sim_id</code>
of that infectee.</li>
<li>Each infectee got infected in a specific <code>generation</code> and
(continuous) <code>time</code>.</li>
<li>The simulation number is registered under the
<code>simulation_id</code> column.</li>
</ul>
<p><strong>Note:</strong> The <code>Number of infectors (known)</code>
includes the <code>NA</code> observation under the <code>infector</code>
column. This refers to the infector specified as index case (in the
<code>n_chains</code> argument), which started the transmission chain to
the infectee of <code>sim_id = 1</code>, at <code>generation = 1</code>,
and <code>time = 0</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="visualize-multiple-chains">Visualize multiple chains<a class="anchor" aria-label="anchor" href="#visualize-multiple-chains"></a>
</h2>
<hr class="half-width">
<p>To visualize the simulated chains, we need some pre-processing:</p>
<ol style="list-style-type: decimal">
<li>Let’s use <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> to get round time numbers to resemble
surveillance days.</li>
<li>Count the daily cases in each simulation (by
<code>simulation_id</code>).</li>
<li>Calculate the cumulative number of cases within a simulation.</li>
</ol>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># daily aggregate of cases</span></span>
<span><span class="va">simulated_chains_day</span> <span class="op">&lt;-</span> <span class="va">simulated_chains_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use data.frame output from &lt;epichains&gt; object</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># transform simulation ID column to factor (categorical variable)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># get the round number (day) of infection times</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">ceiling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># count the daily number of cases in each simulation (simulation ID)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">simulation_id</span>, <span class="va">day</span>, name <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># calculate the cumulative number of cases for each simulation (simulation ID)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cases_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Before the plot, let’s create a summary table with the total time
duration and size of each chain. We can use the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>
“combo” of <code>group_by()</code>, <code>summarise()</code> and
<code>ungroup()</code>:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise the chain duration and size</span></span>
<span><span class="va">sim_chains_max</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">simulated_chains_day</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">summarise</span><span class="op">(</span></span>
<span>    <span class="co"># duration</span></span>
<span>    day_max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span>
<span>    <span class="co"># size</span></span>
<span>    cases_total <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">cases_cumsum</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_chains_max</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,000 × 3
   simulation_id day_max cases_total
   &lt;fct&gt;           &lt;dbl&gt;       &lt;int&gt;
 1 1                   0           1
 2 2                   0           1
 3 3                   0           1
 4 4                   0           1
 5 5                   0           1
 6 6                   0           1
 7 7                   0           1
 8 8                   0           1
 9 9                   0           1
10 10                  0           1
# ℹ 990 more rows</code></pre>
</div>
<p>Now, we are prepared for using the <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>
package:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize transmission chains by cumulative cases</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># create grouped chain trajectories</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">simulated_chains_day</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cases_cumsum</span>,</span>
<span>      group <span class="op">=</span> <span class="va">simulation_id</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># create points to visualize the chain endpoint</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sim_chains_max</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day_max</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cases_total</span>,</span>
<span>      group <span class="op">=</span> <span class="va">simulation_id</span>,</span>
<span>      color <span class="op">=</span> <span class="va">simulation_id</span></span>
<span>    <span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># define a 100-case threshold</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative cases"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-15-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Although most introductions of 1 index case do not generate secondary
cases (N = 940) or most outbreaks rapidly become extinct (median
duration of 17.5 and median size of 9), only 2 epidemic trajectories
among 1000 simulations (0.2%) can reach to more than 100 infected cases.
This finding is particularly remarkable because the reproduction number
<span class="math inline">\(R\)</span> is less than 1 (offspring
distribution mean of 0.6), but, given an offspring distribution
dispersion parameter of 0.02, it shows the potential for explosive
outbreaks of MERS disease.</p>
<p>We can count how many chains reached the 100-case threshold using
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> functions:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of chains that reached the 100-case threshold</span></span>
<span><span class="va">sim_chains_max</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">day_max</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">cases_total</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 3
  simulation_id day_max cases_total
  &lt;fct&gt;           &lt;dbl&gt;       &lt;int&gt;
1 666                88         110
2 23                 45         113</code></pre>
</div>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Observed cases vs simulated chains </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>Let’s overlap the cumulative number of observed cases using the
linelist object from the <code>mers_korea_2015</code> dataset of the
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> R package. To prepare the dataset so we can
plot daily total cases over time, we use <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> to
convert the linelist to an <code>&lt;incidence2&gt;</code> object,
complete the missing dates of the time series with
<code>complete_dates()</code></p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">outbreaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mers_cumcases</span> <span class="op">&lt;-</span> <span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># incidence2 workflow</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span>date_index <span class="op">=</span> <span class="st">"dt_onset"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">complete_dates</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># wrangling using {dplyr}</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>count_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu">rownames_to_column</span><span class="op">(</span>var <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">day</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Use <code>plot()</code> to make an incidence plot:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the incidence2 object</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">mers_cumcases</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-19-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>When plotting the observed number of cumulative cases from the Middle
East respiratory syndrome (MERS) outbreak in South Korea in 2015
alongside the previously simulated chains, we see that the observed
cases followed a trajectory that is consistent with the simulated
explosive outbreak dynamics (which makes sense, given the simulation
uses parameters based on this specific outbreak).</p>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-20-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>When we increase the dispersion parameter from <span class="math inline">\(k = 0.01\)</span> to <span class="math inline">\(k
= \infty\)</span> - and hence reduce individual-level variation in
transmission - and assume a fixed reproduction number <span class="math inline">\(R = 1.5\)</span>, the proportion of simulated
outbreaks that reached the 100-case threshold increases. This is because
the simulated outbreaks now have more of a consistent, clockwise
dynamic, rather than the high level of variability seen previously.</p>
<figure><img src="fig/see-nature04153_Fig2-c.jpg" alt="Growth of simulated outbreaks with R = 1.5 and one initial case, conditional on non-extinction. Boxes show the median and interquartile range (IQR) of the first disease generation with 100 cases; whiskers show the most extreme values within 1.5 × IQR of the boxes, and crosses show outliers. Percentages show the proportion of 10,000 simulated outbreaks that reached the 100-case threshold (Lloyd-Smith et al., 2005)." class="figure mx-auto d-block"><div class="figcaption">
<strong>Growth of simulated outbreaks with R =
1.5 and one initial case, conditional on non-extinction.</strong> Boxes
show the median and interquartile range (IQR) of the first disease
generation with 100 cases; whiskers show the most extreme values within
1.5 × IQR of the boxes, and crosses show outliers. Percentages show the
proportion of 10,000 simulated outbreaks that reached the 100-case
threshold (<a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a>).</div>
</figure><div id="early-spread-projections" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="early-spread-projections" class="callout-inner">
<h3 class="callout-title">Early spread projections</h3>
<div class="callout-content">
<p>In the epidemic’s initial phase, you can use <code>{epichains}</code>
to apply a branching process model to project the number of future
cases. Even though the model accounts for randomness in transmission and
variation in the number of secondary cases, there may be additional
local features we have not considered. Analysis of early forecasts made
for COVID in different countries using this model structure found that
predictions were often overconfident (<a href="https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2020.25.18.2000543#validationofthemodel-1" class="external-link">Pearson
et al., 2020</a>). This is likely because the real-time model did not
include all the changes in the offspring distribution that were
happening at the local level as a result of behaviour change and control
measures. You can read more about the importance of local context in
COVID-19 models in <a href="https://www.nature.com/articles/s43588-020-00014-7" class="external-link">Eggo et
al. (2020)</a>.</p>
<p>We invite you to read the vignette on <a href="https://epiverse-trace.github.io/epichains/articles/projecting_incidence.html" class="external-link">Projecting
infectious disease incidence: a COVID-19 example</a>! for more on making
predictions using <code>{epichains}</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="challenges">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a>
</h2>
<hr class="half-width">
<div id="monkeypox-large-outbreak-potential" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="monkeypox-large-outbreak-potential" class="callout-inner">
<h3 class="callout-title">Monkeypox large outbreak potential</h3>
<div class="callout-content">
<p>Evaluate the potential for a new Monkey pox (Mpox) case to generate
an explosive large outbreak.</p>
<ul>
<li>Simulate 1000 transmission chains with 1 initial case each.</li>
<li>Use the appropriate package to access delay data from previous
outbreaks.</li>
<li>How many simulated trajectories reach more than 100 infected
cases?</li>
</ul>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Dar una pista </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>With <code>{epiparameter}</code>, you can access and use offspring
and delay distributions from previous Ebola outbreaks.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span>epi_dist <span class="op">=</span> <span class="st">"offspring"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">disease</span>, <span class="va">epi_distribution</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    6 × 3
  disease                       epi_distribution           n
  &lt;chr&gt;                         &lt;chr&gt;                  &lt;int&gt;
1 Ebola Virus Disease           offspring distribution     1
2 Hantavirus Pulmonary Syndrome offspring distribution     1
3 Mpox                          offspring distribution     1
4 Pneumonic Plague              offspring distribution     1
5 SARS                          offspring distribution     2
6 Smallpox                      offspring distribution     4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span>epi_dist <span class="op">=</span> <span class="st">"serial interval"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">disease</span>, <span class="va">epi_distribution</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    6 × 3
  disease               epi_distribution     n
  &lt;chr&gt;                 &lt;chr&gt;            &lt;int&gt;
1 COVID-19              serial interval      4
2 Ebola Virus Disease   serial interval      4
3 Influenza             serial interval      1
4 MERS                  serial interval      2
5 Marburg Virus Disease serial interval      2
6 Mpox                  serial interval      5</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Mostrar la solución </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages -----------------------------------------------------------</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># delays ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">mpox_offspring_epidist</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"mpox"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"offspring"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mpox_offspring</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">get_parameters</span><span class="op">(</span><span class="va">mpox_offspring_epidist</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mpox_serialint</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"mpox"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial interval"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># iterate -----------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># Set seed for random number generator</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="co"># Number of simulation runs</span></span>
<span><span class="va">number_simulations</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="co"># Number of initial cases</span></span>
<span><span class="va">initial_cases</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">simulated_chains_mpox</span> <span class="op">&lt;-</span></span>
<span>  <span class="co"># iterate one function across multiple numbers (simulation IDs)</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span></span>
<span>    <span class="co"># vector of numbers (simulation IDs)</span></span>
<span>    .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>    <span class="co"># function to iterate to each simulation ID number</span></span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>        <span class="co"># simulation controls</span></span>
<span>        n_chains <span class="op">=</span> <span class="va">initial_cases</span>,</span>
<span>        statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>        <span class="co"># offspring</span></span>
<span>        offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>        mu <span class="op">=</span> <span class="va">mpox_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>        size <span class="op">=</span> <span class="va">mpox_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>        <span class="co"># generation</span></span>
<span>        generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpox_serialint</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="co"># creates a column with the simulation ID number</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># combine list outputs (for each simulation ID) into a single data frame</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># daily aggregate of cases</span></span>
<span><span class="va">simulated_chains_mpox_day</span> <span class="op">&lt;-</span> <span class="va">simulated_chains_mpox</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use data.frame output from &lt;epichains&gt; object</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># transform simulation ID column to factor (categorical variable)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># get the round number (day) of infection times</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">ceiling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># count the daily number of cases in each simulation (simulation ID)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">simulation_id</span>, <span class="va">day</span>, name <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># calculate the cumulative number of cases for each simulation (simulation ID)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cases_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize transmission chains by cumulative cases</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># create grouped chain trajectories</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">simulated_chains_mpox_day</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cases_cumsum</span>,</span>
<span>      group <span class="op">=</span> <span class="va">simulation_id</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># define a 100-case threshold</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative cases"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-22-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Assuming a Monkey pox outbreak with <span class="math inline">\(R\)</span> = 0.32 and <span class="math inline">\(k\)</span> = 0.58, there is no trajectory among
1000 simulations that reach more than 100 infected cases. Compared to
MERS (<span class="math inline">\(R\)</span> = 0.6 and <span class="math inline">\(k\)</span> = 0.02).</p>
</div>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Epidemic Risk assessment accounting for superspreading </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>With <code>{superspreading}</code>, you can get numerical solutions
to processes that <code>{epichains}</code> solve using branching
processes. We invite you to read the <code>{superspreading}</code>
vignette on <a href="https://epiverse-trace.github.io/superspreading/articles/epidemic_risk.html" class="external-link">Epidemic
risk</a> and respond to:</p>
<ul>
<li>What is the probability that a newly introduced pathogen will cause
a large outbreak?</li>
<li>What is the probability that an infection will, by chance, fail to
establish following initial introduction(s)?</li>
<li>What is the probability the outbreak will be contained?</li>
</ul>
<p>Check how these estimates vary non-linearly with respect to the mean
reproduction number <span class="math inline">\(R\)</span> and
dispersion <span class="math inline">\(k\)</span> of a given
disease.</p>
<!-- draft challenge -->
<!-- Calculate the probability a new Mpox case will lead to a large outbreak in the absence of control measures. Use the appropriate package to access delay data from previous outbreaks. -->
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">superspreading</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">superspreading</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="from-a-distribution-of-secondary-cases" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="from-a-distribution-of-secondary-cases" class="callout-inner">
<h3 class="callout-title">From a distribution of secondary cases</h3>
<div class="callout-content">
<p><a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(15)70135-0/fulltext" class="external-link">Christian
Althaus, 2015</a> reused data published by <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(14)71075-8/fulltext#gr2" class="external-link">Faye
et al., 2015 (Figure 2)</a> on the transmission tree on Ebola virus
disease in Conakry, Guinea, 2014.</p>
<p>Using the data under the <strong>hint</strong> tab, estimate the
offspring distribution from the distribution of secondary cases. Then
estimate the large outbreak potential from this data.</p>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Dar una pista </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>Code with the transmission tree data written by <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(15)70135-0/fulltext" class="external-link">Christian
Althaus, 2015</a>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of individuals in the trees</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">152</span></span>
<span><span class="co"># Number of secondary cases for all individuals</span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">14</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>        <span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">17</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>,</span>
<span>        <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">c0</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">c1</span>, <span class="fu">rep</span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span> <span class="op">-</span> <span class="fu">length</span><span class="op">(</span><span class="va">c1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c0</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">enframe</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-25-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Mostrar la solución </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load packages ---------------------------</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epichains</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">fitdistrplus</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit a negative binomial distribution ------------------------------------</span></span>
<span></span>
<span><span class="co"># Fitting a negative binomial distribution to the number of secondary cases</span></span>
<span><span class="va">fit.cases</span> <span class="op">&lt;-</span> <span class="fu">fitdistrplus</span><span class="fu">::</span><span class="fu">fitdist</span><span class="op">(</span><span class="va">c0</span>, <span class="st">"nbinom"</span><span class="op">)</span></span>
<span><span class="va">fit.cases</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">SALIDA<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Fitting of the distribution ' nbinom ' by maximum likelihood
Parameters:
      estimate Std. Error
size 0.1814260 0.03990278
mu   0.9537995 0.19812301</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># serial interval parameters ----------------------------------------------</span></span>
<span></span>
<span><span class="va">ebola_serialinter</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epidist_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"ebola"</span>,</span>
<span>  epi_dist <span class="op">=</span> <span class="st">"serial interval"</span>,</span>
<span>  single_epidist <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate outbreak trajectories ------------------------------------------</span></span>
<span></span>
<span><span class="co"># Set seed for random number generator</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">645</span><span class="op">)</span></span>
<span><span class="co"># Number of simulation runs</span></span>
<span><span class="va">number_simulations</span> <span class="op">&lt;-</span> <span class="fl">1e2</span></span>
<span><span class="co"># Number of initial cases</span></span>
<span><span class="va">initial_cases</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">sim_multiple_chains</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>        n_chains <span class="op">=</span> <span class="va">initial_cases</span>,</span>
<span>        <span class="co"># stopping</span></span>
<span>        statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>        <span class="co"># offspring</span></span>
<span>        offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>        mu <span class="op">=</span> <span class="va">fit.cases</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"mu"</span><span class="op">]</span>,</span>
<span>        size <span class="op">=</span> <span class="va">fit.cases</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"size"</span><span class="op">]</span>,</span>
<span>        <span class="co"># generation</span></span>
<span>        generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">ebola_serialinter</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_n <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># combine list outputs (for each simulation ID) into a single data frame</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualize ----------------------------------------</span></span>
<span></span>
<span><span class="va">sim_chains_aggregate</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sim_multiple_chains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_n <span class="op">=</span> <span class="fu">as_factor</span><span class="op">(</span><span class="va">simulation_n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">ceiling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">simulation_n</span>, <span class="va">day</span>, name <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">simulation_n</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cases_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sim_chains_aggregate</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cases_cumsum</span>,</span>
<span>      group <span class="op">=</span> <span class="va">simulation_n</span></span>
<span>    <span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># define a 100-case threshold</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-26-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Remarkably, even with R0 less than 1 (R = 0.95) we can have
potentially explosive outbreaks. The observed variation in individual
infectiousness in Ebola means that although the probability of
extinction is high, new index cases also have the potential for
explosive regrowth of the epidemic.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Puntos Clave</h3>
<div class="callout-content">
<ul>
<li>Use <code>{epichains}</code> to simulate the large outbreak
potential of diseases with overdispersed offspring distributions.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>Esta lección está sujeta al <a href="CODE_OF_CONDUCT.html">Código de Conducta</a></p>
        <p>

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/README.md" class="external-link">Editar en GitHub</a>

	
        | <a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CONTRIBUTING.md" class="external-link">Contribuir</a>
        | <a href="https://github.com/epiverse-trace/tutorials-middle/" class="external-link">Fuente</a></p>
				<p><a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CITATION" class="external-link">Cita</a> | <a href="mailto:andree.valle-campos@lshtm.ac.uk">Contacto</a> | <a href="https://carpentries.org/about/" class="external-link">Acerca de</a></p>
			</div>
			<div class="col-md-6">

        <p>Materiales bajo la <a href="LICENSE.html">CC-BY 4.0</a> por las autoras</p>

        <p>Plantilla compartida bajo <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> por <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Construido con <a href="https://github.com/epiverse-trace/sandpaper/tree/patch-renv-github-bug" class="external-link">sandpaper (0.16.6)</a>, <a href="https://github.com/carpentries/pegboard/tree/main" class="external-link">pegboard (0.7.6)</a> y <a href="https://github.com/epiverse-trace/varnish/tree/epiversetheme" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Volver al inicio"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Volver</span> al inicio
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://epiverse-trace.github.io/tutorials-middle/aio.html",
  "inLanguage": "es",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "forecasts, epidemic models, interventions",
  "name": "Todo en una sola página",
  "creativeWorkStatus": "active",
  "url": "https://epiverse-trace.github.io/tutorials-middle/aio.html",
  "identifier": "https://epiverse-trace.github.io/tutorials-middle/aio.html",
  "dateCreated": "2024-07-11",
  "dateModified": "2024-09-24",
  "datePublished": "2024-09-24"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

